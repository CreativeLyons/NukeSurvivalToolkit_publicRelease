set cut_paste_input [stack 0]
BackdropNode {
 inputs 0
 name BackdropNode4
 tile_color 0x3b4245ff
 label "Advanced Keying Template"
 note_font_size 200
 note_font_color 0xffffffff
 selected true
 xpos -4211
 ypos -4950
 bdwidth 8480
 bdheight 9896
 z_order -2
}
BackdropNode {
 inputs 0
 name BackdropNode100
 tile_color 0x667c7c00
 label "BG Element"
 note_font_size 60
 note_font_color 0xffffffff
 selected true
 xpos 5519
 ypos -3946
 bdwidth 610
 bdheight 387
}
BackdropNode {
 inputs 0
 name BackdropNode101
 tile_color 0x374935ff
 label "Green\nScreen Footage"
 note_font_size 112
 selected true
 xpos -1839
 ypos -4613
 bdwidth 1208
 bdheight 847
}
BackdropNode {
 inputs 0
 name BackdropNode102
 tile_color 0x5c5539ff
 label "Edge Matte"
 note_font_size 140
 note_font_color 0xffffffff
 selected true
 xpos 1037
 ypos -2794
 bdwidth 1411
 bdheight 2103
}
BackdropNode {
 inputs 0
 name BackdropNode103
 tile_color 0x61454f00
 label Cleanplate
 note_font_size 140
 note_font_color 0xffffffff
 selected true
 xpos 2620
 ypos -2791
 bdwidth 1026
 bdheight 1464
}
BackdropNode {
 inputs 0
 name BackdropNode105
 tile_color 0x6b506800
 label "inject alpha"
 note_font_size 60
 note_font_color 0xffffffff
 selected true
 xpos -1531
 ypos 172
 bdwidth 514
 bdheight 240
}
BackdropNode {
 inputs 0
 name BackdropNode106
 tile_color 0x5a3f6200
 label "inject cleanplate"
 note_font_size 60
 note_font_color 0xffffffff
 selected true
 xpos -1533
 ypos 468
 bdwidth 511
 bdheight 299
}
BackdropNode {
 inputs 0
 name BackdropNode107
 tile_color 0x5b7179ff
 label "exponentially blurring inwards\nfor blending the core/edge despills"
 note_font_size 26
 note_font_color 0xffffffff
 selected true
 xpos -218
 ypos -889
 bdwidth 420
 bdheight 275
}
BackdropNode {
 inputs 0
 name BackdropNode109
 tile_color 0x4e6689ff
 label "Color Corrections"
 note_font_size 50
 note_font_color 0xffffffff
 selected true
 xpos -1625
 ypos 970
 bdwidth 433
 bdheight 480
}
BackdropNode {
 inputs 0
 name BackdropNode110
 tile_color 0x666d6500
 label LightWrap
 note_font_size 60
 note_font_color 0xffffffff
 selected true
 xpos -1576
 ypos 4171
 bdwidth 719
 bdheight 391
}
BackdropNode {
 inputs 0
 name BackdropNode111
 tile_color 0x47633eff
 label "Additive Keyer"
 note_font_size 60
 note_font_color 0xffffffff
 selected true
 xpos 5418
 ypos 4593
 bdwidth 665
 bdheight 399
}
BackdropNode {
 inputs 0
 name BackdropNode112
 tile_color 0x6a5353ff
 label "Keep Util Channels"
 note_font_size 60
 note_font_color 0xffffffff
 selected true
 xpos -1935
 ypos -225
 bdwidth 634
 bdheight 344
}
BackdropNode {
 inputs 0
 name BackdropNode113
 tile_color 0x535a6bff
 label "Comine Despill"
 note_font_size 60
 note_font_color 0xffffffff
 selected true
 xpos -1917
 ypos -959
 bdwidth 1009
 bdheight 557
}
BackdropNode {
 inputs 0
 name BackdropNode114
 tile_color 0x687675ff
 label premult
 note_font_size 60
 note_font_color 0xffffffff
 selected true
 xpos -1497
 ypos 3849
 bdwidth 160
 bdheight 160
}
BackdropNode {
 inputs 0
 name BackdropNode18
 tile_color 0x4c5e5bff
 label "Making BG Stamp\nfor BG Blend and Lightwrap"
 note_font_size 60
 note_font_color 0xffffffff
 selected true
 xpos 5451
 ypos 4195
 bdwidth 736
 bdheight 282
}
BackdropNode {
 inputs 0
 name BackdropNode49
 tile_color 0x808080ff
 label "Output Stamps"
 note_font_size 60
 note_font_color 0xffffffff
 selected true
 xpos -1494
 ypos 2272
 bdwidth 922
 bdheight 305
}
BackdropNode {
 inputs 0
 name BackdropNode63
 tile_color 0x503d4600
 label "test BG"
 note_font_size 60
 note_font_color 0xffffffff
 selected true
 xpos 5356
 ypos -5007
 bdwidth 643
 bdheight 492
}
BackdropNode {
 inputs 0
 name BackdropNode72
 tile_color 0x4e3f6800
 label "GS Plate (transformed)\nfor QC comparison"
 note_font_size 30
 note_font_color 0xffffffff
 selected true
 xpos 5296
 ypos 5262
 bdwidth 350
 bdheight 243
}
BackdropNode {
 inputs 0
 name BackdropNode94
 tile_color 0x645c38ff
 label "BG despill edge blending"
 note_font_size 62
 note_font_color 0xffffffff
 selected true
 xpos -1734
 ypos 2753
 bdwidth 1601
 bdheight 854
}
BackdropNode {
 inputs 0
 name BackdropNode95
 tile_color 0x39525cff
 label "Core Despill"
 note_font_size 140
 note_font_color 0xffffffff
 selected true
 xpos -3290
 ypos -2717
 bdwidth 1205
 bdheight 1295
}
BackdropNode {
 inputs 0
 name BackdropNode96
 tile_color 0x4b6648ff
 label "creating GS channel\nfor review at bottom of key"
 note_font_size 42
 note_font_color 0xffffffff
 selected true
 xpos -1644
 ypos -3646
 bdwidth 554
 bdheight 462
}
BackdropNode {
 inputs 0
 name BackdropNode97
 tile_color 0x472e5500
 label Transforms
 note_font_size 60
 note_font_color 0xffffffff
 selected true
 xpos -1646
 ypos 1579
 bdwidth 478
 bdheight 481
}
BackdropNode {
 inputs 0
 name BackdropNode98
 tile_color 0x39525cff
 label "Core Matte"
 note_font_size 140
 note_font_color 0xffffffff
 selected true
 xpos -134
 ypos -2778
 bdwidth 1097
 bdheight 1475
}
BackdropNode {
 inputs 0
 name BackdropNode99
 tile_color 0x5c5539ff
 label "Edge Despill"
 note_font_size 140
 note_font_color 0xffffffff
 selected true
 xpos -1931
 ypos -2742
 bdwidth 1485
 bdheight 1364
}
push $cut_paste_input
Roto {
 output alpha
 cliptype none
 curves {{{v x3f99999a}
  {f 0}
  {n
   {layer Root
    {f 2097152}
    {t x44800000 x44070000}
    {a pt1x 0 pt1y 0 pt2x 0 pt2y 0 pt3x 0 pt3y 0 pt4x 0 pt4y 0 ptex00 0 ptex01 0 ptex02 0 ptex03 0 ptex10 0 ptex11 0 ptex12 0 ptex13 0 ptex20 0 ptex21 0 ptex22 0 ptex23 0 ptex30 0 ptex31 0 ptex32 0 ptex33 0 ptof1x 0 ptof1y 0 ptof2x 0 ptof2y 0 ptof3x 0 ptof3y 0 ptof4x 0 ptof4y 0 pterr 0 ptrefset 0 ptmot x40800000 ptref 0}
    {curvegroup Ellipse1 512 bezier
     {{cc
       {f 8192}
       {px x447ec000
        {xc227e500 0}
        {x44750000 x44500000}
        {x4227e500 0}
        {0 xc2a379f0}
        {x44840000 x44750000}
        {0 x42a379f0}
        {x4227e500 0}
        {x44750000 x448d0000}
        {xc227e500 0}
        {0 x42a379f0}
        {x44620000 x44750000}
        {0 xc2a379f0}}}
      {cc
       {f 8192}
       {p
        {{{x447ec000 xc227e500}}
      {{x447ec000 0}}}
        {{{x447ec000 0}}
      {{x447ec000 0}}}
        {{{x447ec000 x4227e500}}
      {{x447ec000 0}}}
        {{{x447ec000 0}}
      {{x447ec000 xc2a379f0}}}
        {{{x447ec000 0}}
      {{x447ec000 0}}}
        {{{x447ec000 0}}
      {{x447ec000 x42a379f0}}}
        {{{x447ec000 x4227e500}}
      {{x447ec000 0}}}
        {{{x447ec000 0}}
      {{x447ec000 0}}}
        {{{x447ec000 xc227e500}}
      {{x447ec000 0}}}
        {{{x447ec000 0}}
      {{x447ec000 x42a379f0}}}
        {{{x447ec000 0}}
      {{x447ec000 0}}}
        {{{x447ec000 0}}
      {{x447ec000 xc2a379f0}}}}}}
     {tx x447ec000 x44750000 x44750000}
     {a osw x41200000 osf 0 str 1 spx x44800000 spy x44070000 sb 1 ltn x447ec000 ltm x447ec000 tt x40e00000}}}}}}
 toolbox {selectAll {
  { selectAll str 1 ssx 1 ssy 1 sf 1 }
  { createBezier str 1 ssx 1 ssy 1 sf 1 sb 1 tt 4 }
  { createBezierCusped str 1 ssx 1 ssy 1 sf 1 sb 1 }
  { createBSpline str 1 ssx 1 ssy 1 sf 1 sb 1 }
  { createEllipse str 1 ssx 1 ssy 1 sf 1 sb 1 tt 7 }
  { createRectangle str 1 ssx 1 ssy 1 sf 1 sb 1 }
  { createRectangleCusped str 1 ssx 1 ssy 1 sf 1 sb 1 }
  { brush str 1 ssx 1 ssy 1 sf 1 sb 1 }
  { eraser src 2 str 1 ssx 1 ssy 1 sf 1 sb 1 }
  { clone src 1 str 1 ssx 1 ssy 1 sf 1 sb 1 }
  { reveal src 3 str 1 ssx 1 ssy 1 sf 1 sb 1 }
  { dodge src 1 str 1 ssx 1 ssy 1 sf 1 sb 1 }
  { burn src 1 str 1 ssx 1 ssy 1 sf 1 sb 1 }
  { blur src 1 str 1 ssx 1 ssy 1 sf 1 sb 1 }
  { sharpen src 1 str 1 ssx 1 ssy 1 sf 1 sb 1 }
  { smear src 1 str 1 ssx 1 ssy 1 sf 1 sb 1 }
} }
 toolbar_brush_hardness 0.200000003
 toolbar_source_transform_scale {1 1}
 toolbar_source_transform_center {1024 540}
 colorOverlay {0 0 0 0}
 lifetime_type "all frames"
 lifetime_start 1019
 lifetime_end 1019
 motionblur_shutter_offset_type centred
 source_black_outside true
 name Roto14
 selected true
 xpos 5576
 ypos -4775
}
Blur {
 size 100
 name Blur2
 label "\[value size]"
 selected true
 xpos 5576
 ypos -4715
}
Constant {
 inputs 0
 channels rgb
 color {2.960000038 2.999999762 3.039999962 12}
 name Constant1
 selected true
 xpos 5432
 ypos -4665
}
CheckerBoard2 {
 inputs 0
 name CheckerBoard1
 selected true
 xpos 5753
 ypos -4941
}
Grade {
 multiply 0.105
 name Grade1
 selected true
 xpos 5753
 ypos -4829
}
Keymix {
 inputs 3
 channels rgba
 name Keymix1
 selected true
 xpos 5753
 ypos -4641
 disable true
}
Dot {
 name Dot5
 label BG_ELEMENT
 note_font_size 51
 selected true
 xpos 5787
 ypos -3684
}
Dot {
 name Dot6
 label BG
 note_font_size 71
 selected true
 xpos 5787
 ypos 4382
}
set N914af150 [stack 0]
NoOp {
 name Anchor_3cad2b60ea
 help "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019"
 onCreate "if nuke.GUI:\n    try:\n        import stamps; stamps.anchorOnCreate()\n    except:\n        pass"
 knobChanged stamps.anchorKnobChanged()
 autolabel "nuke.thisNode().knob(\"title\").value()"
 tile_color 0xffffff01
 note_font_size 20
 selected true
 xpos 5581
 ypos 4374
 addUserKnob {20 anchor_tab l "Anchor Stamp"}
 addUserKnob {26 identifier -STARTLINE +HIDDEN T anchor}
 addUserKnob {1 title l Title: t "Displayed name on the Node Graph for this Stamp and its Anchor.\nIMPORTANT: This is only for display purposes, and is different from the real/internal name of the Stamps."}
 title "BG Before Key"
 addUserKnob {26 prev_title l "" +STARTLINE +HIDDEN T "BG Before Key"}
 addUserKnob {26 prev_name l "" +STARTLINE +HIDDEN T Anchor_3cad2b60ea}
 addUserKnob {3 showing l "" +STARTLINE +HIDDEN}
 addUserKnob {1 tags l Tags t "Comma-separated tags you can define for each Anchor, that will help you find it when invoking the Stamp Selector by pressing the Stamps shortkey with nothing selected."}
 tags 2D,
 addUserKnob {26 line1 l "" +STARTLINE}
 addUserKnob {26 stamps_label l Stamps: T " "}
 addUserKnob {22 createStamp l new t "Create a new Stamp for this Anchor." -STARTLINE T stamps.stampCreateWired(nuke.thisNode())}
 addUserKnob {22 selectStamps l select t "Reconnect all of this Anchor's Stamps." -STARTLINE T stamps.wiredSelectSimilar(nuke.thisNode().name())}
 addUserKnob {22 reconnectStamps l reconnect -STARTLINE T stamps.anchorReconnectWired()}
 addUserKnob {22 zoomNext l "zoom next" t "Navigate to this Anchor's next Stamp on the Node Graph." -STARTLINE T stamps.wiredZoomNext(nuke.thisNode().name())}
 addUserKnob {26 line2 l "" +STARTLINE}
 addUserKnob {22 buttonHelp l Help -STARTLINE T stamps.showHelp()}
 addUserKnob {26 version l " " t "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019." -STARTLINE T "<a href=\"http://www.nukepedia.com/gizmos/other/stamps\" style=\"color:#666;text-decoration: none;\"><span style=\"color:#666\"> <big>Stamps v1.0</big></b></a>"}
}
set N914d1670 [stack 0]
NoOp {
 name Stamp43
 help "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019"
 onCreate "if nuke.GUI:\n    try:\n        import stamps; stamps.wiredOnCreate()\n    except:\n        pass\n"
 knobChanged "import stamps; stamps.wiredKnobChanged()"
 autolabel "nuke.thisNode().knob(\"title\").value()"
 tile_color 0x1000001
 note_font "Bitstream Vera Sans"
 note_font_size 20
 selected true
 xpos -1153
 ypos 4269
 hide_input true
 addUserKnob {20 wired_tab l "Wired Stamp"}
 addUserKnob {26 identifier -STARTLINE +HIDDEN T wired}
 addUserKnob {3 lockCallbacks l "" +STARTLINE +HIDDEN}
 addUserKnob {6 toReconnect -STARTLINE +HIDDEN}
 addUserKnob {1 title l Title: t "Displayed name on the Node Graph for this Stamp and its Anchor.\nIMPORTANT: This is only for display purposes, and is different from the real/internal name of the Stamps."}
 title "BG Before Key"
 addUserKnob {26 prev_title l "" +STARTLINE +HIDDEN T "BG Before Key"}
 addUserKnob {26 tags l Tags: t "Tags of this stamp's Anchor, for information purpose only.\nClick \"show anchor\" to change them." T <i>2D</i>}
 addUserKnob {26 backdrops l Backdrops: t "Labels of backdrop nodes which contain this stamp's Anchor." +HIDDEN T " "}
 addUserKnob {26 line1 l "" +STARTLINE}
 addUserKnob {26 anchor_label l Anchor: T " "}
 addUserKnob {22 show_anchor l " show anchor " t "Show the properties panel for this Stamp's Anchor." -STARTLINE T stamps.wiredShowAnchor()}
 addUserKnob {22 zoom_anchor l "zoom anchor" t "Navigate to this Stamp's Anchor on the Node Graph." -STARTLINE T stamps.wiredZoomAnchor()}
 addUserKnob {26 stamps_label l Stamps: T " "}
 addUserKnob {22 zoomNext l " zoom next " t "Navigate to this Stamp's next sibling on the Node Graph." -STARTLINE T stamps.wiredZoomNext()}
 addUserKnob {22 selectSimilar l " select similar " t "Select all similar Stamps to this one on the Node Graph." -STARTLINE T stamps.wiredSelectSimilar()}
 addUserKnob {26 space_1 l "" +STARTLINE T " "}
 addUserKnob {26 reconnect_label l Reconnect: t "Reconnect by the stored Anchor name." T " "}
 addUserKnob {22 reconnect_this l this t "Reconnect this Stamp to its Anchor, by its stored Anchor name." -STARTLINE T "n = nuke.thisNode()\ntry:\n    n.setInput(0,nuke.toNode(n.knob(\"anchor\").value()))\nexcept:\n    nuke.message(\"Unable to reconnect.\")\ntry:\n    import stamps\n    stamps.wiredGetStyle(n)\nexcept:\n    pass\n"}
 addUserKnob {22 reconnect_similar l similar t "Reconnect this Stamp and similar ones to their Anchor, by their stored anchor name." -STARTLINE T stamps.wiredReconnectSimilar()}
 addUserKnob {22 reconnect_all l all t "Reconnect all the Stamps to their Anchors, by their stored anchor names." -STARTLINE T stamps.wiredReconnectAll()}
 addUserKnob {26 space_2 l "" +STARTLINE T " "}
 addUserKnob {20 advanced_reconnection l "Advanced Reconnection" n 2}
 addUserKnob {26 reconnect_by_title_label l "<font color=gold>By Title:" t "Reconnect by searching for a matching title." T " "}
 addUserKnob {22 reconnect_by_title_this l this t "Look for an Anchor that shares this Stamp's title, and connect this Stamp to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitle()}
 addUserKnob {22 reconnect_by_title_similar l similar t "Look for an Anchor that shares this Stamp's title, and connect this Stamp and similar ones to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitleSimilar()}
 addUserKnob {22 reconnect_by_title_selected l selected t "For each Stamp selected, look for an Anchor that shares its title, and connect to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitleSelected()}
 addUserKnob {26 reconnect_by_selection_label l "<font color=orangered>By Selection:" t "Force reconnect to a selected Anchor." T " "}
 addUserKnob {22 reconnect_by_selection_this l this t "Force reconnect this Stamp to a selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelection()}
 addUserKnob {22 reconnect_by_selection_similar l similar t "Force reconnect this Stamp and similar ones to a selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelectionSimilar()}
 addUserKnob {22 reconnect_by_selection_selected l selected t "Force reconnect all selected Stamps to an also selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelectionSelected()}
 addUserKnob {1 anchor l Anchor}
 anchor Anchor_3cad2b60ea
 addUserKnob {6 auto_reconnect_by_title l "<font color=#ED9977>&nbsp; auto-reconnect by title" t "When creating this stamp again (like on copy-paste), auto-reconnect it by title instead of doing it by the saved anchor's name, and auto-turn this off immediately.\nIMPORTANT: Should be off by default. Only use this for setting up templates." +STARTLINE}
 addUserKnob {20 advanced_reconnection_1 l "Advanced Reconnection" +INVISIBLE n -1}
 addUserKnob {26 line2 l "" +STARTLINE}
 addUserKnob {22 buttonHelp l Help -STARTLINE T stamps.showHelp()}
 addUserKnob {26 version l " " t "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019." -STARTLINE T "<a href=\"http://www.nukepedia.com/gizmos/other/stamps\" style=\"color:#666;text-decoration: none;\"><span style=\"color:#666\"> <big>Stamps v1.0</big></b></a>"}
}
Dot {
 name Dot9
 label BG
 note_font_size 101
 selected true
 xpos -1119
 ypos 4410
}
Dot {
 inputs 0
 name Dot1
 label GreenScreenPlate
 note_font_size 41
 selected true
 xpos -1423
 ypos -4212
}
AddChannels {
 channels rgba
 name AddChannels3
 selected true
 xpos -1457
 ypos -4142
}
Dot {
 name Dot26
 selected true
 xpos -1423
 ypos -3529
}
add_layer {GS_Plate GS_Plate.red GS_Plate.green GS_Plate.blue GS_Plate.alpha}
Shuffle {
 black red
 white green
 red2 blue
 green2 black
 out2 GS_Plate
 name Shuffle33
 label "\[value in] → \[value out2]"
 selected true
 xpos -1457
 ypos -3466
}
Dot {
 name Dot8
 note_font_size 41
 selected true
 xpos -1423
 ypos -3329
}
set N9144ae90 [stack 0]
Dot {
 name Dot34
 selected true
 xpos -1423
 ypos -2999
}
set N919a5f20 [stack 0]
Dot {
 name Dot38
 selected true
 xpos 373
 ypos -2999
}
set N919a9e60 [stack 0]
Dot {
 name Dot46
 selected true
 xpos 1637
 ypos -2999
}
set N919add90 [stack 0]
Remove {
 operation keep
 channels rgb
 name Remove30
 selected true
 xpos 1603
 ypos -2878
}
Dot {
 name Dot17
 note_font_size 41
 selected true
 xpos 1637
 ypos -2600
}
set N914f07d0 [stack 0]
IBKColourV3 {
 name IBKColourV3_10
 selected true
 xpos 1845
 ypos -2603
}
Group {
 name BinaryAlpha5
 tile_color 0x2a2a2aff
 label "(\[value an] --> \[value output1])"
 note_font Verdana
 note_font_color 0xfffff9ff
 selected true
 xpos 1845
 ypos -2545
 addUserKnob {20 BinaryAlpha}
 addUserKnob {4 an l Analyze: M {rgb rgba alpha "" "" ""}}
 addUserKnob {4 output1 l Output: M {rgba alpha "" "" "" ""}}
 output1 alpha
 addUserKnob {20 info l Info}
 addUserKnob {26 creator l Creator: T "<b><big>Tony Lyons"}
 addUserKnob {26 desc l Description: t "Analyzes channel input and creates a binary result 0 or 1 and outputs it into output channel" T BinaryAlpha}
 addUserKnob {26 ver l Version: T v03}
}
 Input {
  inputs 0
  name Input
  xpos -398
  ypos 275
 }
 Expression {
  temp_name0 rgb_an
  temp_expr0 "r !=0 || g!=0 || b!=0?1:0"
  temp_name1 rgba_an
  temp_expr1 "r!=0 || g!=0 || b!=0 || a!=0?1:0"
  temp_name2 alpha_an
  temp_expr2 a!=0?1:0
  expr3 "parent.an == 0 ? rgb_an : parent.an == 1 ? rgba_an : alpha_an"
  name Expression
  xpos -398
  ypos 341
 }
 Shuffle {
  red alpha
  green alpha
  blue alpha
  name Shuffle
  label "\[value in]"
  xpos -398
  ypos 367
  disable {{parent.output1}}
 }
 Output {
  name Output1
  xpos -398
  ypos 456
 }
end_group
EdgeBlur {
 channels rgba
 size 10
 name EdgeBlur1
 selected true
 xpos 1845
 ypos -2507
}
Group {
 name ExponBlurSimple
 onCreate "n = nuke.thisNode()\nn.knob('size').setRange(-100, 100)\nn.knob('adjustBBoxPixels').setRange(0, 400)\nn.knob('adjustBBoxPercent').setRange(1, 2)\nn.knob('safeBBoxPixels').setRange(0, 400)\nn.knob('safeBBoxPercent').setRange(1, 2)"
 knobChanged "n = nuke.thisNode()\nk = nuke.thisKnob()\n\nif k.name() == \"includeOriginal\":\n    if n.knob('includeOriginal').getValue() == 1:\n        merge = nuke.toNode(\"Merge1\")\n        original = nuke.toNode('Original')\n        AvgMult = nuke.toNode(\"AverageMult\")\n        steps = int(n.knob('steps').getValue())\n        merge.setInput(steps+1, original)\n        AvgMult\['whitepoint'].setValue(2 if steps<2 else steps+1)\n        \n    else:\n        merge.setInput(steps+1, None)\n        AvgMult\['whitepoint'].setValue(2 if steps<2 else steps)\n        \nelif k.name() == \"steps\":\n    \n    s = int(k.value())\n    if s<1:\n        k.setValue(1)\n    else:\n        start = nuke.toNode(\"Start\")\n        end   = nuke.toNode(\"End\")\n        b1    = nuke.toNode(\"Blur1\")\n        merge = nuke.toNode(\"Merge1\")\n        AvgMult = nuke.toNode(\"AverageMult\")\n        \n        b1x   = b1.xpos()\n        b1y   = b1.ypos()\n        b1n   = b1.name()\n        \n        steps = int(n.knob('steps').getValue())\n        size  = n.knob('size').getValue()\n        mult  = n.knob('mult').getValue()\n        \n        #b1.setInput(0, start)\n        for i in range(1,merge.inputs()):\n            merge.setInput(i,None)\n        merge.setInput(0, b1)\n        \[nuke.delete(i) for i in nuke.allNodes() if i.xpos()>start.xpos()]\n        for i in range(1,steps):\n            # Blur\n            b = nuke.nodes.Blur()\n            b.setXYpos(b1x+i*100,b1y)\n            b.setInput(0,start)\n            b\[\"channels\"].setValue(\"all\")\n            b\[\"crop\"].setValue(0)\n            b\[\"size\"].setValue(0, 1)\n            b\[\"size\"].setExpression(\"(Blur1.size)*(mult)**%s\"%(i))\n            b\[\"label\"].setValue(\"\[value size]\")\n            merge.setInput(i if i<2 else i+1, b)\n            AvgMult\['whitepoint'].setValue(i if i<2 else i+1)\n            \n        if n.knob('includeOriginal').getValue() == 1:\n            merge = nuke.toNode(\"Merge1\")\n            original = nuke.toNode('Original')\n            AvgMult = nuke.toNode(\"AverageMult\")\n            steps = int(n.knob('steps').getValue())\n            merge.setInput(steps+1, original)\n            AvgMult\['whitepoint'].setValue(2 if steps<2 else steps+1)\n            \nelif k.name() == \"output2\":\n    if n.knob(\"output2\").getValue() == 4:\n        n.knob('AvgMaxOriginal').setVisible(True)\n    else:\n        n.knob('AvgMaxOriginal').setVisible(False)\n        \nelif k.name() == \"safeBBox\":\n    if n.knob(\"safeBBox\").getValue() == 0:\n        n.knob('safeBBoxText').setVisible(False)\n        n.knob('safetyBBoxMethod').setVisible(False)\n        n.knob('safeBBoxPixels').setVisible(False)\n        n.knob('safeBBoxPercent').setVisible(False)\n        \n    elif n.knob(\"safeBBox\").getValue() == 1:\n        n.knob('safetyBBoxMethod').setVisible(True)\n        n.knob('safeBBoxText').setVisible(True)\n        if n.knob('safetyBBoxMethod').value() == \"pixels\":\n            n.knob('safeBBoxPixels').setVisible(True)\n            n.knob('safeBBoxPercent').setVisible(False)\n        elif n.knob('safetyBBoxMethod').value() == \"percent\":\n            n.knob('safeBBoxPixels').setVisible(False)\n            n.knob('safeBBoxPercent').setVisible(True)\n            \nelif k.name() == \"safetyBBoxMethod\":\n    if n.knob(\"safetyBBoxMethod\").value() == \"pixels\":\n        n.knob('safeBBoxPixels').setVisible(True)\n        n.knob('safeBBoxPercent').setVisible(False)\n    elif n.knob(\"safetyBBoxMethod\").value() == \"percent\":\n        n.knob('safeBBoxPixels').setVisible(False)\n        n.knob('safeBBoxPercent').setVisible(True)\n        \nelif k.name() == \"adjustBBoxExtra\":\n    if n.knob(\"adjustBBoxExtra\").value() == \"pixels\":\n        n.knob('adjustBBoxPixels').setVisible(True)\n        n.knob('adjustBBoxPercent').setVisible(False)\n    elif n.knob(\"adjustBBoxExtra\").value() == \"percent\":\n        n.knob('adjustBBoxPixels').setVisible(False)\n        n.knob('adjustBBoxPercent').setVisible(True)\n"
 tile_color 0xcc804eff
 label "(\[value output2])"
 note_font "Verdana Bold Bold Bold Bold Bold Bold"
 note_font_color 0xffffffff
 selected true
 xpos 1845
 ypos -2450
 addUserKnob {20 ExponBlurSimple}
 addUserKnob {41 channels T Remove1.channels}
 addUserKnob {41 maskChannelMask_1 l area T Multiply1.maskChannelMask}
 addUserKnob {41 inject_1 l inject -STARTLINE T Multiply1.inject}
 addUserKnob {41 invert_mask_1 l invert -STARTLINE T Multiply1.invert_mask}
 addUserKnob {41 fringe_1 l fringe -STARTLINE T Multiply1.fringe}
 addUserKnob {26 ""}
 addUserKnob {4 output2 l Operation: M {Screen Plus Over Hypot Average Max Min "" "" "" "" ""}}
 output2 Over
 addUserKnob {3 steps l "  Steps" -STARTLINE}
 steps 4
 addUserKnob {26 text l " " -STARTLINE T " "}
 addUserKnob {6 includeOriginal l "Include Original?" -STARTLINE}
 includeOriginal true
 addUserKnob {6 AvgMaxOriginal l "Use Max of Average and Original" +HIDDEN +STARTLINE}
 addUserKnob {14 size l Size R -100 100}
 size 2
 addUserKnob {7 mult l Multiplier R 1 5}
 mult 2.5
 addUserKnob {6 clamp +STARTLINE}
 addUserKnob {14 postBlur l "Post Blur" R 0 100}
 addUserKnob {26 ""}
 addUserKnob {20 bboxControl l "BBox Control" n 1}
 bboxControl 0
 addUserKnob {26 text_2 l " " T " "}
 addUserKnob {4 bbox l "BBox: " -STARTLINE M {union intersectionMask A B "input format" "" "" "" "" "" "" "" "" "" "" "" ""}}
 addUserKnob {6 blackOutside l "Black Outside" -STARTLINE}
 addUserKnob {6 safeBBox l "Safe BBox" t "If the output BBox is larger than the input format and the input box combined. the result will be max of the input/format bbox plus a safety \"buffer\" in pixels or percent \n\nTurning off might make your BBox grow exponentially with high blur values" -STARTLINE}
 safeBBox true
 addUserKnob {26 safeBBoxText l "" +STARTLINE T " "}
 addUserKnob {4 safetyBBoxMethod l "Safe BBox Buffer  " -STARTLINE M {pixels percent "" "" "" "" "" "" "" "" "" "" "" "" "" "" ""}}
 safetyBBoxMethod percent
 addUserKnob {14 safeBBoxPixels l "" -STARTLINE +HIDDEN R 0 400}
 safeBBoxPixels 100
 addUserKnob {14 safeBBoxPercent l "" -STARTLINE R 1 2}
 safeBBoxPercent 1.1
 addUserKnob {26 text_3 l "" +STARTLINE T " "}
 addUserKnob {4 adjustBBoxExtra l "Extra BBox Adjust" -STARTLINE M {pixels percent "" "" "" "" "" "" "" "" "" "" "" "" ""}}
 addUserKnob {14 adjustBBoxPercent l "" -STARTLINE +HIDDEN R 1 2}
 adjustBBoxPercent 1
 addUserKnob {14 adjustBBoxPixels l "" -STARTLINE R 0 400}
 addUserKnob {26 ""}
 addUserKnob {20 endGroup n -1}
 addUserKnob {41 maskChannelMask l mask T MergeKeymix.maskChannelMask}
 addUserKnob {41 inject -STARTLINE T MergeKeymix.inject}
 addUserKnob {41 invert_mask l invert -STARTLINE T MergeKeymix.invert_mask}
 addUserKnob {41 fringe -STARTLINE T MergeKeymix.fringe}
 addUserKnob {41 mix T MergeKeymix.mix}
 addUserKnob {20 info l Info}
 addUserKnob {26 creator l Creator: T "Tony Lyons"}
 addUserKnob {26 desc l Description: T ExponBlurSimple}
 addUserKnob {26 ver l Version: T v03}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x535e5a00
  label "BBox Management"
  note_font_size 30
  note_font_color 0xffffffff
  xpos -529
  ypos 492
  bdwidth 341
  bdheight 525
 }
 Input {
  inputs 0
  name Inputimg
  xpos 0
  ypos -969
 }
 Dot {
  name Dot16
  note_font_size 41
  xpos 34
  ypos -802
 }
set N918dbcb0 [stack 0]
 Dot {
  name Dot2
  note_font_size 41
  xpos -367
  ypos -802
 }
 Dot {
  name Dot18
  label B
  note_font_size 41
  xpos -367
  ypos 434
 }
 Dot {
  name Dot11
  note_font_size 41
  xpos -367
  ypos 623
 }
set N918e79a0 [stack 0]
 Dot {
  name Dot3
  note_font_size 41
  xpos -367
  ypos 675
 }
set N918eb920 [stack 0]
 Dot {
  name Dot8
  note_font_size 41
  xpos -463
  ypos 675
 }
 Dot {
  name Dot15
  note_font_size 41
  xpos -463
  ypos 831
 }
push $N918dbcb0
 Dot {
  name Dot1
  note_font_size 41
  xpos 461
  ypos -802
 }
 Remove {
  operation keep
  channels rgba
  name Remove1
  xpos 427
  ypos -718
 }
 Dot {
  name Dot21
  note_font_size 41
  xpos 461
  ypos -597
 }
set N91b068d0 [stack 0]
 Invert {
  name Invert1
  xpos 695
  ypos -604
  disable {{"parent.size < 0 ? 0 : 1"}}
 }
set N91b0a6e0 [stack 0]
 Dot {
  name Dot4
  note_font_size 41
  xpos 540
  ypos -543
 }
 NoOp {
  name Original
  xpos 506
  ypos -327
 }
set N91b185e0 [stack 0]
 Dot {
  name Dot5
  note_font_size 41
  xpos 540
  ypos 14
 }
 Crop {
  inputs 0
  box {{"!\[exists parent.input0] ? 0 : input.format.x"} {"!\[exists parent.input0] ? 0 : input.format.y"} {"!\[exists parent.input0] ? 0 : input.format.r"} {"!\[exists parent.input0] ? 0 : input.format.t"}}
  reformat true
  crop false
  name Crop1
  xpos 210
  ypos -750
  addUserKnob {20 User}
  addUserKnob {22 cropToBbox l "Crop to Bounding Box" -STARTLINE T codeBBox()}
 }
 AddChannels {
  channels rgba
  name AddChannels2
  xpos 210
  ypos -724
 }
push $N918dbcb0
 Merge2 {
  inputs 2
  name Merge3
  label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
  xpos 83
  ypos -671
 }
 NoOp {
  name BBoxInput
  xpos 83
  ypos -628
  addUserKnob {20 User}
  addUserKnob {15 bbox}
  bbox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
 }
push $N91b185e0
 Input {
  inputs 0
  name Inputarea
  xpos 289
  ypos -638
  number 2
 }
 AddChannels {
  channels alpha
  color 1
  name AddChannels1
  xpos 289
  ypos -580
 }
 Invert {
  channels rgba
  name Invert3
  xpos 289
  ypos -503
 }
push $N91b0a6e0
 Multiply {
  inputs 1+1
  value 0
  name Multiply1
  label "\[value value]"
  xpos 695
  ypos -512
 }
 NoOp {
  name Start
  xpos 695
  ypos -450
 }
set N91ab6210 [stack 0]
 Blur {
  size {{(Blur1.size)*(mult)**3} {(Blur1.size)*(mult)**3}}
  crop false
  name Blur4
  label "\[value size]"
  xpos 995
  ypos -370
 }
push $N91ab6210
 Blur {
  size {{(Blur1.size)*(mult)**2} {(Blur1.size)*(mult)**2}}
  crop false
  name Blur3
  label "\[value size]"
  xpos 895
  ypos -370
 }
push 0
push $N91ab6210
 Blur {
  size {{(Blur1.size)*(mult)**1} {(Blur1.size)*(mult)**1}}
  crop false
  name Blur2
  label "\[value size]"
  xpos 795
  ypos -370
 }
push $N91ab6210
 Blur {
  size {{parent.size.w} {parent.size.h}}
  name Blur1
  label "\[value size]"
  xpos 695
  ypos -370
 }
 Merge2 {
  inputs 5+1
  operation {{mergeNumber.mergeNumber}}
  also_merge all
  name Merge1
  label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
  xpos 695
  ypos -273
 }
 NoOp {
  name End
  xpos 695
  ypos -230
 }
set N91af4980 [stack 0]
 CopyBBox {
  inputs 2
  name CopyBBox1
  xpos 585
  ypos -175
 }
 Group {
  name BBoxToFormat
  onCreate "n = nuke.thisNode()\ninputFormat = n.knob(\"inputFormat\")\ninputBBox = n.knob(\"inputBBox\")\ncrop = nuke.toNode(\"Crop6\")\ncropb = crop.knob('box')\noutputBBox = n.knob('outputBBox')\noutputBBoxCenter = n.knob(\"outputBBoxCenter\")\n\ninputFormat.setFlag(0x0000000000008000)\ninputBBox.setFlag(0x0000000000008000)\ncropb.setFlag(0x0000000000008000)\noutputBBox.setFlag(0x0000000000008000)\noutputBBoxCenter.setFlag(0x0000000000008000)\n\nn = nuke.thisNode()\nn.knob(\"overscan\").setRange(0,400)\nn.knob(\"overscanPercent\").setRange(1,4)"
  tile_color 0xa57aaaff
  note_font "Verdana Bold Bold Bold Bold Bold Bold Bold"
  note_font_color 0xffffffff
  xpos 585
  ypos -151
  addUserKnob {20 CropBBox}
  addUserKnob {4 type l Type +INVISIBLE M {"To Format" "To BBox"}}
  addUserKnob {41 intersect T Crop6.intersect}
  addUserKnob {6 blackOutside l "Black Outside" -STARTLINE}
  addUserKnob {4 overscanType l "Overscan Type:" M {Pixels Percentage}}
  overscanType {{parent.safetyBBoxMethod}}
  addUserKnob {14 overscan l Overscan R 0 400}
  overscan {{parent.safeBBoxPixels} {parent.safeBBoxPixels}}
  addUserKnob {14 overscanPercent l "Overscan Percent" R 1 4}
  overscanPercent {{parent.safeBBoxPercent} {parent.safeBBoxPercent}}
  addUserKnob {20 inputBbox l "BBox Data" n 1}
  addUserKnob {15 inputFormat l "Input Format"}
  inputFormat {0 0 {input.width} {input.height}}
  addUserKnob {15 inputBBox l "Input BBox"}
  inputBBox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
  addUserKnob {12 outputBBoxCenter l OutputBBoxCenter}
  outputBBoxCenter {{OutputBBox1.outputBBoxCenter.w} {OutputBBox1.outputBBoxCenter.h}}
  addUserKnob {15 outputBBox l "Output BBox"}
  outputBBox {{OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox}}
  addUserKnob {20 endGroup n -1}
  addUserKnob {20 info_1 l Info}
  addUserKnob {26 creator l Creator: T "<b><big>Tony Lyons"}
  addUserKnob {26 desc l Description: t "crop to inputformat\n\ndisplays values of input bbox" T CropBBox}
  addUserKnob {26 ver l Version: T v02}
 }
  Input {
   inputs 0
   name Input
   xpos 261
   ypos 394
  }
  Dot {
   name Dot2
   note_font_size 41
   xpos 295
   ypos 462
  }
set N91c13920 [stack 0]
  Dot {
   name Dot1
   note_font_size 41
   xpos -160
   ypos 462
  }
set N91c17840 [stack 0]
push $N91c13920
  Crop {
   box {{parent.inputBBox} {parent.inputBBox} {parent.inputBBox} {parent.inputBBox}}
   crop {{parent.blackOutside}}
   name Crop6
   xpos 261
   ypos 510
   addUserKnob {20 User}
   addUserKnob {22 cropToBbox l "Crop to Bounding Box" -STARTLINE T codeBBox()}
  }
set N91c1b720 [stack 0]
  Remove {
   operation keep
   channels none
   name Remove1
   xpos 120
   ypos 504
  }
set N91c24fd0 [stack 0]
  Transform {
   scale {{parent.overscanPercent} {parent.overscanPercent}}
   center {{((input.bbox.r-input.bbox.x)/2)+input.bbox.x} {((input.bbox.t-input.bbox.y)/2)+input.bbox.y}}
   shutteroffset centred
   name Transform1
   selected true
   xpos 120
   ypos 553
  }
push $N91c24fd0
  AdjBBox {
   numpixels {{parent.overscan} {parent.overscan}}
   name AdjBBox1
   xpos -5
   ypos 510
  }
  Switch {
   inputs 2
   which {{overscanType}}
   name Switch2
   label "\[value which]"
   xpos -5
   ypos 549
  }
  Merge2 {
   inputs 2
   bbox intersection
   Achannels {-rgba.red -rgba.green -rgba.blue rgba.alpha}
   Bchannels {-rgba.red -rgba.green -rgba.blue rgba.alpha}
   output {-rgba.red -rgba.green -rgba.blue rgba.alpha}
   name Merge1
   xpos -5
   ypos 647
   disable {{!parent.Crop6.intersect}}
  }
push $N91c17840
  CopyBBox {
   inputs 2
   name CopyBBox1
   xpos -194
   ypos 653
  }
  BlackOutside {
   name BlackOutside1
   xpos -194
   ypos 692
   disable {{!parent.blackOutside}}
  }
  Dot {
   name Dot4
   note_font_size 41
   xpos -160
   ypos 769
  }
push $N91c1b720
  Switch {
   inputs 2
   which {{"overscanType == 0 ? overscan.w != 0 || overscan.h != 0 : overscanPercent.w != 1 || overscanPercent.h != 1 ? 1 : 0"}}
   name Switch1
   label "\[value which]"
   xpos 261
   ypos 759
  }
set N91c58460 [stack 0]
  Output {
   name Output1
   xpos 261
   ypos 921
  }
push $N91c58460
  NoOp {
   name OutputBBox1
   xpos 378
   ypos 821
   addUserKnob {20 User}
   addUserKnob {15 OutputBBox l "Output BBox"}
   OutputBBox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
   addUserKnob {14 outputBBoxCenter l "Output BBox Center" R 0 100}
   outputBBoxCenter {{OutputBBox.x+(OutputBBox.r-OutputBBox.x)/2} {OutputBBox.y+(OutputBBox.t-OutputBBox.y)/2}}
  }
 end_group
push $N91af4980
 Merge2 {
  inputs 2
  bbox intersection
  also_merge all
  name Merge4
  xpos 585
  ypos -127
 }
push $N91af4980
 CopyBBox {
  inputs 2
  name CopyBBox2
  xpos 585
  ypos -101
 }
push $N91af4980
 Switch {
  inputs 2
  which {{"parent.safeBBox && ((BBoxResult.bbox.x < BBoxInput.bbox.x || BBoxResult.bbox.y < BBoxInput.bbox.y || BBoxResult.bbox.r > BBoxInput.bbox.r || BBoxResult.bbox.t > BBoxInput.bbox.t))"}}
  name Switch2
  label "\[value which]"
  xpos 695
  ypos -106
 }
 Grade {
  channels all
  whitepoint 5
  black_clamp false
  name AverageMult
  xpos 695
  ypos -37
  disable {{"output2 == 4 ? 0 : 1"}}
 }
 Merge2 {
  inputs 2
  operation max
  also_merge all
  name Merge2
  label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
  xpos 695
  ypos 10
  disable {{"output2 == 4 && includeOriginal == 1 && AvgMaxOriginal == 1 ? 0 : 1"}}
 }
 Clamp {
  name Clamp1
  selected true
  xpos 695
  ypos 50
  disable {{!parent.clamp}}
 }
 Blur {
  size {{postBlur} {postBlur}}
  name BlurOriginal
  label "\[value size]"
  xpos 695
  ypos 102
 }
 Invert {
  name Invert2
  xpos 695
  ypos 144
  disable {{"parent.size < 0 ? 0 : 1"}}
 }
push $N91b068d0
 Switch {
  inputs 2
  which {{"parent.size == 0 ? 0 : 1"}}
  name Switch1
  label "\[value which]"
  xpos 427
  ypos 190
 }
 Dot {
  name Dot17
  label A
  note_font_size 41
  xpos 34
  ypos 455
 }
 Dot {
  name Dot7
  note_font_size 41
  xpos 34
  ypos 579
 }
set N91cc7a70 [stack 0]
 Dot {
  name Dot12
  note_font_size 41
  xpos -260
  ypos 579
 }
 Dot {
  name Dot13
  note_font_size 41
  xpos -260
  ypos 799
 }
push $N918e79a0
 Input {
  inputs 0
  name Inputmask
  xpos 512
  ypos 322
  number 1
 }
 Dot {
  name Dot19
  label Mask
  note_font_size 41
  xpos 546
  ypos 435
 }
set N91cd7570 [stack 0]
 Dot {
  name Dot20
  note_font_size 41
  xpos 436
  ypos 435
 }
push $N91cc7a70
 Merge2 {
  inputs 2
  bbox intersection
  Achannels {rgba.red -rgba.green -rgba.blue rgba.alpha}
  Bchannels {rgba.red -rgba.green -rgba.blue rgba.alpha}
  output {rgba.red -rgba.green -rgba.blue rgba.alpha}
  name MergeIntersection
  xpos 402
  ypos 572
  disable {{"!\[exists parent.input1]"}}
 }
 Merge2 {
  inputs 2
  Achannels {rgba.red -rgba.green -rgba.blue rgba.alpha}
  Bchannels {rgba.red -rgba.green -rgba.blue rgba.alpha}
  output {rgba.red -rgba.green -rgba.blue rgba.alpha}
  name MergeUnion
  xpos 402
  ypos 610
  disable {{"!\[exists parent.input1]"}}
 }
 Dot {
  name Dot6
  label "intersection\nof (Mask and A) + B"
  note_font_size 14
  note_font_color 0xffffffff
  xpos 436
  ypos 770
 }
push $N91cd7570
 Dot {
  name Dot10
  note_font_size 41
  xpos 546
  ypos 672
 }
push $N91cc7a70
push $N918eb920
 Merge2 {
  inputs 2+1
  operation copy
  Achannels none
  Bchannels none
  output none
  also_merge {{{parent.Remove1.channels}}}
  name MergeKeymix
  xpos 0
  ypos 665
 }
 Dot {
  name Dot14
  note_font_size 41
  xpos 34
  ypos 747
 }
set N91d132a0 [stack 0]
push $N918eb920
 CopyBBox {
  inputs 2
  name CopyBBoxUnion
  xpos -401
  ypos 743
  disable {{parent.bbox==0?0:1}}
 }
 CopyBBox {
  inputs 2
  name CopyBBoxIntersection
  xpos -401
  ypos 769
  disable {{"parent.bbox==1 ? 0 : 1"}}
 }
 CopyBBox {
  inputs 2
  name CopyBBoxA
  xpos -401
  ypos 795
  disable {{"parent.bbox==2 ? 0 : 1"}}
 }
 CopyBBox {
  inputs 2
  name CopyBBoxB
  xpos -401
  ypos 827
  disable {{"parent.bbox==3 ? 0 : 1"}}
 }
 Crop {
  box {0 0 {parent.width} {parent.height}}
  crop false
  name CopyBBoxFormat
  xpos -401
  ypos 853
  disable {{"parent.bbox==4 ? 0 : 1"}}
  addUserKnob {20 User}
  addUserKnob {22 cropToBbox l "Crop to Bounding Box" -STARTLINE T codeBBox()}
 }
set N91d31130 [stack 0]
 Transform {
  scale {{parent.adjustBBoxPercent} {parent.adjustBBoxPercent}}
  center {{((input.bbox.r-input.bbox.x)/2)+input.bbox.x} {((input.bbox.t-input.bbox.y)/2)+input.bbox.y}}
  black_outside false
  shutteroffset centred
  name TransformBBoxAdjustPercent
  xpos -516
  ypos 898
 }
push $N91d31130
 AdjBBox {
  numpixels {{parent.adjustBBoxPixels} {parent.adjustBBoxPixels}}
  name AdjBBoxPixels
  xpos -401
  ypos 901
 }
 Switch {
  inputs 2
  which {{adjustBBoxExtra}}
  name Switch3
  xpos -401
  ypos 940
 }
 Dot {
  name Dot9
  note_font_size 41
  xpos -367
  ypos 993
 }
push $N91d132a0
 CopyBBox {
  inputs 2
  name CopyBBox
  xpos 0
  ypos 989
 }
 BlackOutside {
  name BlackOutside1
  xpos 0
  ypos 1015
  disable {{!parent.blackOutside}}
 }
 Output {
  name Output1
  xpos 0
  ypos 1155
 }
 NoOp {
  inputs 0
  name mergeNumber
  xpos 229
  ypos -862
  addUserKnob {20 User}
  addUserKnob {3 mergeNumber}
  mergeNumber {{"output2 == 0 ? 25 : output2 == 1 ? 24 : output2 == 2 ? 22 : output2 == 3 ? 13 : output2 == 4 ? 24 : output2 == 5 ? 17 : 18"}}
 }
push $N91af4980
 NoOp {
  name BBoxResult
  xpos 585
  ypos -230
  addUserKnob {20 User}
  addUserKnob {15 bbox}
  bbox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
 }
end_group
Unpremult {
 name Unpremult2
 selected true
 xpos 1845
 ypos -2412
}
Dot {
 name Dot36
 label "first level \nfor detail"
 note_font "DejaVu LGC Sans"
 note_font_size 20
 selected true
 xpos 1879
 ypos -2358
}
Group {
 name BinaryAlpha6
 tile_color 0x2a2a2aff
 label "(\[value an] --> \[value output1])"
 note_font Verdana
 note_font_color 0xfffff9ff
 selected true
 xpos 1845
 ypos -2320
 addUserKnob {20 BinaryAlpha}
 addUserKnob {4 an l Analyze: M {rgb rgba alpha "" "" ""}}
 addUserKnob {4 output1 l Output: M {rgba alpha "" "" "" ""}}
 output1 alpha
 addUserKnob {20 info l Info}
 addUserKnob {26 creator l Creator: T "<b><big>Tony Lyons"}
 addUserKnob {26 desc l Description: t "Analyzes channel input and creates a binary result 0 or 1 and outputs it into output channel" T BinaryAlpha}
 addUserKnob {26 ver l Version: T v03}
}
 Input {
  inputs 0
  name Input
  xpos -398
  ypos 275
 }
 Expression {
  temp_name0 rgb_an
  temp_expr0 "r !=0 || g!=0 || b!=0?1:0"
  temp_name1 rgba_an
  temp_expr1 "r!=0 || g!=0 || b!=0 || a!=0?1:0"
  temp_name2 alpha_an
  temp_expr2 a!=0?1:0
  expr3 "parent.an == 0 ? rgb_an : parent.an == 1 ? rgba_an : alpha_an"
  name Expression
  xpos -398
  ypos 341
 }
 Shuffle {
  red alpha
  green alpha
  blue alpha
  name Shuffle
  label "\[value in]"
  xpos -398
  ypos 367
  disable {{parent.output1}}
 }
 Output {
  name Output1
  xpos -398
  ypos 456
 }
end_group
EdgeBlur {
 channels rgba
 size 79
 name EdgeBlur5
 selected true
 xpos 1845
 ypos -2282
}
Group {
 name ExponBlurSimple2
 onCreate "n = nuke.thisNode()\nn.knob('size').setRange(-100, 100)\nn.knob('adjustBBoxPixels').setRange(0, 400)\nn.knob('adjustBBoxPercent').setRange(1, 2)\nn.knob('safeBBoxPixels').setRange(0, 400)\nn.knob('safeBBoxPercent').setRange(1, 2)"
 knobChanged "n = nuke.thisNode()\nk = nuke.thisKnob()\n\nif k.name() == \"includeOriginal\":\n    if n.knob('includeOriginal').getValue() == 1:\n        merge = nuke.toNode(\"Merge1\")\n        original = nuke.toNode('Original')\n        AvgMult = nuke.toNode(\"AverageMult\")\n        steps = int(n.knob('steps').getValue())\n        merge.setInput(steps+1, original)\n        AvgMult\['whitepoint'].setValue(2 if steps<2 else steps+1)\n        \n    else:\n        merge.setInput(steps+1, None)\n        AvgMult\['whitepoint'].setValue(2 if steps<2 else steps)\n        \nelif k.name() == \"steps\":\n    \n    s = int(k.value())\n    if s<1:\n        k.setValue(1)\n    else:\n        start = nuke.toNode(\"Start\")\n        end   = nuke.toNode(\"End\")\n        b1    = nuke.toNode(\"Blur1\")\n        merge = nuke.toNode(\"Merge1\")\n        AvgMult = nuke.toNode(\"AverageMult\")\n        \n        b1x   = b1.xpos()\n        b1y   = b1.ypos()\n        b1n   = b1.name()\n        \n        steps = int(n.knob('steps').getValue())\n        size  = n.knob('size').getValue()\n        mult  = n.knob('mult').getValue()\n        \n        #b1.setInput(0, start)\n        for i in range(1,merge.inputs()):\n            merge.setInput(i,None)\n        merge.setInput(0, b1)\n        \[nuke.delete(i) for i in nuke.allNodes() if i.xpos()>start.xpos()]\n        for i in range(1,steps):\n            # Blur\n            b = nuke.nodes.Blur()\n            b.setXYpos(b1x+i*100,b1y)\n            b.setInput(0,start)\n            b\[\"channels\"].setValue(\"all\")\n            b\[\"crop\"].setValue(0)\n            b\[\"size\"].setValue(0, 1)\n            b\[\"size\"].setExpression(\"(Blur1.size)*(mult)**%s\"%(i))\n            b\[\"label\"].setValue(\"\[value size]\")\n            merge.setInput(i if i<2 else i+1, b)\n            AvgMult\['whitepoint'].setValue(i if i<2 else i+1)\n            \n        if n.knob('includeOriginal').getValue() == 1:\n            merge = nuke.toNode(\"Merge1\")\n            original = nuke.toNode('Original')\n            AvgMult = nuke.toNode(\"AverageMult\")\n            steps = int(n.knob('steps').getValue())\n            merge.setInput(steps+1, original)\n            AvgMult\['whitepoint'].setValue(2 if steps<2 else steps+1)\n            \nelif k.name() == \"output2\":\n    if n.knob(\"output2\").getValue() == 4:\n        n.knob('AvgMaxOriginal').setVisible(True)\n    else:\n        n.knob('AvgMaxOriginal').setVisible(False)\n        \nelif k.name() == \"safeBBox\":\n    if n.knob(\"safeBBox\").getValue() == 0:\n        n.knob('safeBBoxText').setVisible(False)\n        n.knob('safetyBBoxMethod').setVisible(False)\n        n.knob('safeBBoxPixels').setVisible(False)\n        n.knob('safeBBoxPercent').setVisible(False)\n        \n    elif n.knob(\"safeBBox\").getValue() == 1:\n        n.knob('safetyBBoxMethod').setVisible(True)\n        n.knob('safeBBoxText').setVisible(True)\n        if n.knob('safetyBBoxMethod').value() == \"pixels\":\n            n.knob('safeBBoxPixels').setVisible(True)\n            n.knob('safeBBoxPercent').setVisible(False)\n        elif n.knob('safetyBBoxMethod').value() == \"percent\":\n            n.knob('safeBBoxPixels').setVisible(False)\n            n.knob('safeBBoxPercent').setVisible(True)\n            \nelif k.name() == \"safetyBBoxMethod\":\n    if n.knob(\"safetyBBoxMethod\").value() == \"pixels\":\n        n.knob('safeBBoxPixels').setVisible(True)\n        n.knob('safeBBoxPercent').setVisible(False)\n    elif n.knob(\"safetyBBoxMethod\").value() == \"percent\":\n        n.knob('safeBBoxPixels').setVisible(False)\n        n.knob('safeBBoxPercent').setVisible(True)\n        \nelif k.name() == \"adjustBBoxExtra\":\n    if n.knob(\"adjustBBoxExtra\").value() == \"pixels\":\n        n.knob('adjustBBoxPixels').setVisible(True)\n        n.knob('adjustBBoxPercent').setVisible(False)\n    elif n.knob(\"adjustBBoxExtra\").value() == \"percent\":\n        n.knob('adjustBBoxPixels').setVisible(False)\n        n.knob('adjustBBoxPercent').setVisible(True)\n"
 tile_color 0xcc804eff
 label "(\[value output2])"
 note_font "Verdana Bold Bold Bold Bold Bold Bold Bold"
 note_font_color 0xffffffff
 selected true
 xpos 1845
 ypos -2228
 addUserKnob {20 ExponBlurSimple}
 addUserKnob {41 channels T Remove1.channels}
 addUserKnob {41 maskChannelMask_1 l area T Multiply1.maskChannelMask}
 addUserKnob {41 inject_1 l inject -STARTLINE T Multiply1.inject}
 addUserKnob {41 invert_mask_1 l invert -STARTLINE T Multiply1.invert_mask}
 addUserKnob {41 fringe_1 l fringe -STARTLINE T Multiply1.fringe}
 addUserKnob {26 ""}
 addUserKnob {4 output2 l Operation: M {Screen Plus Over Hypot Average Max Min "" "" "" "" ""}}
 output2 Over
 addUserKnob {3 steps l "  Steps" -STARTLINE}
 steps 4
 addUserKnob {26 text l " " -STARTLINE T " "}
 addUserKnob {6 includeOriginal l "Include Original?" -STARTLINE}
 includeOriginal true
 addUserKnob {6 AvgMaxOriginal l "Use Max of Average and Original" +HIDDEN +STARTLINE}
 addUserKnob {14 size l Size R -100 100}
 size 3.2
 addUserKnob {7 mult l Multiplier R 1 5}
 mult 3.4
 addUserKnob {6 clamp +STARTLINE}
 addUserKnob {14 postBlur l "Post Blur" R 0 100}
 addUserKnob {26 ""}
 addUserKnob {20 bboxControl l "BBox Control" n 1}
 bboxControl 0
 addUserKnob {26 text_2 l " " T " "}
 addUserKnob {4 bbox l "BBox: " -STARTLINE M {union intersectionMask A B "input format" "" "" "" "" "" "" "" "" "" "" "" ""}}
 addUserKnob {6 blackOutside l "Black Outside" -STARTLINE}
 addUserKnob {6 safeBBox l "Safe BBox" t "If the output BBox is larger than the input format and the input box combined. the result will be max of the input/format bbox plus a safety \"buffer\" in pixels or percent \n\nTurning off might make your BBox grow exponentially with high blur values" -STARTLINE}
 safeBBox true
 addUserKnob {26 safeBBoxText l "" +STARTLINE T " "}
 addUserKnob {4 safetyBBoxMethod l "Safe BBox Buffer  " -STARTLINE M {pixels percent "" "" "" "" "" "" "" "" "" "" "" "" "" "" ""}}
 safetyBBoxMethod percent
 addUserKnob {14 safeBBoxPixels l "" -STARTLINE +HIDDEN R 0 400}
 safeBBoxPixels 100
 addUserKnob {14 safeBBoxPercent l "" -STARTLINE R 1 2}
 safeBBoxPercent 1.1
 addUserKnob {26 text_3 l "" +STARTLINE T " "}
 addUserKnob {4 adjustBBoxExtra l "Extra BBox Adjust" -STARTLINE M {pixels percent "" "" "" "" "" "" "" "" "" "" "" "" ""}}
 addUserKnob {14 adjustBBoxPercent l "" -STARTLINE +HIDDEN R 1 2}
 adjustBBoxPercent 1
 addUserKnob {14 adjustBBoxPixels l "" -STARTLINE R 0 400}
 addUserKnob {26 ""}
 addUserKnob {20 endGroup n -1}
 addUserKnob {41 maskChannelMask l mask T MergeKeymix.maskChannelMask}
 addUserKnob {41 inject -STARTLINE T MergeKeymix.inject}
 addUserKnob {41 invert_mask l invert -STARTLINE T MergeKeymix.invert_mask}
 addUserKnob {41 fringe -STARTLINE T MergeKeymix.fringe}
 addUserKnob {41 mix T MergeKeymix.mix}
 addUserKnob {20 info l Info}
 addUserKnob {26 creator l Creator: T "Tony Lyons"}
 addUserKnob {26 desc l Description: T ExponBlurSimple}
 addUserKnob {26 ver l Version: T v03}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x535e5a00
  label "BBox Management"
  note_font_size 30
  note_font_color 0xffffffff
  xpos -529
  ypos 492
  bdwidth 341
  bdheight 525
 }
 Input {
  inputs 0
  name Inputimg
  xpos 0
  ypos -969
 }
 Dot {
  name Dot16
  note_font_size 41
  xpos 34
  ypos -802
 }
set N91dc2470 [stack 0]
 Dot {
  name Dot2
  note_font_size 41
  xpos -367
  ypos -802
 }
 Dot {
  name Dot18
  label B
  note_font_size 41
  xpos -367
  ypos 434
 }
 Dot {
  name Dot11
  note_font_size 41
  xpos -367
  ypos 623
 }
set N91dce160 [stack 0]
 Dot {
  name Dot3
  note_font_size 41
  xpos -367
  ypos 675
 }
set N91dd20e0 [stack 0]
 Dot {
  name Dot8
  note_font_size 41
  xpos -463
  ypos 675
 }
 Dot {
  name Dot15
  note_font_size 41
  xpos -463
  ypos 831
 }
push $N91dc2470
 Dot {
  name Dot1
  note_font_size 41
  xpos 461
  ypos -802
 }
 Remove {
  operation keep
  channels rgba
  name Remove1
  xpos 427
  ypos -718
 }
 Dot {
  name Dot21
  note_font_size 41
  xpos 461
  ypos -597
 }
set N91de9110 [stack 0]
 Invert {
  name Invert1
  xpos 695
  ypos -604
  disable {{"parent.size < 0 ? 0 : 1"}}
 }
set N91decf20 [stack 0]
 Dot {
  name Dot4
  note_font_size 41
  xpos 540
  ypos -543
 }
 NoOp {
  name Original
  xpos 506
  ypos -327
 }
set N91dfae20 [stack 0]
 Dot {
  name Dot5
  note_font_size 41
  xpos 540
  ypos 14
 }
 Crop {
  inputs 0
  box {{"!\[exists parent.input0] ? 0 : input.format.x"} {"!\[exists parent.input0] ? 0 : input.format.y"} {"!\[exists parent.input0] ? 0 : input.format.r"} {"!\[exists parent.input0] ? 0 : input.format.t"}}
  reformat true
  crop false
  name Crop1
  xpos 210
  ypos -750
  addUserKnob {20 User}
  addUserKnob {22 cropToBbox l "Crop to Bounding Box" -STARTLINE T codeBBox()}
 }
 AddChannels {
  channels rgba
  name AddChannels2
  xpos 210
  ypos -724
 }
push $N91dc2470
 Merge2 {
  inputs 2
  name Merge3
  label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
  xpos 83
  ypos -671
 }
 NoOp {
  name BBoxInput
  xpos 83
  ypos -628
  addUserKnob {20 User}
  addUserKnob {15 bbox}
  bbox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
 }
push $N91dfae20
 Input {
  inputs 0
  name Inputarea
  xpos 289
  ypos -638
  number 2
 }
 AddChannels {
  channels alpha
  color 1
  name AddChannels1
  xpos 289
  ypos -580
 }
 Invert {
  channels rgba
  name Invert3
  xpos 289
  ypos -503
 }
push $N91decf20
 Multiply {
  inputs 1+1
  value 0
  name Multiply1
  label "\[value value]"
  xpos 695
  ypos -512
 }
 NoOp {
  name Start
  xpos 695
  ypos -450
 }
set N91e484d0 [stack 0]
 Blur {
  size {{(Blur1.size)*(mult)**3} {(Blur1.size)*(mult)**3}}
  crop false
  name Blur4
  label "\[value size]"
  xpos 995
  ypos -370
 }
push $N91e484d0
 Blur {
  size {{(Blur1.size)*(mult)**2} {(Blur1.size)*(mult)**2}}
  crop false
  name Blur3
  label "\[value size]"
  xpos 895
  ypos -370
 }
push 0
push $N91e484d0
 Blur {
  size {{(Blur1.size)*(mult)**1} {(Blur1.size)*(mult)**1}}
  crop false
  name Blur2
  label "\[value size]"
  xpos 795
  ypos -370
 }
push $N91e484d0
 Blur {
  size {{parent.size.w} {parent.size.h}}
  name Blur1
  label "\[value size]"
  xpos 695
  ypos -370
 }
 Merge2 {
  inputs 5+1
  operation {{mergeNumber.mergeNumber}}
  also_merge all
  name Merge1
  label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
  xpos 695
  ypos -273
 }
 NoOp {
  name End
  xpos 695
  ypos -230
 }
set N91e86b80 [stack 0]
 CopyBBox {
  inputs 2
  name CopyBBox1
  xpos 585
  ypos -175
 }
 Group {
  name BBoxToFormat
  onCreate "n = nuke.thisNode()\ninputFormat = n.knob(\"inputFormat\")\ninputBBox = n.knob(\"inputBBox\")\ncrop = nuke.toNode(\"Crop6\")\ncropb = crop.knob('box')\noutputBBox = n.knob('outputBBox')\noutputBBoxCenter = n.knob(\"outputBBoxCenter\")\n\ninputFormat.setFlag(0x0000000000008000)\ninputBBox.setFlag(0x0000000000008000)\ncropb.setFlag(0x0000000000008000)\noutputBBox.setFlag(0x0000000000008000)\noutputBBoxCenter.setFlag(0x0000000000008000)\n\nn = nuke.thisNode()\nn.knob(\"overscan\").setRange(0,400)\nn.knob(\"overscanPercent\").setRange(1,4)"
  tile_color 0xa57aaaff
  note_font "Verdana Bold Bold Bold Bold Bold Bold Bold Bold"
  note_font_color 0xffffffff
  xpos 585
  ypos -151
  addUserKnob {20 CropBBox}
  addUserKnob {4 type l Type +INVISIBLE M {"To Format" "To BBox"}}
  addUserKnob {41 intersect T Crop6.intersect}
  addUserKnob {6 blackOutside l "Black Outside" -STARTLINE}
  addUserKnob {4 overscanType l "Overscan Type:" M {Pixels Percentage}}
  overscanType {{parent.safetyBBoxMethod}}
  addUserKnob {14 overscan l Overscan R 0 400}
  overscan {{parent.safeBBoxPixels} {parent.safeBBoxPixels}}
  addUserKnob {14 overscanPercent l "Overscan Percent" R 1 4}
  overscanPercent {{parent.safeBBoxPercent} {parent.safeBBoxPercent}}
  addUserKnob {20 inputBbox l "BBox Data" n 1}
  addUserKnob {15 inputFormat l "Input Format"}
  inputFormat {0 0 {input.width} {input.height}}
  addUserKnob {15 inputBBox l "Input BBox"}
  inputBBox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
  addUserKnob {12 outputBBoxCenter l OutputBBoxCenter}
  outputBBoxCenter {{OutputBBox1.outputBBoxCenter.w} {OutputBBox1.outputBBoxCenter.h}}
  addUserKnob {15 outputBBox l "Output BBox"}
  outputBBox {{OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox}}
  addUserKnob {20 endGroup n -1}
  addUserKnob {20 info_1 l Info}
  addUserKnob {26 creator l Creator: T "<b><big>Tony Lyons"}
  addUserKnob {26 desc l Description: t "crop to inputformat\n\ndisplays values of input bbox" T CropBBox}
  addUserKnob {26 ver l Version: T v02}
 }
  Input {
   inputs 0
   name Input
   xpos 261
   ypos 394
  }
  Dot {
   name Dot2
   note_font_size 41
   xpos 295
   ypos 462
  }
set N91b46d20 [stack 0]
  Dot {
   name Dot1
   note_font_size 41
   xpos -160
   ypos 462
  }
set N91b4ac40 [stack 0]
push $N91b46d20
  Crop {
   box {{parent.inputBBox} {parent.inputBBox} {parent.inputBBox} {parent.inputBBox}}
   crop {{parent.blackOutside}}
   name Crop6
   xpos 261
   ypos 510
   addUserKnob {20 User}
   addUserKnob {22 cropToBbox l "Crop to Bounding Box" -STARTLINE T codeBBox()}
  }
set N91e984f0 [stack 0]
  Remove {
   operation keep
   channels none
   name Remove1
   xpos 120
   ypos 504
  }
set N91ea1750 [stack 0]
  Transform {
   scale {{parent.overscanPercent} {parent.overscanPercent}}
   center {{((input.bbox.r-input.bbox.x)/2)+input.bbox.x} {((input.bbox.t-input.bbox.y)/2)+input.bbox.y}}
   shutteroffset centred
   name Transform1
   selected true
   xpos 120
   ypos 553
  }
push $N91ea1750
  AdjBBox {
   numpixels {{parent.overscan} {parent.overscan}}
   name AdjBBox1
   xpos -5
   ypos 510
  }
  Switch {
   inputs 2
   which {{overscanType}}
   name Switch2
   label "\[value which]"
   xpos -5
   ypos 549
  }
  Merge2 {
   inputs 2
   bbox intersection
   Achannels {-rgba.red -rgba.green -rgba.blue rgba.alpha}
   Bchannels {-rgba.red -rgba.green -rgba.blue rgba.alpha}
   output {-rgba.red -rgba.green -rgba.blue rgba.alpha}
   name Merge1
   xpos -5
   ypos 647
   disable {{!parent.Crop6.intersect}}
  }
push $N91b4ac40
  CopyBBox {
   inputs 2
   name CopyBBox1
   xpos -194
   ypos 653
  }
  BlackOutside {
   name BlackOutside1
   xpos -194
   ypos 692
   disable {{!parent.blackOutside}}
  }
  Dot {
   name Dot4
   note_font_size 41
   xpos -160
   ypos 769
  }
push $N91e984f0
  Switch {
   inputs 2
   which {{"overscanType == 0 ? overscan.w != 0 || overscan.h != 0 : overscanPercent.w != 1 || overscanPercent.h != 1 ? 1 : 0"}}
   name Switch1
   label "\[value which]"
   xpos 261
   ypos 759
  }
set N91edf990 [stack 0]
  Output {
   name Output1
   xpos 261
   ypos 921
  }
push $N91edf990
  NoOp {
   name OutputBBox1
   xpos 378
   ypos 821
   addUserKnob {20 User}
   addUserKnob {15 OutputBBox l "Output BBox"}
   OutputBBox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
   addUserKnob {14 outputBBoxCenter l "Output BBox Center" R 0 100}
   outputBBoxCenter {{OutputBBox.x+(OutputBBox.r-OutputBBox.x)/2} {OutputBBox.y+(OutputBBox.t-OutputBBox.y)/2}}
  }
 end_group
push $N91e86b80
 Merge2 {
  inputs 2
  bbox intersection
  also_merge all
  name Merge4
  xpos 585
  ypos -127
 }
push $N91e86b80
 CopyBBox {
  inputs 2
  name CopyBBox2
  xpos 585
  ypos -101
 }
push $N91e86b80
 Switch {
  inputs 2
  which {{"parent.safeBBox && ((BBoxResult.bbox.x < BBoxInput.bbox.x || BBoxResult.bbox.y < BBoxInput.bbox.y || BBoxResult.bbox.r > BBoxInput.bbox.r || BBoxResult.bbox.t > BBoxInput.bbox.t))"}}
  name Switch2
  label "\[value which]"
  xpos 695
  ypos -106
 }
 Grade {
  channels all
  whitepoint 5
  black_clamp false
  name AverageMult
  xpos 695
  ypos -37
  disable {{"output2 == 4 ? 0 : 1"}}
 }
 Merge2 {
  inputs 2
  operation max
  also_merge all
  name Merge2
  label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
  xpos 695
  ypos 10
  disable {{"output2 == 4 && includeOriginal == 1 && AvgMaxOriginal == 1 ? 0 : 1"}}
 }
 Clamp {
  name Clamp1
  selected true
  xpos 695
  ypos 50
  disable {{!parent.clamp}}
 }
 Blur {
  size {{postBlur} {postBlur}}
  name BlurOriginal
  label "\[value size]"
  xpos 695
  ypos 102
 }
 Invert {
  name Invert2
  xpos 695
  ypos 144
  disable {{"parent.size < 0 ? 0 : 1"}}
 }
push $N91de9110
 Switch {
  inputs 2
  which {{"parent.size == 0 ? 0 : 1"}}
  name Switch1
  label "\[value which]"
  xpos 427
  ypos 190
 }
 Dot {
  name Dot17
  label A
  note_font_size 41
  xpos 34
  ypos 455
 }
 Dot {
  name Dot7
  note_font_size 41
  xpos 34
  ypos 579
 }
set N91bb7710 [stack 0]
 Dot {
  name Dot12
  note_font_size 41
  xpos -260
  ypos 579
 }
 Dot {
  name Dot13
  note_font_size 41
  xpos -260
  ypos 799
 }
push $N91dce160
 Input {
  inputs 0
  name Inputmask
  xpos 512
  ypos 322
  number 1
 }
 Dot {
  name Dot19
  label Mask
  note_font_size 41
  xpos 546
  ypos 435
 }
set N905a32e0 [stack 0]
 Dot {
  name Dot20
  note_font_size 41
  xpos 436
  ypos 435
 }
push $N91bb7710
 Merge2 {
  inputs 2
  bbox intersection
  Achannels {rgba.red -rgba.green -rgba.blue rgba.alpha}
  Bchannels {rgba.red -rgba.green -rgba.blue rgba.alpha}
  output {rgba.red -rgba.green -rgba.blue rgba.alpha}
  name MergeIntersection
  xpos 402
  ypos 572
  disable {{"!\[exists parent.input1]"}}
 }
 Merge2 {
  inputs 2
  Achannels {rgba.red -rgba.green -rgba.blue rgba.alpha}
  Bchannels {rgba.red -rgba.green -rgba.blue rgba.alpha}
  output {rgba.red -rgba.green -rgba.blue rgba.alpha}
  name MergeUnion
  xpos 402
  ypos 610
  disable {{"!\[exists parent.input1]"}}
 }
 Dot {
  name Dot6
  label "intersection\nof (Mask and A) + B"
  note_font_size 14
  note_font_color 0xffffffff
  xpos 436
  ypos 770
 }
push $N905a32e0
 Dot {
  name Dot10
  note_font_size 41
  xpos 546
  ypos 672
 }
push $N91bb7710
push $N91dd20e0
 Merge2 {
  inputs 2+1
  operation copy
  Achannels none
  Bchannels none
  output none
  also_merge {{{parent.Remove1.channels}}}
  name MergeKeymix
  xpos 0
  ypos 665
 }
 Dot {
  name Dot14
  note_font_size 41
  xpos 34
  ypos 747
 }
set N905db210 [stack 0]
push $N91dd20e0
 CopyBBox {
  inputs 2
  name CopyBBoxUnion
  xpos -401
  ypos 743
  disable {{parent.bbox==0?0:1}}
 }
 CopyBBox {
  inputs 2
  name CopyBBoxIntersection
  xpos -401
  ypos 769
  disable {{"parent.bbox==1 ? 0 : 1"}}
 }
 CopyBBox {
  inputs 2
  name CopyBBoxA
  xpos -401
  ypos 795
  disable {{"parent.bbox==2 ? 0 : 1"}}
 }
 CopyBBox {
  inputs 2
  name CopyBBoxB
  xpos -401
  ypos 827
  disable {{"parent.bbox==3 ? 0 : 1"}}
 }
 Crop {
  box {0 0 {parent.width} {parent.height}}
  crop false
  name CopyBBoxFormat
  xpos -401
  ypos 853
  disable {{"parent.bbox==4 ? 0 : 1"}}
  addUserKnob {20 User}
  addUserKnob {22 cropToBbox l "Crop to Bounding Box" -STARTLINE T codeBBox()}
 }
set N91eeb140 [stack 0]
 Transform {
  scale {{parent.adjustBBoxPercent} {parent.adjustBBoxPercent}}
  center {{((input.bbox.r-input.bbox.x)/2)+input.bbox.x} {((input.bbox.t-input.bbox.y)/2)+input.bbox.y}}
  black_outside false
  shutteroffset centred
  name TransformBBoxAdjustPercent
  xpos -516
  ypos 898
 }
push $N91eeb140
 AdjBBox {
  numpixels {{parent.adjustBBoxPixels} {parent.adjustBBoxPixels}}
  name AdjBBoxPixels
  xpos -401
  ypos 901
 }
 Switch {
  inputs 2
  which {{adjustBBoxExtra}}
  name Switch3
  xpos -401
  ypos 940
 }
 Dot {
  name Dot9
  note_font_size 41
  xpos -367
  ypos 993
 }
push $N905db210
 CopyBBox {
  inputs 2
  name CopyBBox
  xpos 0
  ypos 989
 }
 BlackOutside {
  name BlackOutside1
  xpos 0
  ypos 1015
  disable {{!parent.blackOutside}}
 }
 Output {
  name Output1
  xpos 0
  ypos 1155
 }
 NoOp {
  inputs 0
  name mergeNumber
  xpos 229
  ypos -862
  addUserKnob {20 User}
  addUserKnob {3 mergeNumber}
  mergeNumber {{"output2 == 0 ? 25 : output2 == 1 ? 24 : output2 == 2 ? 22 : output2 == 3 ? 13 : output2 == 4 ? 24 : output2 == 5 ? 17 : 18"}}
 }
push $N91e86b80
 NoOp {
  name BBoxResult
  xpos 585
  ypos -230
  addUserKnob {20 User}
  addUserKnob {15 bbox}
  bbox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
 }
end_group
Unpremult {
 name Unpremult3
 selected true
 xpos 1845
 ypos -2190
}
Dot {
 name Dot37
 label "mid level,\nfill in / blend"
 note_font "DejaVu LGC Sans"
 note_font_size 20
 selected true
 xpos 1879
 ypos -2143
}
Group {
 name BinaryAlpha7
 tile_color 0x2a2a2aff
 label "(\[value an] --> \[value output1])"
 note_font Verdana
 note_font_color 0xfffff9ff
 selected true
 xpos 1845
 ypos -2094
 addUserKnob {20 BinaryAlpha}
 addUserKnob {4 an l Analyze: M {rgb rgba alpha "" "" ""}}
 addUserKnob {4 output1 l Output: M {rgba alpha "" "" "" ""}}
 output1 alpha
 addUserKnob {20 info l Info}
 addUserKnob {26 creator l Creator: T "<b><big>Tony Lyons"}
 addUserKnob {26 desc l Description: t "Analyzes channel input and creates a binary result 0 or 1 and outputs it into output channel" T BinaryAlpha}
 addUserKnob {26 ver l Version: T v03}
}
 Input {
  inputs 0
  name Input
  xpos -398
  ypos 275
 }
 Expression {
  temp_name0 rgb_an
  temp_expr0 "r !=0 || g!=0 || b!=0?1:0"
  temp_name1 rgba_an
  temp_expr1 "r!=0 || g!=0 || b!=0 || a!=0?1:0"
  temp_name2 alpha_an
  temp_expr2 a!=0?1:0
  expr3 "parent.an == 0 ? rgb_an : parent.an == 1 ? rgba_an : alpha_an"
  name Expression
  xpos -398
  ypos 341
 }
 Shuffle {
  red alpha
  green alpha
  blue alpha
  name Shuffle
  label "\[value in]"
  xpos -398
  ypos 367
  disable {{parent.output1}}
 }
 Output {
  name Output1
  xpos -398
  ypos 456
 }
end_group
EdgeBlur {
 channels rgba
 size 62
 name EdgeBlur6
 selected true
 xpos 1845
 ypos -2056
}
Group {
 name ExponBlurSimple3
 onCreate "n = nuke.thisNode()\nn.knob('size').setRange(-100, 100)\nn.knob('adjustBBoxPixels').setRange(0, 400)\nn.knob('adjustBBoxPercent').setRange(1, 2)\nn.knob('safeBBoxPixels').setRange(0, 400)\nn.knob('safeBBoxPercent').setRange(1, 2)"
 knobChanged "n = nuke.thisNode()\nk = nuke.thisKnob()\n\nif k.name() == \"includeOriginal\":\n    if n.knob('includeOriginal').getValue() == 1:\n        merge = nuke.toNode(\"Merge1\")\n        original = nuke.toNode('Original')\n        AvgMult = nuke.toNode(\"AverageMult\")\n        steps = int(n.knob('steps').getValue())\n        merge.setInput(steps+1, original)\n        AvgMult\['whitepoint'].setValue(2 if steps<2 else steps+1)\n        \n    else:\n        merge.setInput(steps+1, None)\n        AvgMult\['whitepoint'].setValue(2 if steps<2 else steps)\n        \nelif k.name() == \"steps\":\n    \n    s = int(k.value())\n    if s<1:\n        k.setValue(1)\n    else:\n        start = nuke.toNode(\"Start\")\n        end   = nuke.toNode(\"End\")\n        b1    = nuke.toNode(\"Blur1\")\n        merge = nuke.toNode(\"Merge1\")\n        AvgMult = nuke.toNode(\"AverageMult\")\n        \n        b1x   = b1.xpos()\n        b1y   = b1.ypos()\n        b1n   = b1.name()\n        \n        steps = int(n.knob('steps').getValue())\n        size  = n.knob('size').getValue()\n        mult  = n.knob('mult').getValue()\n        \n        #b1.setInput(0, start)\n        for i in range(1,merge.inputs()):\n            merge.setInput(i,None)\n        merge.setInput(0, b1)\n        \[nuke.delete(i) for i in nuke.allNodes() if i.xpos()>start.xpos()]\n        for i in range(1,steps):\n            # Blur\n            b = nuke.nodes.Blur()\n            b.setXYpos(b1x+i*100,b1y)\n            b.setInput(0,start)\n            b\[\"channels\"].setValue(\"all\")\n            b\[\"crop\"].setValue(0)\n            b\[\"size\"].setValue(0, 1)\n            b\[\"size\"].setExpression(\"(Blur1.size)*(mult)**%s\"%(i))\n            b\[\"label\"].setValue(\"\[value size]\")\n            merge.setInput(i if i<2 else i+1, b)\n            AvgMult\['whitepoint'].setValue(i if i<2 else i+1)\n            \n        if n.knob('includeOriginal').getValue() == 1:\n            merge = nuke.toNode(\"Merge1\")\n            original = nuke.toNode('Original')\n            AvgMult = nuke.toNode(\"AverageMult\")\n            steps = int(n.knob('steps').getValue())\n            merge.setInput(steps+1, original)\n            AvgMult\['whitepoint'].setValue(2 if steps<2 else steps+1)\n            \nelif k.name() == \"output2\":\n    if n.knob(\"output2\").getValue() == 4:\n        n.knob('AvgMaxOriginal').setVisible(True)\n    else:\n        n.knob('AvgMaxOriginal').setVisible(False)\n        \nelif k.name() == \"safeBBox\":\n    if n.knob(\"safeBBox\").getValue() == 0:\n        n.knob('safeBBoxText').setVisible(False)\n        n.knob('safetyBBoxMethod').setVisible(False)\n        n.knob('safeBBoxPixels').setVisible(False)\n        n.knob('safeBBoxPercent').setVisible(False)\n        \n    elif n.knob(\"safeBBox\").getValue() == 1:\n        n.knob('safetyBBoxMethod').setVisible(True)\n        n.knob('safeBBoxText').setVisible(True)\n        if n.knob('safetyBBoxMethod').value() == \"pixels\":\n            n.knob('safeBBoxPixels').setVisible(True)\n            n.knob('safeBBoxPercent').setVisible(False)\n        elif n.knob('safetyBBoxMethod').value() == \"percent\":\n            n.knob('safeBBoxPixels').setVisible(False)\n            n.knob('safeBBoxPercent').setVisible(True)\n            \nelif k.name() == \"safetyBBoxMethod\":\n    if n.knob(\"safetyBBoxMethod\").value() == \"pixels\":\n        n.knob('safeBBoxPixels').setVisible(True)\n        n.knob('safeBBoxPercent').setVisible(False)\n    elif n.knob(\"safetyBBoxMethod\").value() == \"percent\":\n        n.knob('safeBBoxPixels').setVisible(False)\n        n.knob('safeBBoxPercent').setVisible(True)\n        \nelif k.name() == \"adjustBBoxExtra\":\n    if n.knob(\"adjustBBoxExtra\").value() == \"pixels\":\n        n.knob('adjustBBoxPixels').setVisible(True)\n        n.knob('adjustBBoxPercent').setVisible(False)\n    elif n.knob(\"adjustBBoxExtra\").value() == \"percent\":\n        n.knob('adjustBBoxPixels').setVisible(False)\n        n.knob('adjustBBoxPercent').setVisible(True)\n"
 tile_color 0xcc804eff
 label "(\[value output2])"
 note_font "Verdana Bold Bold Bold Bold Bold Bold Bold Bold"
 note_font_color 0xffffffff
 selected true
 xpos 1845
 ypos -2002
 addUserKnob {20 ExponBlurSimple}
 addUserKnob {41 channels T Remove1.channels}
 addUserKnob {41 maskChannelMask_1 l area T Multiply1.maskChannelMask}
 addUserKnob {41 inject_1 l inject -STARTLINE T Multiply1.inject}
 addUserKnob {41 invert_mask_1 l invert -STARTLINE T Multiply1.invert_mask}
 addUserKnob {41 fringe_1 l fringe -STARTLINE T Multiply1.fringe}
 addUserKnob {26 ""}
 addUserKnob {4 output2 l Operation: M {Screen Plus Over Hypot Average Max Min "" "" "" "" ""}}
 output2 Over
 addUserKnob {3 steps l "  Steps" -STARTLINE}
 steps 4
 addUserKnob {26 text l " " -STARTLINE T " "}
 addUserKnob {6 includeOriginal l "Include Original?" -STARTLINE}
 includeOriginal true
 addUserKnob {6 AvgMaxOriginal l "Use Max of Average and Original" +HIDDEN +STARTLINE}
 addUserKnob {14 size l Size R -100 100}
 size 4
 addUserKnob {7 mult l Multiplier R 1 5}
 mult 4
 addUserKnob {6 clamp +STARTLINE}
 addUserKnob {14 postBlur l "Post Blur" R 0 100}
 addUserKnob {26 ""}
 addUserKnob {20 bboxControl l "BBox Control" n 1}
 bboxControl 0
 addUserKnob {26 text_2 l " " T " "}
 addUserKnob {4 bbox l "BBox: " -STARTLINE M {union intersectionMask A B "input format" "" "" "" "" "" "" "" "" "" "" "" ""}}
 addUserKnob {6 blackOutside l "Black Outside" -STARTLINE}
 addUserKnob {6 safeBBox l "Safe BBox" t "If the output BBox is larger than the input format and the input box combined. the result will be max of the input/format bbox plus a safety \"buffer\" in pixels or percent \n\nTurning off might make your BBox grow exponentially with high blur values" -STARTLINE}
 safeBBox true
 addUserKnob {26 safeBBoxText l "" +STARTLINE T " "}
 addUserKnob {4 safetyBBoxMethod l "Safe BBox Buffer  " -STARTLINE M {pixels percent "" "" "" "" "" "" "" "" "" "" "" "" "" "" ""}}
 safetyBBoxMethod percent
 addUserKnob {14 safeBBoxPixels l "" -STARTLINE +HIDDEN R 0 400}
 safeBBoxPixels 100
 addUserKnob {14 safeBBoxPercent l "" -STARTLINE R 1 2}
 safeBBoxPercent 1.1
 addUserKnob {26 text_3 l "" +STARTLINE T " "}
 addUserKnob {4 adjustBBoxExtra l "Extra BBox Adjust" -STARTLINE M {pixels percent "" "" "" "" "" "" "" "" "" "" "" "" ""}}
 addUserKnob {14 adjustBBoxPercent l "" -STARTLINE +HIDDEN R 1 2}
 adjustBBoxPercent 1
 addUserKnob {14 adjustBBoxPixels l "" -STARTLINE R 0 400}
 addUserKnob {26 ""}
 addUserKnob {20 endGroup n -1}
 addUserKnob {41 maskChannelMask l mask T MergeKeymix.maskChannelMask}
 addUserKnob {41 inject -STARTLINE T MergeKeymix.inject}
 addUserKnob {41 invert_mask l invert -STARTLINE T MergeKeymix.invert_mask}
 addUserKnob {41 fringe -STARTLINE T MergeKeymix.fringe}
 addUserKnob {41 mix T MergeKeymix.mix}
 addUserKnob {20 info l Info}
 addUserKnob {26 creator l Creator: T "Tony Lyons"}
 addUserKnob {26 desc l Description: T ExponBlurSimple}
 addUserKnob {26 ver l Version: T v03}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x535e5a00
  label "BBox Management"
  note_font_size 30
  note_font_color 0xffffffff
  xpos -529
  ypos 492
  bdwidth 341
  bdheight 525
 }
 Input {
  inputs 0
  name Inputimg
  xpos 0
  ypos -969
 }
 Dot {
  name Dot16
  note_font_size 41
  xpos 34
  ypos -802
 }
set N91f88520 [stack 0]
 Dot {
  name Dot2
  note_font_size 41
  xpos -367
  ypos -802
 }
 Dot {
  name Dot18
  label B
  note_font_size 41
  xpos -367
  ypos 434
 }
 Dot {
  name Dot11
  note_font_size 41
  xpos -367
  ypos 623
 }
set N91f94210 [stack 0]
 Dot {
  name Dot3
  note_font_size 41
  xpos -367
  ypos 675
 }
set N91f98190 [stack 0]
 Dot {
  name Dot8
  note_font_size 41
  xpos -463
  ypos 675
 }
 Dot {
  name Dot15
  note_font_size 41
  xpos -463
  ypos 831
 }
push $N91f88520
 Dot {
  name Dot1
  note_font_size 41
  xpos 461
  ypos -802
 }
 Remove {
  operation keep
  channels rgba
  name Remove1
  xpos 427
  ypos -718
 }
 Dot {
  name Dot21
  note_font_size 41
  xpos 461
  ypos -597
 }
set N91bc4c30 [stack 0]
 Invert {
  name Invert1
  xpos 695
  ypos -604
  disable {{"parent.size < 0 ? 0 : 1"}}
 }
set N91bc8a50 [stack 0]
 Dot {
  name Dot4
  note_font_size 41
  xpos 540
  ypos -543
 }
 NoOp {
  name Original
  xpos 506
  ypos -327
 }
set N91bd69b0 [stack 0]
 Dot {
  name Dot5
  note_font_size 41
  xpos 540
  ypos 14
 }
 Crop {
  inputs 0
  box {{"!\[exists parent.input0] ? 0 : input.format.x"} {"!\[exists parent.input0] ? 0 : input.format.y"} {"!\[exists parent.input0] ? 0 : input.format.r"} {"!\[exists parent.input0] ? 0 : input.format.t"}}
  reformat true
  crop false
  name Crop1
  xpos 210
  ypos -750
  addUserKnob {20 User}
  addUserKnob {22 cropToBbox l "Crop to Bounding Box" -STARTLINE T codeBBox()}
 }
 AddChannels {
  channels rgba
  name AddChannels2
  xpos 210
  ypos -724
 }
push $N91f88520
 Merge2 {
  inputs 2
  name Merge3
  label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
  xpos 83
  ypos -671
 }
 NoOp {
  name BBoxInput
  xpos 83
  ypos -628
  addUserKnob {20 User}
  addUserKnob {15 bbox}
  bbox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
 }
push $N91bd69b0
 Input {
  inputs 0
  name Inputarea
  xpos 289
  ypos -638
  number 2
 }
 AddChannels {
  channels alpha
  color 1
  name AddChannels1
  xpos 289
  ypos -580
 }
 Invert {
  channels rgba
  name Invert3
  xpos 289
  ypos -503
 }
push $N91bc8a50
 Multiply {
  inputs 1+1
  value 0
  name Multiply1
  label "\[value value]"
  xpos 695
  ypos -512
 }
 NoOp {
  name Start
  xpos 695
  ypos -450
 }
set N91732800 [stack 0]
 Blur {
  size {{(Blur1.size)*(mult)**3} {(Blur1.size)*(mult)**3}}
  crop false
  name Blur4
  label "\[value size]"
  xpos 995
  ypos -370
 }
push $N91732800
 Blur {
  size {{(Blur1.size)*(mult)**2} {(Blur1.size)*(mult)**2}}
  crop false
  name Blur3
  label "\[value size]"
  xpos 895
  ypos -370
 }
push 0
push $N91732800
 Blur {
  size {{(Blur1.size)*(mult)**1} {(Blur1.size)*(mult)**1}}
  crop false
  name Blur2
  label "\[value size]"
  xpos 795
  ypos -370
 }
push $N91732800
 Blur {
  size {{parent.size.w} {parent.size.h}}
  name Blur1
  label "\[value size]"
  xpos 695
  ypos -370
 }
 Merge2 {
  inputs 5+1
  operation {{mergeNumber.mergeNumber}}
  also_merge all
  name Merge1
  label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
  xpos 695
  ypos -273
 }
 NoOp {
  name End
  xpos 695
  ypos -230
 }
set N91770f70 [stack 0]
 CopyBBox {
  inputs 2
  name CopyBBox1
  xpos 585
  ypos -175
 }
 Group {
  name BBoxToFormat
  onCreate "n = nuke.thisNode()\ninputFormat = n.knob(\"inputFormat\")\ninputBBox = n.knob(\"inputBBox\")\ncrop = nuke.toNode(\"Crop6\")\ncropb = crop.knob('box')\noutputBBox = n.knob('outputBBox')\noutputBBoxCenter = n.knob(\"outputBBoxCenter\")\n\ninputFormat.setFlag(0x0000000000008000)\ninputBBox.setFlag(0x0000000000008000)\ncropb.setFlag(0x0000000000008000)\noutputBBox.setFlag(0x0000000000008000)\noutputBBoxCenter.setFlag(0x0000000000008000)\n\nn = nuke.thisNode()\nn.knob(\"overscan\").setRange(0,400)\nn.knob(\"overscanPercent\").setRange(1,4)"
  tile_color 0xa57aaaff
  note_font "Verdana Bold Bold Bold Bold Bold Bold Bold Bold Bold"
  note_font_color 0xffffffff
  xpos 585
  ypos -151
  addUserKnob {20 CropBBox}
  addUserKnob {4 type l Type +INVISIBLE M {"To Format" "To BBox"}}
  addUserKnob {41 intersect T Crop6.intersect}
  addUserKnob {6 blackOutside l "Black Outside" -STARTLINE}
  addUserKnob {4 overscanType l "Overscan Type:" M {Pixels Percentage}}
  overscanType {{parent.safetyBBoxMethod}}
  addUserKnob {14 overscan l Overscan R 0 400}
  overscan {{parent.safeBBoxPixels} {parent.safeBBoxPixels}}
  addUserKnob {14 overscanPercent l "Overscan Percent" R 1 4}
  overscanPercent {{parent.safeBBoxPercent} {parent.safeBBoxPercent}}
  addUserKnob {20 inputBbox l "BBox Data" n 1}
  addUserKnob {15 inputFormat l "Input Format"}
  inputFormat {0 0 {input.width} {input.height}}
  addUserKnob {15 inputBBox l "Input BBox"}
  inputBBox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
  addUserKnob {12 outputBBoxCenter l OutputBBoxCenter}
  outputBBoxCenter {{OutputBBox1.outputBBoxCenter.w} {OutputBBox1.outputBBoxCenter.h}}
  addUserKnob {15 outputBBox l "Output BBox"}
  outputBBox {{OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox}}
  addUserKnob {20 endGroup n -1}
  addUserKnob {20 info_1 l Info}
  addUserKnob {26 creator l Creator: T "<b><big>Tony Lyons"}
  addUserKnob {26 desc l Description: t "crop to inputformat\n\ndisplays values of input bbox" T CropBBox}
  addUserKnob {26 ver l Version: T v02}
 }
  Input {
   inputs 0
   name Input
   xpos 261
   ypos 394
  }
  Dot {
   name Dot2
   note_font_size 41
   xpos 295
   ypos 462
  }
set N93015e30 [stack 0]
  Dot {
   name Dot1
   note_font_size 41
   xpos -160
   ypos 462
  }
set N93019d50 [stack 0]
push $N93015e30
  Crop {
   box {{parent.inputBBox} {parent.inputBBox} {parent.inputBBox} {parent.inputBBox}}
   crop {{parent.blackOutside}}
   name Crop6
   xpos 261
   ypos 510
   addUserKnob {20 User}
   addUserKnob {22 cropToBbox l "Crop to Bounding Box" -STARTLINE T codeBBox()}
  }
set N9301dc30 [stack 0]
  Remove {
   operation keep
   channels none
   name Remove1
   xpos 120
   ypos 504
  }
set N930274e0 [stack 0]
  Transform {
   scale {{parent.overscanPercent} {parent.overscanPercent}}
   center {{((input.bbox.r-input.bbox.x)/2)+input.bbox.x} {((input.bbox.t-input.bbox.y)/2)+input.bbox.y}}
   shutteroffset centred
   name Transform1
   selected true
   xpos 120
   ypos 553
  }
push $N930274e0
  AdjBBox {
   numpixels {{parent.overscan} {parent.overscan}}
   name AdjBBox1
   xpos -5
   ypos 510
  }
  Switch {
   inputs 2
   which {{overscanType}}
   name Switch2
   label "\[value which]"
   xpos -5
   ypos 549
  }
  Merge2 {
   inputs 2
   bbox intersection
   Achannels {-rgba.red -rgba.green -rgba.blue rgba.alpha}
   Bchannels {-rgba.red -rgba.green -rgba.blue rgba.alpha}
   output {-rgba.red -rgba.green -rgba.blue rgba.alpha}
   name Merge1
   xpos -5
   ypos 647
   disable {{!parent.Crop6.intersect}}
  }
push $N93019d50
  CopyBBox {
   inputs 2
   name CopyBBox1
   xpos -194
   ypos 653
  }
  BlackOutside {
   name BlackOutside1
   xpos -194
   ypos 692
   disable {{!parent.blackOutside}}
  }
  Dot {
   name Dot4
   note_font_size 41
   xpos -160
   ypos 769
  }
push $N9301dc30
  Switch {
   inputs 2
   which {{"overscanType == 0 ? overscan.w != 0 || overscan.h != 0 : overscanPercent.w != 1 || overscanPercent.h != 1 ? 1 : 0"}}
   name Switch1
   label "\[value which]"
   xpos 261
   ypos 759
  }
set N930656d0 [stack 0]
  Output {
   name Output1
   xpos 261
   ypos 921
  }
push $N930656d0
  NoOp {
   name OutputBBox1
   xpos 378
   ypos 821
   addUserKnob {20 User}
   addUserKnob {15 OutputBBox l "Output BBox"}
   OutputBBox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
   addUserKnob {14 outputBBoxCenter l "Output BBox Center" R 0 100}
   outputBBoxCenter {{OutputBBox.x+(OutputBBox.r-OutputBBox.x)/2} {OutputBBox.y+(OutputBBox.t-OutputBBox.y)/2}}
  }
 end_group
push $N91770f70
 Merge2 {
  inputs 2
  bbox intersection
  also_merge all
  name Merge4
  xpos 585
  ypos -127
 }
push $N91770f70
 CopyBBox {
  inputs 2
  name CopyBBox2
  xpos 585
  ypos -101
 }
push $N91770f70
 Switch {
  inputs 2
  which {{"parent.safeBBox && ((BBoxResult.bbox.x < BBoxInput.bbox.x || BBoxResult.bbox.y < BBoxInput.bbox.y || BBoxResult.bbox.r > BBoxInput.bbox.r || BBoxResult.bbox.t > BBoxInput.bbox.t))"}}
  name Switch2
  label "\[value which]"
  xpos 695
  ypos -106
 }
 Grade {
  channels all
  whitepoint 5
  black_clamp false
  name AverageMult
  xpos 695
  ypos -37
  disable {{"output2 == 4 ? 0 : 1"}}
 }
 Merge2 {
  inputs 2
  operation max
  also_merge all
  name Merge2
  label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
  xpos 695
  ypos 10
  disable {{"output2 == 4 && includeOriginal == 1 && AvgMaxOriginal == 1 ? 0 : 1"}}
 }
 Clamp {
  name Clamp1
  selected true
  xpos 695
  ypos 50
  disable {{!parent.clamp}}
 }
 Blur {
  size {{postBlur} {postBlur}}
  name BlurOriginal
  label "\[value size]"
  xpos 695
  ypos 102
 }
 Invert {
  name Invert2
  xpos 695
  ypos 144
  disable {{"parent.size < 0 ? 0 : 1"}}
 }
push $N91bc4c30
 Switch {
  inputs 2
  which {{"parent.size == 0 ? 0 : 1"}}
  name Switch1
  label "\[value which]"
  xpos 427
  ypos 190
 }
 Dot {
  name Dot17
  label A
  note_font_size 41
  xpos 34
  ypos 455
 }
 Dot {
  name Dot7
  note_font_size 41
  xpos 34
  ypos 579
 }
set N930d4c80 [stack 0]
 Dot {
  name Dot12
  note_font_size 41
  xpos -260
  ypos 579
 }
 Dot {
  name Dot13
  note_font_size 41
  xpos -260
  ypos 799
 }
push $N91f94210
 Input {
  inputs 0
  name Inputmask
  xpos 512
  ypos 322
  number 1
 }
 Dot {
  name Dot19
  label Mask
  note_font_size 41
  xpos 546
  ypos 435
 }
set N930e4780 [stack 0]
 Dot {
  name Dot20
  note_font_size 41
  xpos 436
  ypos 435
 }
push $N930d4c80
 Merge2 {
  inputs 2
  bbox intersection
  Achannels {rgba.red -rgba.green -rgba.blue rgba.alpha}
  Bchannels {rgba.red -rgba.green -rgba.blue rgba.alpha}
  output {rgba.red -rgba.green -rgba.blue rgba.alpha}
  name MergeIntersection
  xpos 402
  ypos 572
  disable {{"!\[exists parent.input1]"}}
 }
 Merge2 {
  inputs 2
  Achannels {rgba.red -rgba.green -rgba.blue rgba.alpha}
  Bchannels {rgba.red -rgba.green -rgba.blue rgba.alpha}
  output {rgba.red -rgba.green -rgba.blue rgba.alpha}
  name MergeUnion
  xpos 402
  ypos 610
  disable {{"!\[exists parent.input1]"}}
 }
 Dot {
  name Dot6
  label "intersection\nof (Mask and A) + B"
  note_font_size 14
  note_font_color 0xffffffff
  xpos 436
  ypos 770
 }
push $N930e4780
 Dot {
  name Dot10
  note_font_size 41
  xpos 546
  ypos 672
 }
push $N930d4c80
push $N91f98190
 Merge2 {
  inputs 2+1
  operation copy
  Achannels none
  Bchannels none
  output none
  also_merge {{{parent.Remove1.channels}}}
  name MergeKeymix
  xpos 0
  ypos 665
 }
 Dot {
  name Dot14
  note_font_size 41
  xpos 34
  ypos 747
 }
set N93120630 [stack 0]
push $N91f98190
 CopyBBox {
  inputs 2
  name CopyBBoxUnion
  xpos -401
  ypos 743
  disable {{parent.bbox==0?0:1}}
 }
 CopyBBox {
  inputs 2
  name CopyBBoxIntersection
  xpos -401
  ypos 769
  disable {{"parent.bbox==1 ? 0 : 1"}}
 }
 CopyBBox {
  inputs 2
  name CopyBBoxA
  xpos -401
  ypos 795
  disable {{"parent.bbox==2 ? 0 : 1"}}
 }
 CopyBBox {
  inputs 2
  name CopyBBoxB
  xpos -401
  ypos 827
  disable {{"parent.bbox==3 ? 0 : 1"}}
 }
 Crop {
  box {0 0 {parent.width} {parent.height}}
  crop false
  name CopyBBoxFormat
  xpos -401
  ypos 853
  disable {{"parent.bbox==4 ? 0 : 1"}}
  addUserKnob {20 User}
  addUserKnob {22 cropToBbox l "Crop to Bounding Box" -STARTLINE T codeBBox()}
 }
set N9313e4c0 [stack 0]
 Transform {
  scale {{parent.adjustBBoxPercent} {parent.adjustBBoxPercent}}
  center {{((input.bbox.r-input.bbox.x)/2)+input.bbox.x} {((input.bbox.t-input.bbox.y)/2)+input.bbox.y}}
  black_outside false
  shutteroffset centred
  name TransformBBoxAdjustPercent
  xpos -516
  ypos 898
 }
push $N9313e4c0
 AdjBBox {
  numpixels {{parent.adjustBBoxPixels} {parent.adjustBBoxPixels}}
  name AdjBBoxPixels
  xpos -401
  ypos 901
 }
 Switch {
  inputs 2
  which {{adjustBBoxExtra}}
  name Switch3
  xpos -401
  ypos 940
 }
 Dot {
  name Dot9
  note_font_size 41
  xpos -367
  ypos 993
 }
push $N93120630
 CopyBBox {
  inputs 2
  name CopyBBox
  xpos 0
  ypos 989
 }
 BlackOutside {
  name BlackOutside1
  xpos 0
  ypos 1015
  disable {{!parent.blackOutside}}
 }
 Output {
  name Output1
  xpos 0
  ypos 1155
 }
 NoOp {
  inputs 0
  name mergeNumber
  xpos 229
  ypos -862
  addUserKnob {20 User}
  addUserKnob {3 mergeNumber}
  mergeNumber {{"output2 == 0 ? 25 : output2 == 1 ? 24 : output2 == 2 ? 22 : output2 == 3 ? 13 : output2 == 4 ? 24 : output2 == 5 ? 17 : 18"}}
 }
push $N91770f70
 NoOp {
  name BBoxResult
  xpos 585
  ypos -230
  addUserKnob {20 User}
  addUserKnob {15 bbox}
  bbox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
 }
end_group
Unpremult {
 name Unpremult6
 selected true
 xpos 1845
 ypos -1964
}
Dot {
 name Dot47
 label "final level,\nfill rest of \nscreen"
 note_font_size 20
 selected true
 xpos 1879
 ypos -1892
}
Dot {
 name Dot18
 note_font_size 41
 selected true
 xpos 1879
 ypos -1802
}
set N91fab100 [stack 0]
Dot {
 name Dot19
 note_font_size 41
 selected true
 xpos 3127
 ypos -1802
}
Dot {
 name Dot16
 label Cleanplate
 note_font_size 60
 selected true
 xpos 3127
 ypos -1439
}
Dot {
 name Dot49
 label Cleanplate
 note_font_size 60
 selected true
 xpos 3127
 ypos -722
}
Dot {
 name Dot53
 label Cleanplate
 note_font_size 60
 selected true
 xpos 3127
 ypos 675
}
add_layer {cleanplate cleanplate.red cleanplate.green cleanplate.blue cleanplate.alpha}
Shuffle {
 black red
 white green
 red2 blue
 green2 black
 out2 cleanplate
 name Shuffle34
 label "\[value in] → \[value out2]"
 selected true
 xpos -1297
 ypos 665
}
push $N919a9e60
Remove {
 operation keep
 channels rgb
 name Remove31
 selected true
 xpos 339
 ypos -2878
}
Dot {
 name Dot13
 note_font_size 41
 selected true
 xpos 373
 ypos -2577
}
Primatte3 {
 data { 5
    11757 12586 28017
    65552
    0 5
    30234 30234 30234 0
    131.703 115.29 2282.26 72.2175 59.1462 2129.06 939.83 259.302 51.8183 549.229 904.755 276.263 92.3108 578.039 120.609 234.956 234.82 146.119 237.546 743.532 100.669 573.049 43.009 63.2739 116.749 6215.42 168.03 1762.74 3864.11 55.7825 120.53 782.613 3846.16 137.667 121.352 101.794 8606.14 147.362 77.5146 198.503 573.917 81.358 1101.7 522.226 871.183 109.573 110.87 144.688 126.765 33.3146 34.0749 5144.71 4299.28 18477.9 96.8055 90.0376 231.86 11773.6 405.26 440.61 169.247 274.68 242.589 111.212 102.975 105.83
    130560 130560 130560 130560 130560 15703.5 22545.4 21185 130560 130560 26795.2 130560 130560 130560 130560 81679.3 130560 130560 111296 64686.9 112021 18414.1 130560 130560 130560 130560 60434.8 12591.6 24709.3 130560 130560 130560 130560 130560 130560 130560 16795 130560 130560 130560 130560 130560 12274.2 18220.6 15075.8 130560 130560 27876.9 130560 130560 130560 58272.4 87806.9 130560 78064.5 130560 28962.9 23001.1 130560 130560 130560 130560 130560 130560 130560 130560
    130560 130560 130560 130560 130560 15703.5 22545.4 21185 130560 130560 26795.2 130560 130560 130560 130560 81679.3 130560 130560 111296 64686.9 112021 18414.1 130560 130560 130560 130560 60434.8 12591.6 24709.3 130560 130560 130560 130560 130560 130560 130560 16795 130560 130560 130560 130560 130560 12274.2 18220.6 15075.8 130560 130560 27876.9 130560 130560 130560 58272.4 87806.9 130560 78064.5 130560 28962.9 23001.1 130560 130560 130560 130560 130560 130560 130560 130560
    -173008 -2.22551e+14 -2.22551e+14 -1.75797e+08 3.24562e+13 3.24562e+13
    -88728 -2.22551e+14 -2.22551e+14 -3.33563e+07 2.59518e+13 2.59518e+13
    -49917.5 -1.9095e+14 -1.9095e+14 2.99695e+07 1.24769e+13 1.24769e+13
    -275696 -1.62776e+14 -1.62776e+14 5.27411e+07 -2.14449e+12 -2.14449e+12
    -95526 -2.22551e+14 -2.22551e+14 1.29744e+07 1.69562e+13 1.69562e+13
    -48985 -2.22551e+14 -2.22551e+14 3.80106e+07 1.04518e+13 1.04518e+13
    -57891.4 -2.22551e+14 -2.22551e+14 2.42861e+07 -2.59518e+13 -2.59518e+13
    -319741 -1.89714e+14 -1.89714e+14 3.3319e+06 -3.70182e+13 -3.70182e+13
    -1.46426e+06 -4.06321e+14 -4.06321e+14 -6.42384e+08 6.71983e+13 6.71983e+13
    -8.55972e+07 -7.25395e+12 -7.25395e+12 -4.66618e+09 1.27042e+13 1.27042e+13
    -3.9253e+06 -1.98547e+12 -1.98547e+12 2.63799e+08 1.83081e+12 1.83081e+12
    -1.11147e+08 -4.01415e+12 -4.01415e+12 -2.18771e+09 8.80462e+12 8.80462e+12
    -3.71416e+06 -4.06321e+14 -4.06321e+14 8.76061e+08 -4.9151e+13 -4.9151e+13
    -282796 -4.06321e+14 -4.06321e+14 -4.12997e+07 -2.48811e+13 -2.48811e+13
    -20396 -4.06321e+14 -4.06321e+14 -2.03765e+07 -3.23759e+12 -3.23759e+12
    -1.15164e+10 -4.06321e+14 -4.06321e+14 1.17853e+09 -1.03268e+14 -1.03268e+14
    -4.34651e+09 -5.76078e+12 -5.76078e+12 -1.28057e+10 9.10482e+12 9.10482e+12
    -258688 -2.42948e+14 -2.42948e+14 3.95126e+07 8.78112e+13 8.78112e+13
    -65592 -4.06321e+14 -4.06321e+14 -3.43375e+07 2.48811e+13 2.48811e+13
    -2.98885e+07 -8.74202e+11 -8.74202e+11 -8.66012e+08 3.03045e+11 3.03045e+11
    -562448 -4.06321e+14 -4.06321e+14 1.75345e+08 3.90796e+13 3.90796e+13
    -1.70271e+06 -4.06321e+14 -4.06321e+14 6.26216e+07 -6.09506e+13 -6.09506e+13
    -7.9007e+07 -4.06321e+14 -4.06321e+14 1.52156e+10 -9.14682e+13 -9.14682e+13
    -6.56372e+08 -1.55159e+13 -1.55159e+13 3.2503e+10 -6.35202e+12 -6.35202e+12
    -3.37791e+08 -9.2413e+13 -9.2413e+13 -6.93039e+08 1.39767e+14 1.39767e+14
    -4.78643e+06 -1.42796e+13 -1.42796e+13 -4.03005e+08 1.74249e+13 1.74249e+13
    -1.03233e+06 -1.12003e+14 -1.12003e+14 -9.588e+07 3.48023e+13 3.48023e+13
    -2.04677e+08 -1.16868e+12 -1.16868e+12 -2.39029e+08 -1.34758e+11 -1.34758e+11
    -893296 -5.24559e+14 -5.24559e+14 -1.53781e+08 -2.95997e+13 -2.95997e+13
    -1.60356e+06 -5.24559e+14 -5.24559e+14 3.18342e+08 -9.64026e+13 -9.64026e+13
    -93988 -5.24559e+14 -5.24559e+14 5.9775e+07 -6.27891e+13 -6.27891e+13
    -1.29519e+10 -2.34124e+14 -2.34124e+14 -4.53767e+10 -4.78306e+13 -4.78306e+13
    -3.44886e+06 -4.06321e+14 -4.06321e+14 -2.18227e+08 6.80597e+13 6.80597e+13
    -569166 -2.54198e+14 -2.54198e+14 -6.19316e+07 1.15759e+14 1.15759e+14
    -528400 -5.65689e+13 -5.65689e+13 -1.74988e+08 1.30936e+14 1.30936e+14
    -2.1286e+07 -8.34717e+12 -8.34717e+12 -2.10171e+09 1.4745e+13 1.4745e+13
    -596176 -4.06321e+14 -4.06321e+14 8.40006e+07 -6.96482e+12 -6.96482e+12
    -230817 -4.06321e+14 -4.06321e+14 7.04665e+06 4.11041e+11 4.11041e+11
    -13557 -4.06321e+14 -4.06321e+14 -1.20581e+07 -2.85297e+13 -2.85297e+13
    -5.03316e+07 -2.73268e+14 -2.73268e+14 1.43263e+10 -8.80179e+13 -8.80179e+13
    -31228 -2.22551e+14 -2.22551e+14 1.80443e+07 3.12724e+13 3.12724e+13
    -3.22987e+09 -3.32092e+11 -3.32092e+11 -1.44559e+10 3.46322e+11 3.46322e+11
    -4.71444e+08 -7.14508e+11 -7.14508e+11 -2.14529e+10 9.18671e+11 9.18671e+11
    -1.64549e+06 -5.10403e+13 -5.10403e+13 5.42704e+07 2.07275e+13 2.07275e+13
    -1.02509e+08 -2.22551e+14 -2.22551e+14 7.44013e+09 -4.10238e+13 -4.10238e+13
    -220020 -2.22551e+14 -2.22551e+14 -1.17411e+07 -2.43094e+13 -2.43094e+13
    -55078 -2.22551e+14 -2.22551e+14 2.67342e+07 8.80939e+12 8.80939e+12
    -5.45586e+09 -2.22551e+14 -2.22551e+14 1.99278e+10 -5.44912e+13 -5.44912e+13
    -2.29466e+09 -1.35475e+13 -1.35475e+13 -2.18582e+10 2.0952e+13 2.0952e+13
    -2.68691e+06 -2.30801e+13 -2.30801e+13 -2.93389e+08 2.81856e+13 2.81856e+13
    -308272 -4.06321e+14 -4.06321e+14 -5.18663e+07 7.27645e+13 7.27645e+13
    -3.20791e+08 -7.56085e+11 -7.56085e+11 -6.62225e+09 2.06047e+12 2.06047e+12
    -343800 -4.06321e+14 -4.06321e+14 -1.00216e+08 -8.80379e+12 -8.80379e+12
    -4.51419e+07 -4.06321e+14 -4.06321e+14 1.08829e+10 -8.96585e+13 -8.96585e+13
    -1.672e+06 -4.06321e+14 -4.06321e+14 4.73304e+08 -6.27603e+13 -6.27603e+13
    -7.47418e+07 -1.81352e+14 -1.81352e+14 1.88562e+10 -9.12369e+13 -9.12369e+13
    -2.64224e+08 -5.78142e+13 -5.78142e+13 2.05357e+09 8.43729e+13 8.43729e+13
    -247784 -3.13644e+14 -3.13644e+14 6.70985e+07 3.07649e+13 3.07649e+13
    -148368 -5.24559e+14 -5.24559e+14 -7.90006e+07 3.45854e+13 3.45854e+13
    -3.51635e+07 -1.11673e+12 -1.11673e+12 1.67142e+09 1.17381e+12 1.17381e+12
    -2.57304e+06 -5.24559e+14 -5.24559e+14 -9.17211e+06 3.22175e+13 3.22175e+13
    -394416 -5.24559e+14 -5.24559e+14 -5.42436e+07 -5.93409e+13 -5.93409e+13
    -546688 -5.24559e+14 -5.24559e+14 4.73626e+08 -9.98509e+13 -9.98509e+13
    -4.89972e+09 -2.71902e+13 -2.71902e+13 1.48134e+11 2.4441e+13 2.4441e+13
    -2.5618e+06 -2.54198e+14 -2.54198e+14 -1.04936e+08 1.03768e+14 1.03768e+14
    -201818 -4.06321e+14 -4.06321e+14 5.25342e+07 2.85297e+13 2.85297e+13
    -45108 -4.06322e+14 -4.06322e+14 -4.66993e+07 -4.1103e+11 -4.1103e+11
    -2.48883e+06 -7.8946e+12 -7.8946e+12 -5.29195e+08 1.28701e+13 1.28701e+13
    -2.3376e+06 -4.06321e+14 -4.06321e+14 3.09963e+08 3.99409e+13 3.99409e+13
    -223498 -4.06321e+14 -4.06321e+14 7.31205e+07 -1.87645e+13 -1.87645e+13
    -390016 -4.06321e+14 -4.06321e+14 3.14765e+08 -7.54355e+13 -7.54355e+13
    -1.75239e+08 -4.02259e+13 -4.02259e+13 2.96184e+10 -9.17516e+12 -9.17516e+12
    -1.23968e+06 -4.06321e+14 -4.06321e+14 -7.37413e+08 8.53962e+13 8.53962e+13
    -6.75126e+07 -1.7841e+12 -1.7841e+12 6.61983e+09 4.41779e+12 4.41779e+12
    -2.81985e+07 -1.64193e+13 -1.64193e+13 -4.24373e+09 1.39135e+13 1.39135e+13
    -2.41807e+07 -4.45722e+12 -4.45722e+12 -4.99349e+09 4.6435e+11 4.6435e+11
    -3.19968e+06 -4.06321e+14 -4.06321e+14 1.31085e+09 -5.01286e+13 -5.01286e+13
    -1.53757e+06 -4.06321e+14 -4.06321e+14 3.53143e+08 -7.27645e+13 -7.27645e+13
    -69220 -4.06321e+14 -4.06321e+14 -5.92075e+07 -2.14355e+13 -2.14355e+13
    -7.50032e+09 -4.06321e+14 -4.06321e+14 2.5079e+10 -1.0229e+14 -1.0229e+14
    -7.0802e+09 -6.51685e+11 -6.51685e+11 -4.88213e+10 6.56937e+11 6.56937e+11
    -268558 -1.03017e+14 -1.03017e+14 -4.2673e+07 7.70381e+13 7.70381e+13
    -25490 -2.22551e+14 -2.22551e+14 1.22614e+07 2.43094e+13 2.43094e+13
    -2.15065e+08 -3.64106e+11 -3.64106e+11 -9.26604e+09 4.80813e+11 4.80813e+11
    -67472 -2.22551e+14 -2.22551e+14 3.92834e+07 1.57724e+13 1.57724e+13
    -5.0378e+08 -2.22551e+14 -2.22551e+14 2.33334e+10 -4.75282e+13 -4.75282e+13
    -1.11016e+09 -2.22551e+14 -2.22551e+14 3.32117e+10 -4.79868e+13 -4.79868e+13
    -1.34809e+06 -1.10265e+14 -1.10265e+14 1.86729e+08 -4.9724e+13 -4.9724e+13
    -9.88307e+06 -5.24559e+14 -5.24559e+14 -1.68476e+08 1.06099e+14 1.06099e+14
    -1.15611e+06 -7.27994e+13 -7.27994e+13 -1.41131e+08 4.05615e+13 4.05615e+13
    -980442 -1.81738e+13 -1.81738e+13 6.90831e+07 2.48541e+13 2.48541e+13
    -1.00781e+08 -1.4597e+12 -1.4597e+12 2.29401e+09 1.12587e+12 1.12587e+12
    -2.29498e+06 -5.24559e+14 -5.24559e+14 -3.61518e+08 -2.83376e+13 -2.83376e+13
    -309804 -5.24559e+14 -5.24559e+14 -4.70927e+07 -3.45854e+13 -3.45854e+13
    -13865 -5.24559e+14 -5.24559e+14 -1.27731e+07 -3.92958e+13 -3.92958e+13
    -1.0284e+10 -3.52787e+14 -3.52787e+14 -7.83663e+10 -8.20847e+13 -8.20847e+13
    -1.93585e+06 -3.63425e+14 -3.63425e+14 -9.27423e+07 6.22805e+13 6.22805e+13
    -220555 -3.63425e+14 -3.63425e+14 1.51874e+06 4.55258e+13 4.55258e+13
    -78392 -3.1182e+14 -3.1182e+14 -7.74062e+07 -1.10039e+13 -1.10039e+13
    -2.03932e+06 -3.70959e+13 -3.70959e+13 2.23079e+08 6.12195e+13 6.12195e+13
    -724400 -3.63425e+14 -3.63425e+14 -1.4328e+08 2.23541e+13 2.23541e+13
    -139264 -3.63425e+14 -3.63425e+14 9.41002e+06 5.59947e+12 5.59947e+12
    -27318 -3.63425e+14 -3.63425e+14 9.57975e+06 -4.55258e+13 -4.55258e+13
    -1.94705e+07 -2.08354e+14 -2.08354e+14 2.87003e+09 -7.34549e+13 -7.34549e+13
    -311128 -3.63425e+14 -3.63425e+14 -1.32985e+08 6.06356e+13 6.06356e+13
    -5.74384e+08 -1.0002e+12 -1.0002e+12 -4.02646e+10 1.6823e+12 1.6823e+12
    -5.23187e+07 -2.07128e+12 -2.07128e+12 -7.35669e+09 1.98585e+12 1.98585e+12
    -1.77738e+07 -9.62428e+12 -9.62428e+12 3.19403e+09 1.67449e+13 1.67449e+13
    -1.77928e+07 -3.63425e+14 -3.63425e+14 2.32491e+09 -5.82066e+13 -5.82066e+13
    -288718 -3.63425e+14 -3.63425e+14 -2.6594e+07 -4.26996e+13 -4.26996e+13
    -42434 -3.63425e+14 -3.63425e+14 -5.17523e+07 2.77326e+12 2.77326e+12
    -7.2133e+10 -3.63425e+14 -3.63425e+14 -1.86415e+11 -9.28972e+13 -9.28972e+13
    -6.39369e+10 -1.55874e+12 -1.55874e+12 2.07376e+11 2.35973e+12 2.35973e+12
    -322348 -1.00585e+14 -1.00585e+14 6.49868e+07 2.64138e+13 2.64138e+13
    -63157 -3.63425e+14 -3.63425e+14 1.4609e+07 4.26996e+13 4.26996e+13
    -1.81731e+08 -4.64739e+11 -4.64739e+11 6.90731e+09 2.44935e+11 2.44935e+11
    -258224 -3.63425e+14 -3.63425e+14 1.39737e+08 2.07093e+13 2.07093e+13
    -4.00876e+07 -3.63425e+14 -3.63425e+14 7.19011e+09 -7.49612e+13 -7.49612e+13
    -1.00694e+08 -3.63425e+14 -3.63425e+14 1.36334e+10 -7.61426e+13 -7.61426e+13
    -8.5995e+07 -8.03662e+13 -8.03662e+13 3.33733e+09 -3.52808e+13 -3.52808e+13
    -5.72174e+08 -1.06709e+14 -1.06709e+14 -4.20627e+09 1.65952e+14 1.65952e+14
    -550016 -8.03413e+13 -8.03413e+13 -6.2677e+07 1.01651e+14 1.01651e+14
    -478394 -1.2933e+14 -1.2933e+14 2.00402e+07 2.06147e+14 2.06147e+14
    -1.36416e+08 -9.17634e+11 -9.17634e+11 -5.28366e+09 1.40665e+12 1.40665e+12
    -3.06936e+06 -6.05708e+14 -6.05708e+14 9.28682e+07 -1.04378e+13 -1.04378e+13
    -329860 -6.05708e+14 -6.05708e+14 -3.99497e+07 -7.72407e+13 -7.72407e+13
    -39166 -6.05708e+14 -6.05708e+14 2.21804e+07 -8.19511e+13 -8.19511e+13
    -1.11235e+11 -1.81817e+14 -1.81817e+14 -1.17571e+11 -3.81741e+13 -3.81741e+13
    -1 -1 -1 -1
    -1 -1 999999 999999
    -1 -1 -1 -1
    0.05 1.732 1.732
    0.05 1.732 1.732
    0.05 0.866 0.866
    0.05 0.866 0.866
    0.05 0.866 0.866
    0.05 0.866 0.866
    0.05 0.866 0.866
    0.05 0.866 0.866
  }

 primEdgedata { 5
    11757 12586 28017
    65552
    0 5
    30234 30234 30234 0
    131.703 115.29 2282.26 72.2175 59.1462 2129.06 939.83 259.302 51.8183 549.229 904.755 276.263 92.3108 578.039 120.609 234.956 234.82 146.119 237.546 743.532 100.669 573.049 43.009 63.2739 116.749 6215.42 168.03 1762.74 3864.11 55.7825 120.53 782.613 3846.16 137.667 121.352 101.794 8606.14 147.362 77.5146 198.503 573.917 81.358 1101.7 522.226 871.183 109.573 110.87 144.688 126.765 33.3146 34.0749 5144.71 4299.28 18477.9 96.8055 90.0376 231.86 11773.6 405.26 440.61 169.247 274.68 242.589 111.212 102.975 105.83
    130560 130560 130560 130560 130560 15703.5 22545.4 21185 130560 130560 26795.2 130560 130560 130560 130560 81679.3 130560 130560 111296 64686.9 112021 18414.1 130560 130560 130560 130560 60434.8 12591.6 24709.3 130560 130560 130560 130560 130560 130560 130560 18167.2 130560 130560 130560 130560 130560 12274.2 18220.6 15075.8 130560 130560 27876.9 130560 130560 130560 58272.4 87806.9 130560 78064.5 130560 28962.9 31419.7 130560 130560 130560 130560 130560 130560 130560 130560
    130560 130560 130560 130560 130560 15703.5 22545.4 21185 130560 130560 26795.2 130560 130560 130560 130560 81679.3 130560 130560 111296 64686.9 112021 18414.1 130560 130560 130560 130560 60434.8 12591.6 24709.3 130560 130560 130560 130560 130560 130560 130560 18167.2 130560 130560 130560 130560 130560 12274.2 18220.6 15075.8 130560 130560 27876.9 130560 130560 130560 58272.4 87806.9 130560 78064.5 130560 28962.9 31419.7 130560 130560 130560 130560 130560 130560 130560 130560
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    -1 -1 -1 -1
    -1 -1 999999 999999
    -1 -1 -1 -1
    0.05 1.732 1.732
    0.05 1.732 1.732
    0.05 0.866 0.866
    0.05 0.866 0.866
    0.05 0.866 0.866
    0.05 0.866 0.866
    0.05 0.866 0.866
    0.05 0.866 0.866
  }

 primBodydata { 5
    11757 12586 28017
    65552
    0 5
    30234 30234 30234 0
    1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
    130560 130560 130560 130560 130560 15703.5 22545.4 21185 130560 130560 26795.2 130560 130560 130560 130560 81679.3 130560 130560 111296 64686.9 112021 18414.1 130560 130560 130560 130560 60434.8 12591.6 24709.3 130560 130560 130560 130560 130560 130560 130560 16795 130560 130560 130560 130560 130560 12274.2 18220.6 15075.8 130560 130560 27876.9 130560 130560 130560 58272.4 87806.9 130560 78064.5 130560 28962.9 23001.1 130560 130560 130560 130560 130560 130560 130560 130560
    130560 130560 130560 130560 130560 15703.5 22545.4 21185 130560 130560 26795.2 130560 130560 130560 130560 81679.3 130560 130560 111296 64686.9 112021 18414.1 130560 130560 130560 130560 60434.8 12591.6 24709.3 130560 130560 130560 130560 130560 130560 130560 16795 130560 130560 130560 130560 130560 12274.2 18220.6 15075.8 130560 130560 27876.9 130560 130560 130560 58272.4 87806.9 130560 78064.5 130560 28962.9 23001.1 130560 130560 130560 130560 130560 130560 130560 130560
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    -1 -1 -1 -1
    -1 -1 999999 999999
    -1 -1 -1 -1
    0.05 1.732 1.732
    0.05 1.732 1.732
    0.05 0.866 0.866
    0.05 0.866 0.866
    0.05 0.866 0.866
    0.05 0.866 0.866
    0.05 0.866 0.866
    0.05 0.866 0.866
  }

 crop {0 0 2440 1802}
 "Adjust Lighting" 0
 "Hybrid Matte" 0
 "Fine Tuning" 0
 name Primatte2
 selected true
 xpos 339
 ypos -2439
}
Shuffle {
 red alpha
 green alpha
 blue alpha
 name Shuffle35
 tile_color 0xffffffff
 selected true
 xpos 339
 ypos -2395
}
Dot {
 name Dot54
 label "Core\nMatte"
 note_font_size 60
 selected true
 xpos 373
 ypos -1070
}
Dot {
 name Dot57
 selected true
 xpos 373
 ypos -977
}
set N931acc30 [stack 0]
Dot {
 name Dot58
 note_font_size 41
 selected true
 xpos 373
 ypos -277
}
push $N91fab100
push $N914f07d0
IBKGizmoV3 {
 inputs 2
 name IBKGizmoV3_3
 xpos 1603
 ypos -1805
}
Shuffle {
 red alpha
 green alpha
 blue alpha
 name Shuffle36
 tile_color 0xffffffff
 selected true
 xpos 1603
 ypos -1754
}
Dot {
 name Dot59
 label "Edge\nMatte"
 note_font_size 60
 selected true
 xpos 1637
 ypos -510
}
Merge2 {
 inputs 2
 operation screen
 bbox B
 name Merge4
 selected true
 xpos 1603
 ypos -281
}
Dot {
 name Dot60
 label "Combined\nMatte"
 note_font_size 60
 selected true
 xpos 1637
 ypos 313
}
Dot {
 name Dot61
 label "Combined\nMatte"
 note_font_size 60
 selected true
 xpos -1304
 ypos 313
}
push $N9144ae90
Remove {
 channels rgba
 name Remove32
 selected true
 xpos -1595
 ypos -3332
}
NoOp {
 name Anchor_217ff93ec8
 help "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019"
 onCreate "if nuke.GUI:\n    try:\n        import stamps; stamps.anchorOnCreate()\n    except:\n        pass"
 knobChanged stamps.anchorKnobChanged()
 autolabel "nuke.thisNode().knob(\"title\").value()"
 tile_color 0xffffff01
 note_font_size 20
 selected true
 xpos -1595
 ypos -3283
 addUserKnob {20 anchor_tab l "Anchor Stamp"}
 addUserKnob {26 identifier -STARTLINE +HIDDEN T anchor}
 addUserKnob {1 title l Title: t "Displayed name on the Node Graph for this Stamp and its Anchor.\nIMPORTANT: This is only for display purposes, and is different from the real/internal name of the Stamps."}
 title "GS Utils"
 addUserKnob {26 prev_title l "" +STARTLINE +HIDDEN T "GS Utils"}
 addUserKnob {26 prev_name l "" +STARTLINE +HIDDEN T Anchor_217ff93ec8}
 addUserKnob {3 showing l "" +STARTLINE +HIDDEN}
 addUserKnob {1 tags l Tags t "Comma-separated tags you can define for each Anchor, that will help you find it when invoking the Stamp Selector by pressing the Stamps shortkey with nothing selected."}
 tags 2D,
 addUserKnob {26 line1 l "" +STARTLINE}
 addUserKnob {26 stamps_label l Stamps: T " "}
 addUserKnob {22 createStamp l new t "Create a new Stamp for this Anchor." -STARTLINE T stamps.stampCreateWired(nuke.thisNode())}
 addUserKnob {22 selectStamps l select t "Reconnect all of this Anchor's Stamps." -STARTLINE T stamps.wiredSelectSimilar(nuke.thisNode().name())}
 addUserKnob {22 reconnectStamps l reconnect -STARTLINE T stamps.anchorReconnectWired()}
 addUserKnob {22 zoomNext l "zoom next" t "Navigate to this Anchor's next Stamp on the Node Graph." -STARTLINE T stamps.wiredZoomNext(nuke.thisNode().name())}
 addUserKnob {26 line2 l "" +STARTLINE}
 addUserKnob {22 buttonHelp l Help -STARTLINE T stamps.showHelp()}
 addUserKnob {26 version l " " t "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019." -STARTLINE T "<a href=\"http://www.nukepedia.com/gizmos/other/stamps\" style=\"color:#666;text-decoration: none;\"><span style=\"color:#666\"> <big>Stamps v1.0</big></b></a>"}
}
NoOp {
 name Stamp44
 help "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019"
 onCreate "if nuke.GUI:\n    try:\n        import stamps; stamps.wiredOnCreate()\n    except:\n        pass\n"
 knobChanged "import stamps; stamps.wiredKnobChanged()"
 autolabel "nuke.thisNode().knob(\"title\").value()"
 tile_color 0x1000001
 note_font "Bitstream Vera Sans"
 note_font_size 20
 selected true
 xpos -1694
 ypos -76
 hide_input true
 addUserKnob {20 wired_tab l "Wired Stamp"}
 addUserKnob {26 identifier -STARTLINE +HIDDEN T wired}
 addUserKnob {3 lockCallbacks l "" +STARTLINE +HIDDEN}
 addUserKnob {6 toReconnect -STARTLINE +HIDDEN}
 addUserKnob {1 title l Title: t "Displayed name on the Node Graph for this Stamp and its Anchor.\nIMPORTANT: This is only for display purposes, and is different from the real/internal name of the Stamps."}
 title "GS Utils"
 addUserKnob {26 prev_title l "" +STARTLINE +HIDDEN T "GS Utils"}
 addUserKnob {26 tags l Tags: t "Tags of this stamp's Anchor, for information purpose only.\nClick \"show anchor\" to change them." T <i>2D</i>}
 addUserKnob {26 backdrops l Backdrops: t "Labels of backdrop nodes which contain this stamp's Anchor." T "<i>creating GS channel,Advanced Keying Template</i>"}
 addUserKnob {26 line1 l "" +STARTLINE}
 addUserKnob {26 anchor_label l Anchor: T " "}
 addUserKnob {22 show_anchor l " show anchor " t "Show the properties panel for this Stamp's Anchor." -STARTLINE T stamps.wiredShowAnchor()}
 addUserKnob {22 zoom_anchor l "zoom anchor" t "Navigate to this Stamp's Anchor on the Node Graph." -STARTLINE T stamps.wiredZoomAnchor()}
 addUserKnob {26 stamps_label l Stamps: T " "}
 addUserKnob {22 zoomNext l " zoom next " t "Navigate to this Stamp's next sibling on the Node Graph." -STARTLINE T stamps.wiredZoomNext()}
 addUserKnob {22 selectSimilar l " select similar " t "Select all similar Stamps to this one on the Node Graph." -STARTLINE T stamps.wiredSelectSimilar()}
 addUserKnob {26 space_1 l "" +STARTLINE T " "}
 addUserKnob {26 reconnect_label l Reconnect: t "Reconnect by the stored Anchor name." T " "}
 addUserKnob {22 reconnect_this l this t "Reconnect this Stamp to its Anchor, by its stored Anchor name." -STARTLINE T "n = nuke.thisNode()\ntry:\n    n.setInput(0,nuke.toNode(n.knob(\"anchor\").value()))\nexcept:\n    nuke.message(\"Unable to reconnect.\")\ntry:\n    import stamps\n    stamps.wiredGetStyle(n)\nexcept:\n    pass\n"}
 addUserKnob {22 reconnect_similar l similar t "Reconnect this Stamp and similar ones to their Anchor, by their stored anchor name." -STARTLINE T stamps.wiredReconnectSimilar()}
 addUserKnob {22 reconnect_all l all t "Reconnect all the Stamps to their Anchors, by their stored anchor names." -STARTLINE T stamps.wiredReconnectAll()}
 addUserKnob {26 space_2 l "" +STARTLINE T " "}
 addUserKnob {20 advanced_reconnection l "Advanced Reconnection" n 2}
 addUserKnob {26 reconnect_by_title_label l "<font color=gold>By Title:" t "Reconnect by searching for a matching title." T " "}
 addUserKnob {22 reconnect_by_title_this l this t "Look for an Anchor that shares this Stamp's title, and connect this Stamp to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitle()}
 addUserKnob {22 reconnect_by_title_similar l similar t "Look for an Anchor that shares this Stamp's title, and connect this Stamp and similar ones to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitleSimilar()}
 addUserKnob {22 reconnect_by_title_selected l selected t "For each Stamp selected, look for an Anchor that shares its title, and connect to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitleSelected()}
 addUserKnob {26 reconnect_by_selection_label l "<font color=orangered>By Selection:" t "Force reconnect to a selected Anchor." T " "}
 addUserKnob {22 reconnect_by_selection_this l this t "Force reconnect this Stamp to a selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelection()}
 addUserKnob {22 reconnect_by_selection_similar l similar t "Force reconnect this Stamp and similar ones to a selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelectionSimilar()}
 addUserKnob {22 reconnect_by_selection_selected l selected t "Force reconnect all selected Stamps to an also selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelectionSelected()}
 addUserKnob {1 anchor l Anchor}
 anchor Anchor_217ff93ec8
 addUserKnob {6 auto_reconnect_by_title l "<font color=#ED9977>&nbsp; auto-reconnect by title" t "When creating this stamp again (like on copy-paste), auto-reconnect it by title instead of doing it by the saved anchor's name, and auto-turn this off immediately.\nIMPORTANT: Should be off by default. Only use this for setting up templates." +STARTLINE}
 addUserKnob {20 advanced_reconnection_1 l "Advanced Reconnection" +INVISIBLE n -1}
 addUserKnob {26 line2 l "" +STARTLINE}
 addUserKnob {22 buttonHelp l Help -STARTLINE T stamps.showHelp()}
 addUserKnob {26 version l " " t "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019." -STARTLINE T "<a href=\"http://www.nukepedia.com/gizmos/other/stamps\" style=\"color:#666;text-decoration: none;\"><span style=\"color:#666\"> <big>Stamps v1.0</big></b></a>"}
}
Dot {
 name Dot10
 note_font_size 41
 selected true
 xpos -1660
 ypos 2
}
Dot {
 name Dot286
 note_font_size 41
 selected true
 xpos -1527
 ypos 2
}
set N917edbb0 [stack 0]
Dot {
 name Dot287
 note_font_size 41
 selected true
 xpos -1527
 ypos 52
}
push $N917edbb0
push $N931acc30
Dot {
 name Dot288
 note_font_size 41
 selected true
 xpos -12
 ypos -977
}
Group {
 name ExponBlurSimple4
 onCreate "n = nuke.thisNode()\nn.knob('size').setRange(-100, 100)\nn.knob('adjustBBoxPixels').setRange(0, 400)\nn.knob('adjustBBoxPercent').setRange(1, 2)\nn.knob('safeBBoxPixels').setRange(0, 400)\nn.knob('safeBBoxPercent').setRange(1, 2)"
 knobChanged "n = nuke.thisNode()\nk = nuke.thisKnob()\n\nif k.name() == \"includeOriginal\":\n    if n.knob('includeOriginal').getValue() == 1:\n        merge = nuke.toNode(\"Merge1\")\n        original = nuke.toNode('Original')\n        AvgMult = nuke.toNode(\"AverageMult\")\n        steps = int(n.knob('steps').getValue())\n        merge.setInput(steps+1, original)\n        AvgMult\['whitepoint'].setValue(2 if steps<2 else steps+1)\n        \n    else:\n        merge.setInput(steps+1, None)\n        AvgMult\['whitepoint'].setValue(2 if steps<2 else steps)\n        \nelif k.name() == \"steps\":\n    \n    s = int(k.value())\n    if s<1:\n        k.setValue(1)\n    else:\n        start = nuke.toNode(\"Start\")\n        end   = nuke.toNode(\"End\")\n        b1    = nuke.toNode(\"Blur1\")\n        merge = nuke.toNode(\"Merge1\")\n        AvgMult = nuke.toNode(\"AverageMult\")\n        \n        b1x   = b1.xpos()\n        b1y   = b1.ypos()\n        b1n   = b1.name()\n        \n        steps = int(n.knob('steps').getValue())\n        size  = n.knob('size').getValue()\n        mult  = n.knob('mult').getValue()\n        \n        #b1.setInput(0, start)\n        for i in range(1,merge.inputs()):\n            merge.setInput(i,None)\n        merge.setInput(0, b1)\n        \[nuke.delete(i) for i in nuke.allNodes() if i.xpos()>start.xpos()]\n        for i in range(1,steps):\n            # Blur\n            b = nuke.nodes.Blur()\n            b.setXYpos(b1x+i*100,b1y)\n            b.setInput(0,start)\n            b\[\"channels\"].setValue(\"all\")\n            b\[\"crop\"].setValue(0)\n            b\[\"size\"].setValue(0, 1)\n            b\[\"size\"].setExpression(\"(Blur1.size)*(mult)**%s\"%(i))\n            b\[\"label\"].setValue(\"\[value size]\")\n            merge.setInput(i if i<2 else i+1, b)\n            AvgMult\['whitepoint'].setValue(i if i<2 else i+1)\n            \n        if n.knob('includeOriginal').getValue() == 1:\n            merge = nuke.toNode(\"Merge1\")\n            original = nuke.toNode('Original')\n            AvgMult = nuke.toNode(\"AverageMult\")\n            steps = int(n.knob('steps').getValue())\n            merge.setInput(steps+1, original)\n            AvgMult\['whitepoint'].setValue(2 if steps<2 else steps+1)\n            \nelif k.name() == \"output2\":\n    if n.knob(\"output2\").getValue() == 4:\n        n.knob('AvgMaxOriginal').setVisible(True)\n    else:\n        n.knob('AvgMaxOriginal').setVisible(False)\n        \nelif k.name() == \"safeBBox\":\n    if n.knob(\"safeBBox\").getValue() == 0:\n        n.knob('safeBBoxText').setVisible(False)\n        n.knob('safetyBBoxMethod').setVisible(False)\n        n.knob('safeBBoxPixels').setVisible(False)\n        n.knob('safeBBoxPercent').setVisible(False)\n        \n    elif n.knob(\"safeBBox\").getValue() == 1:\n        n.knob('safetyBBoxMethod').setVisible(True)\n        n.knob('safeBBoxText').setVisible(True)\n        if n.knob('safetyBBoxMethod').value() == \"pixels\":\n            n.knob('safeBBoxPixels').setVisible(True)\n            n.knob('safeBBoxPercent').setVisible(False)\n        elif n.knob('safetyBBoxMethod').value() == \"percent\":\n            n.knob('safeBBoxPixels').setVisible(False)\n            n.knob('safeBBoxPercent').setVisible(True)\n            \nelif k.name() == \"safetyBBoxMethod\":\n    if n.knob(\"safetyBBoxMethod\").value() == \"pixels\":\n        n.knob('safeBBoxPixels').setVisible(True)\n        n.knob('safeBBoxPercent').setVisible(False)\n    elif n.knob(\"safetyBBoxMethod\").value() == \"percent\":\n        n.knob('safeBBoxPixels').setVisible(False)\n        n.knob('safeBBoxPercent').setVisible(True)\n        \nelif k.name() == \"adjustBBoxExtra\":\n    if n.knob(\"adjustBBoxExtra\").value() == \"pixels\":\n        n.knob('adjustBBoxPixels').setVisible(True)\n        n.knob('adjustBBoxPercent').setVisible(False)\n    elif n.knob(\"adjustBBoxExtra\").value() == \"percent\":\n        n.knob('adjustBBoxPixels').setVisible(False)\n        n.knob('adjustBBoxPercent').setVisible(True)\n"
 tile_color 0xcc804eff
 label "(\[value output2])"
 note_font "Verdana Bold Bold Bold Bold Bold Bold Bold Bold"
 note_font_color 0xffffffff
 selected true
 xpos -46
 ypos -738
 addUserKnob {20 ExponBlurSimple}
 addUserKnob {41 channels T Remove1.channels}
 addUserKnob {41 maskChannelMask_1 l area T Multiply1.maskChannelMask}
 addUserKnob {41 inject_1 l inject -STARTLINE T Multiply1.inject}
 addUserKnob {41 invert_mask_1 l invert -STARTLINE T Multiply1.invert_mask}
 addUserKnob {41 fringe_1 l fringe -STARTLINE T Multiply1.fringe}
 addUserKnob {26 ""}
 addUserKnob {4 output2 l Operation: M {Screen Plus Over Hypot Average Max Min "" "" "" "" ""}}
 addUserKnob {3 steps l "  Steps" -STARTLINE}
 steps 4
 addUserKnob {26 text l " " -STARTLINE T " "}
 addUserKnob {6 includeOriginal l "Include Original?" -STARTLINE}
 includeOriginal true
 addUserKnob {6 AvgMaxOriginal l "Use Max of Average and Original" +HIDDEN +STARTLINE}
 addUserKnob {14 size l Size R -100 100}
 size -3
 addUserKnob {7 mult l Multiplier R 1 5}
 mult 3
 addUserKnob {6 clamp +STARTLINE}
 addUserKnob {14 postBlur l "Post Blur" R 0 100}
 addUserKnob {26 ""}
 addUserKnob {20 bboxControl l "BBox Control" n 1}
 bboxControl 0
 addUserKnob {26 text_2 l " " T " "}
 addUserKnob {4 bbox l "BBox: " -STARTLINE M {union intersectionMask A B "input format" "" "" "" "" "" "" "" "" "" "" "" ""}}
 addUserKnob {6 blackOutside l "Black Outside" -STARTLINE}
 addUserKnob {6 safeBBox l "Safe BBox" t "If the output BBox is larger than the input format and the input box combined. the result will be max of the input/format bbox plus a safety \"buffer\" in pixels or percent \n\nTurning off might make your BBox grow exponentially with high blur values" -STARTLINE}
 safeBBox true
 addUserKnob {26 safeBBoxText l "" +STARTLINE T " "}
 addUserKnob {4 safetyBBoxMethod l "Safe BBox Buffer  " -STARTLINE M {pixels percent "" "" "" "" "" "" "" "" "" "" "" "" "" "" ""}}
 safetyBBoxMethod percent
 addUserKnob {14 safeBBoxPixels l "" -STARTLINE +HIDDEN R 0 400}
 safeBBoxPixels 100
 addUserKnob {14 safeBBoxPercent l "" -STARTLINE R 1 2}
 safeBBoxPercent 1.1
 addUserKnob {26 text_3 l "" +STARTLINE T " "}
 addUserKnob {4 adjustBBoxExtra l "Extra BBox Adjust" -STARTLINE M {pixels percent "" "" "" "" "" "" "" "" "" "" "" "" ""}}
 addUserKnob {14 adjustBBoxPercent l "" -STARTLINE +HIDDEN R 1 2}
 adjustBBoxPercent 1
 addUserKnob {14 adjustBBoxPixels l "" -STARTLINE R 0 400}
 addUserKnob {26 ""}
 addUserKnob {20 endGroup n -1}
 addUserKnob {41 maskChannelMask l mask T MergeKeymix.maskChannelMask}
 addUserKnob {41 inject -STARTLINE T MergeKeymix.inject}
 addUserKnob {41 invert_mask l invert -STARTLINE T MergeKeymix.invert_mask}
 addUserKnob {41 fringe -STARTLINE T MergeKeymix.fringe}
 addUserKnob {41 mix T MergeKeymix.mix}
 addUserKnob {20 info l Info}
 addUserKnob {26 creator l Creator: T "Tony Lyons"}
 addUserKnob {26 desc l Description: T ExponBlurSimple}
 addUserKnob {26 ver l Version: T v03}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x535e5a00
  label "BBox Management"
  note_font_size 30
  note_font_color 0xffffffff
  xpos -529
  ypos 492
  bdwidth 341
  bdheight 525
 }
 Input {
  inputs 0
  name Inputimg
  xpos 0
  ypos -969
 }
 Dot {
  name Dot16
  note_font_size 41
  xpos 34
  ypos -802
 }
set N931daad0 [stack 0]
 Dot {
  name Dot2
  note_font_size 41
  xpos -367
  ypos -802
 }
 Dot {
  name Dot18
  label B
  note_font_size 41
  xpos -367
  ypos 434
 }
 Dot {
  name Dot11
  note_font_size 41
  xpos -367
  ypos 623
 }
set N932071e0 [stack 0]
 Dot {
  name Dot3
  note_font_size 41
  xpos -367
  ypos 675
 }
set N931e59b0 [stack 0]
 Dot {
  name Dot8
  note_font_size 41
  xpos -463
  ypos 675
 }
 Dot {
  name Dot15
  note_font_size 41
  xpos -463
  ypos 831
 }
push $N931daad0
 Dot {
  name Dot1
  note_font_size 41
  xpos 461
  ypos -802
 }
 Remove {
  operation keep
  channels rgba
  name Remove1
  xpos 427
  ypos -718
 }
 Dot {
  name Dot21
  note_font_size 41
  xpos 461
  ypos -597
 }
set N933009a0 [stack 0]
 Invert {
  name Invert1
  xpos 695
  ypos -604
  disable {{"parent.size < 0 ? 0 : 1"}}
 }
set N933047b0 [stack 0]
 Dot {
  name Dot4
  note_font_size 41
  xpos 540
  ypos -543
 }
 NoOp {
  name Original
  xpos 506
  ypos -327
 }
set N91ff6a30 [stack 0]
 Dot {
  name Dot5
  note_font_size 41
  xpos 540
  ypos 14
 }
 Crop {
  inputs 0
  box {{"!\[exists parent.input0] ? 0 : input.format.x"} {"!\[exists parent.input0] ? 0 : input.format.y"} {"!\[exists parent.input0] ? 0 : input.format.r"} {"!\[exists parent.input0] ? 0 : input.format.t"}}
  reformat true
  crop false
  name Crop1
  xpos 210
  ypos -750
  addUserKnob {20 User}
  addUserKnob {22 cropToBbox l "Crop to Bounding Box" -STARTLINE T codeBBox()}
 }
 AddChannels {
  channels rgba
  name AddChannels2
  xpos 210
  ypos -724
 }
push $N931daad0
 Merge2 {
  inputs 2
  name Merge3
  label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
  xpos 83
  ypos -671
 }
 NoOp {
  name BBoxInput
  xpos 83
  ypos -628
  addUserKnob {20 User}
  addUserKnob {15 bbox}
  bbox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
 }
push $N91ff6a30
 Input {
  inputs 0
  name Inputarea
  xpos 289
  ypos -638
  number 2
 }
 AddChannels {
  channels alpha
  color 1
  name AddChannels1
  xpos 289
  ypos -580
 }
 Invert {
  channels rgba
  name Invert3
  xpos 289
  ypos -503
 }
push $N933047b0
 Multiply {
  inputs 1+1
  value 0
  name Multiply1
  label "\[value value]"
  xpos 695
  ypos -512
 }
 NoOp {
  name Start
  xpos 695
  ypos -450
 }
set N93444170 [stack 0]
 Blur {
  size {{(Blur1.size)*(mult)**3} {(Blur1.size)*(mult)**3}}
  crop false
  name Blur4
  label "\[value size]"
  xpos 995
  ypos -370
 }
push $N93444170
 Blur {
  size {{(Blur1.size)*(mult)**2} {(Blur1.size)*(mult)**2}}
  crop false
  name Blur3
  label "\[value size]"
  xpos 895
  ypos -370
 }
push 0
push $N93444170
 Blur {
  size {{(Blur1.size)*(mult)**1} {(Blur1.size)*(mult)**1}}
  crop false
  name Blur2
  label "\[value size]"
  xpos 795
  ypos -370
 }
push $N93444170
 Blur {
  size {{parent.size.w} {parent.size.h}}
  name Blur1
  label "\[value size]"
  xpos 695
  ypos -370
 }
 Merge2 {
  inputs 5+1
  operation {{mergeNumber.mergeNumber}}
  also_merge all
  name Merge1
  label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
  xpos 695
  ypos -273
 }
 NoOp {
  name End
  xpos 695
  ypos -230
 }
set N934828e0 [stack 0]
 CopyBBox {
  inputs 2
  name CopyBBox1
  xpos 585
  ypos -175
 }
 Group {
  name BBoxToFormat
  onCreate "n = nuke.thisNode()\ninputFormat = n.knob(\"inputFormat\")\ninputBBox = n.knob(\"inputBBox\")\ncrop = nuke.toNode(\"Crop6\")\ncropb = crop.knob('box')\noutputBBox = n.knob('outputBBox')\noutputBBoxCenter = n.knob(\"outputBBoxCenter\")\n\ninputFormat.setFlag(0x0000000000008000)\ninputBBox.setFlag(0x0000000000008000)\ncropb.setFlag(0x0000000000008000)\noutputBBox.setFlag(0x0000000000008000)\noutputBBoxCenter.setFlag(0x0000000000008000)\n\nn = nuke.thisNode()\nn.knob(\"overscan\").setRange(0,400)\nn.knob(\"overscanPercent\").setRange(1,4)"
  tile_color 0xa57aaaff
  note_font "Verdana Bold Bold Bold Bold Bold Bold Bold Bold Bold"
  note_font_color 0xffffffff
  xpos 585
  ypos -151
  addUserKnob {20 CropBBox}
  addUserKnob {4 type l Type +INVISIBLE M {"To Format" "To BBox"}}
  addUserKnob {41 intersect T Crop6.intersect}
  addUserKnob {6 blackOutside l "Black Outside" -STARTLINE}
  addUserKnob {4 overscanType l "Overscan Type:" M {Pixels Percentage}}
  overscanType {{parent.safetyBBoxMethod}}
  addUserKnob {14 overscan l Overscan R 0 400}
  overscan {{parent.safeBBoxPixels} {parent.safeBBoxPixels}}
  addUserKnob {14 overscanPercent l "Overscan Percent" R 1 4}
  overscanPercent {{parent.safeBBoxPercent} {parent.safeBBoxPercent}}
  addUserKnob {20 inputBbox l "BBox Data" n 1}
  addUserKnob {15 inputFormat l "Input Format"}
  inputFormat {0 0 {input.width} {input.height}}
  addUserKnob {15 inputBBox l "Input BBox"}
  inputBBox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
  addUserKnob {12 outputBBoxCenter l OutputBBoxCenter}
  outputBBoxCenter {{OutputBBox1.outputBBoxCenter.w} {OutputBBox1.outputBBoxCenter.h}}
  addUserKnob {15 outputBBox l "Output BBox"}
  outputBBox {{OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox}}
  addUserKnob {20 endGroup n -1}
  addUserKnob {20 info_1 l Info}
  addUserKnob {26 creator l Creator: T "<b><big>Tony Lyons"}
  addUserKnob {26 desc l Description: t "crop to inputformat\n\ndisplays values of input bbox" T CropBBox}
  addUserKnob {26 ver l Version: T v02}
 }
  Input {
   inputs 0
   name Input
   xpos 261
   ypos 394
  }
  Dot {
   name Dot2
   note_font_size 41
   xpos 295
   ypos 462
  }
set N9349caa0 [stack 0]
  Dot {
   name Dot1
   note_font_size 41
   xpos -160
   ypos 462
  }
set N934a09c0 [stack 0]
push $N9349caa0
  Crop {
   box {{parent.inputBBox} {parent.inputBBox} {parent.inputBBox} {parent.inputBBox}}
   crop {{parent.blackOutside}}
   name Crop6
   xpos 261
   ypos 510
   addUserKnob {20 User}
   addUserKnob {22 cropToBbox l "Crop to Bounding Box" -STARTLINE T codeBBox()}
  }
set N934a48a0 [stack 0]
  Remove {
   operation keep
   channels none
   name Remove1
   xpos 120
   ypos 504
  }
set N934ae150 [stack 0]
  Transform {
   scale {{parent.overscanPercent} {parent.overscanPercent}}
   center {{((input.bbox.r-input.bbox.x)/2)+input.bbox.x} {((input.bbox.t-input.bbox.y)/2)+input.bbox.y}}
   shutteroffset centred
   name Transform1
   selected true
   xpos 120
   ypos 553
  }
push $N934ae150
  AdjBBox {
   numpixels {{parent.overscan} {parent.overscan}}
   name AdjBBox1
   xpos -5
   ypos 510
  }
  Switch {
   inputs 2
   which {{overscanType}}
   name Switch2
   label "\[value which]"
   xpos -5
   ypos 549
  }
  Merge2 {
   inputs 2
   bbox intersection
   Achannels {-rgba.red -rgba.green -rgba.blue rgba.alpha}
   Bchannels {-rgba.red -rgba.green -rgba.blue rgba.alpha}
   output {-rgba.red -rgba.green -rgba.blue rgba.alpha}
   name Merge1
   xpos -5
   ypos 647
   disable {{!parent.Crop6.intersect}}
  }
push $N934a09c0
  CopyBBox {
   inputs 2
   name CopyBBox1
   xpos -194
   ypos 653
  }
  BlackOutside {
   name BlackOutside1
   xpos -194
   ypos 692
   disable {{!parent.blackOutside}}
  }
  Dot {
   name Dot4
   note_font_size 41
   xpos -160
   ypos 769
  }
push $N934a48a0
  Switch {
   inputs 2
   which {{"overscanType == 0 ? overscan.w != 0 || overscan.h != 0 : overscanPercent.w != 1 || overscanPercent.h != 1 ? 1 : 0"}}
   name Switch1
   label "\[value which]"
   xpos 261
   ypos 759
  }
set N934ec340 [stack 0]
  Output {
   name Output1
   xpos 261
   ypos 921
  }
push $N934ec340
  NoOp {
   name OutputBBox1
   xpos 378
   ypos 821
   addUserKnob {20 User}
   addUserKnob {15 OutputBBox l "Output BBox"}
   OutputBBox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
   addUserKnob {14 outputBBoxCenter l "Output BBox Center" R 0 100}
   outputBBoxCenter {{OutputBBox.x+(OutputBBox.r-OutputBBox.x)/2} {OutputBBox.y+(OutputBBox.t-OutputBBox.y)/2}}
  }
 end_group
push $N934828e0
 Merge2 {
  inputs 2
  bbox intersection
  also_merge all
  name Merge4
  xpos 585
  ypos -127
 }
push $N934828e0
 CopyBBox {
  inputs 2
  name CopyBBox2
  xpos 585
  ypos -101
 }
push $N934828e0
 Switch {
  inputs 2
  which {{"parent.safeBBox && ((BBoxResult.bbox.x < BBoxInput.bbox.x || BBoxResult.bbox.y < BBoxInput.bbox.y || BBoxResult.bbox.r > BBoxInput.bbox.r || BBoxResult.bbox.t > BBoxInput.bbox.t))"}}
  name Switch2
  label "\[value which]"
  xpos 695
  ypos -106
 }
 Grade {
  channels all
  whitepoint 5
  black_clamp false
  name AverageMult
  xpos 695
  ypos -37
  disable {{"output2 == 4 ? 0 : 1"}}
 }
 Merge2 {
  inputs 2
  operation max
  also_merge all
  name Merge2
  label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
  xpos 695
  ypos 10
  disable {{"output2 == 4 && includeOriginal == 1 && AvgMaxOriginal == 1 ? 0 : 1"}}
 }
 Clamp {
  name Clamp1
  selected true
  xpos 695
  ypos 50
  disable {{!parent.clamp}}
 }
 Blur {
  size {{postBlur} {postBlur}}
  name BlurOriginal
  label "\[value size]"
  xpos 695
  ypos 102
 }
 Invert {
  name Invert2
  xpos 695
  ypos 144
  disable {{"parent.size < 0 ? 0 : 1"}}
 }
push $N933009a0
 Switch {
  inputs 2
  which {{"parent.size == 0 ? 0 : 1"}}
  name Switch1
  label "\[value which]"
  xpos 427
  ypos 190
 }
 Dot {
  name Dot17
  label A
  note_font_size 41
  xpos 34
  ypos 455
 }
 Dot {
  name Dot7
  note_font_size 41
  xpos 34
  ypos 579
 }
set N9355f870 [stack 0]
 Dot {
  name Dot12
  note_font_size 41
  xpos -260
  ypos 579
 }
 Dot {
  name Dot13
  note_font_size 41
  xpos -260
  ypos 799
 }
push $N932071e0
 Input {
  inputs 0
  name Inputmask
  xpos 512
  ypos 322
  number 1
 }
 Dot {
  name Dot19
  label Mask
  note_font_size 41
  xpos 546
  ypos 435
 }
set N9356f370 [stack 0]
 Dot {
  name Dot20
  note_font_size 41
  xpos 436
  ypos 435
 }
push $N9355f870
 Merge2 {
  inputs 2
  bbox intersection
  Achannels {rgba.red -rgba.green -rgba.blue rgba.alpha}
  Bchannels {rgba.red -rgba.green -rgba.blue rgba.alpha}
  output {rgba.red -rgba.green -rgba.blue rgba.alpha}
  name MergeIntersection
  xpos 402
  ypos 572
  disable {{"!\[exists parent.input1]"}}
 }
 Merge2 {
  inputs 2
  Achannels {rgba.red -rgba.green -rgba.blue rgba.alpha}
  Bchannels {rgba.red -rgba.green -rgba.blue rgba.alpha}
  output {rgba.red -rgba.green -rgba.blue rgba.alpha}
  name MergeUnion
  xpos 402
  ypos 610
  disable {{"!\[exists parent.input1]"}}
 }
 Dot {
  name Dot6
  label "intersection\nof (Mask and A) + B"
  note_font_size 14
  note_font_color 0xffffffff
  xpos 436
  ypos 770
 }
push $N9356f370
 Dot {
  name Dot10
  note_font_size 41
  xpos 546
  ypos 672
 }
push $N9355f870
push $N931e59b0
 Merge2 {
  inputs 2+1
  operation copy
  Achannels none
  Bchannels none
  output none
  also_merge {{{parent.Remove1.channels}}}
  name MergeKeymix
  xpos 0
  ypos 665
 }
 Dot {
  name Dot14
  note_font_size 41
  xpos 34
  ypos 747
 }
set N935a7120 [stack 0]
push $N931e59b0
 CopyBBox {
  inputs 2
  name CopyBBoxUnion
  xpos -401
  ypos 743
  disable {{parent.bbox==0?0:1}}
 }
 CopyBBox {
  inputs 2
  name CopyBBoxIntersection
  xpos -401
  ypos 769
  disable {{"parent.bbox==1 ? 0 : 1"}}
 }
 CopyBBox {
  inputs 2
  name CopyBBoxA
  xpos -401
  ypos 795
  disable {{"parent.bbox==2 ? 0 : 1"}}
 }
 CopyBBox {
  inputs 2
  name CopyBBoxB
  xpos -401
  ypos 827
  disable {{"parent.bbox==3 ? 0 : 1"}}
 }
 Crop {
  box {0 0 {parent.width} {parent.height}}
  crop false
  name CopyBBoxFormat
  xpos -401
  ypos 853
  disable {{"parent.bbox==4 ? 0 : 1"}}
  addUserKnob {20 User}
  addUserKnob {22 cropToBbox l "Crop to Bounding Box" -STARTLINE T codeBBox()}
 }
set N935c4fb0 [stack 0]
 Transform {
  scale {{parent.adjustBBoxPercent} {parent.adjustBBoxPercent}}
  center {{((input.bbox.r-input.bbox.x)/2)+input.bbox.x} {((input.bbox.t-input.bbox.y)/2)+input.bbox.y}}
  black_outside false
  shutteroffset centred
  name TransformBBoxAdjustPercent
  xpos -516
  ypos 898
 }
push $N935c4fb0
 AdjBBox {
  numpixels {{parent.adjustBBoxPixels} {parent.adjustBBoxPixels}}
  name AdjBBoxPixels
  xpos -401
  ypos 901
 }
 Switch {
  inputs 2
  which {{adjustBBoxExtra}}
  name Switch3
  xpos -401
  ypos 940
 }
 Dot {
  name Dot9
  note_font_size 41
  xpos -367
  ypos 993
 }
push $N935a7120
 CopyBBox {
  inputs 2
  name CopyBBox
  xpos 0
  ypos 989
 }
 BlackOutside {
  name BlackOutside1
  xpos 0
  ypos 1015
  disable {{!parent.blackOutside}}
 }
 Output {
  name Output1
  xpos 0
  ypos 1155
 }
 NoOp {
  inputs 0
  name mergeNumber
  xpos 229
  ypos -862
  addUserKnob {20 User}
  addUserKnob {3 mergeNumber}
  mergeNumber {{"output2 == 0 ? 25 : output2 == 1 ? 24 : output2 == 2 ? 22 : output2 == 3 ? 13 : output2 == 4 ? 24 : output2 == 5 ? 17 : 18"}}
 }
push $N934828e0
 NoOp {
  name BBoxResult
  xpos 585
  ypos -230
  addUserKnob {20 User}
  addUserKnob {15 bbox}
  bbox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
 }
end_group
Dot {
 name Dot289
 note_font_size 41
 selected true
 xpos -12
 ypos -570
}
Dot {
 name Dot290
 label "Core\nMatte"
 note_font_size 60
 selected true
 xpos -1083
 ypos -570
}
Dot {
 name Dot291
 note_font_size 41
 selected true
 xpos -1193
 ypos -570
}
set N935d7820 [stack 0]
push $N919a5f20
Dot {
 name Dot67
 selected true
 xpos -3071
 ypos -2999
}
Remove {
 operation keep
 channels rgb
 name Remove33
 selected true
 xpos -3105
 ypos -2878
}
Dot {
 name Dot292
 selected true
 xpos -3071
 ypos -2516
}
set N935e6b10 [stack 0]
Group {
 name apDespill3
 help "apDespill v1.0 by Adrian Pueyo\n\nGizmo to despill an image, with options to despill any hue (and not only the primaries), select different algorithms for des/respilling, and protect tones from the despill.\n\nIf you just want a basic despill, its default values should already be enough and the tool will avoid any extra calculations.\n\nadrianpueyo.com, 2014-2017"
 onCreate "n = nuke.thisNode()\nn\['tolerance'].setRange(0,2)\nn\['prot1_tolerance'].setFlag(0x00000004)\nn\['prot1_effect'].setFlag(0x00000004)"
 knobChanged "n = nuke.thisNode()\nk = nuke.thisKnob()\nif k.name() == \"color\":\n    if k.getValue() == 0:\n        n\[\"custom_weight\"].setLabel(\"green - blue\")\n    elif k.getValue() == 1:\n        n\[\"custom_weight\"].setLabel(\"red - blue\")\n    elif k.getValue() == 2:\n        n\[\"custom_weight\"].setLabel(\"red - green\")\n    n\[\"pick\"].setVisible(k.getValue() == 3)\nelif k.name() == \"mode\":\n    n\[\"custom_weight\"].setVisible(n\[\"mode\"].getValue()==3)\nelif k.name() in \[\"out\",\"output_alpha\"]:\n    n\[\"respill_math\"].setEnabled(n\[\"out\"].getValue()==0 or n\[\"output_alpha\"].getValue()==1)\n    n\[\"respill_color\"].setEnabled(n\[\"out\"].getValue()==0)\nelif k.name() == \"prot1_activate\":\n    protA = n\[\"prot1_activate\"].value()\n    n\[\"prot1_preview\"].setEnabled(protA)\n    n\[\"prot1\"].setVisible(protA)\n    n\[\"prot1_tolerance\"].setVisible(protA)\n    n\[\"prot1_falloff\"].setVisible(protA)\n    n\[\"prot1_effect\"].setVisible(protA)"
 tile_color 0x8b8b8bff
 selected true
 xpos -3105
 ypos -2317
 addUserKnob {20 apDespill}
 addUserKnob {6 pick_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {41 "Local GPU: " T apDespillKernel.gpuName}
 addUserKnob {41 "Use GPU if Available" T apDespillKernel.useGPUIfAvailable}
 addUserKnob {41 vectorize l "Vectorize on CPU" -STARTLINE T apDespillKernel.vectorize}
 addUserKnob {26 ""}
 addUserKnob {4 color t "Select a primary as a starting point, or custom to show RGB controls to select any color." M {red green blue custom ""}}
 color green
 addUserKnob {18 pick +HIDDEN}
 pick {0 0 0}
 addUserKnob {6 pick_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 pick_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 pick_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 pick_panelDropped_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 pick_panelDropped_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 pick_panelDropped_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 pick_panelDropped_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 dfg_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {4 out l output t "Quick switch to output the despilled image or the substracted one." M {despill spill}}
 addUserKnob {6 output_alpha l "output spill matte in alpha" t "Output the spill luminance in the alpha channel." -STARTLINE}
 addUserKnob {4 mode l "despill math" t "average = avg of other two channels\nmaximum = max of other two channels\nminimum = min of other two channels\ncustom = select custom weights" M {average maximum minimum custom}}
 addUserKnob {4 logLin l "Colorspace Log/Lin" -STARTLINE +INVISIBLE M {Log Lin ""}}
 logLin Lin
 addUserKnob {6 logspace l "Log Space" -STARTLINE}
 addUserKnob {7 custom_weight l "red - blue" t "-1 = only capped by the first channel\n0 = capped by avg of both\n1 = only capped by the second channel" -STARTLINE +HIDDEN R -1 1}
 addUserKnob {41 colorspace_out l colorspace T Colorspace1.colorspace_out}
 addUserKnob {41 illuminant_out l "" -STARTLINE T Colorspace1.illuminant_out}
 addUserKnob {41 primary_out l "" -STARTLINE T Colorspace1.primary_out}
 addUserKnob {26 text l " " T " "}
 addUserKnob {7 hue_offset l "hue offset" t "Rotate the despill vectors to despill an arbitrary tone other than the primaries.\nNote: A rotation of +-120 degrees is the same as selecting another color channel." R -180 180}
 addUserKnob {7 tolerance t "Use this to multiply the hue tolerance (the limiter value). You can move it all the way down to 0 to completely remove a hue from your image." R 0 2}
 tolerance 1
 addUserKnob {6 prot1_activate l "protect tones" t "Enable controls to select tones to protect from despilling." +STARTLINE}
 addUserKnob {6 prot1_preview l preview t "Output the protected tones." -STARTLINE +DISABLED}
 addUserKnob {18 prot1 l protect t "Pick the central hue to protect.\n(ctrl/cmd+alt+click)" +HIDDEN}
 prot1 {0 0 0}
 addUserKnob {6 prot1_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 prot1_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 prot1_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 prot1_panelDropped_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 prot1_panelDropped_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 prot1_panelDropped_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 prot1_panelDropped_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {7 prot1_tolerance l tolerance t "Amount of hues to include in the selection." +HIDDEN}
 prot1_tolerance 0.2
 addUserKnob {7 prot1_falloff l falloff t "Falloff for the hue selection. A higher falloff will make hues apart from the picked one lose weight more quickly." +HIDDEN R 0 4}
 prot1_falloff 2
 addUserKnob {7 prot1_effect l effect t "Multiplier for the hue protection, and for the spill limit value." +HIDDEN R 0 10}
 prot1_effect 1
 addUserKnob {26 respill_divider l "" +STARTLINE}
 addUserKnob {4 respill_math l "respill math" t "Settings for the way of desaturating the spill before adding it back." M {"Rec 709" "Ccir 601" Average Maximum "" ""}}
 addUserKnob {18 respill_color l "respill color" t "RGB multiplier for the desaturated spill when adding it back.\n\nNote: if used on non-degrained plates (which should be avoided anyway), any value other than 1 here will most likely produce grain artifacts." R 0 4}
 respill_color 1
 addUserKnob {6 respill_color_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 respill_color_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 respill_color_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 respill_color_panelDropped_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 respill_color_panelDropped_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 respill_color_panelDropped_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 respill_color_panelDropped_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {26 ""}
 addUserKnob {41 maskChannelMask l mask T Merge.maskChannelMask}
 addUserKnob {41 inject -STARTLINE T Merge.inject}
 addUserKnob {41 invert_mask l invert -STARTLINE T Merge.invert_mask}
 addUserKnob {41 fringe -STARTLINE T Merge.fringe}
 addUserKnob {41 mix T Merge.mix}
 addUserKnob {26 version_author l "" t "apDespill v1.0\n14 March, 2017" +STARTLINE T "<span style=\"color:#666\"><br/><b>apDespill v1.0</b> - <a href=\"http://www.adrianpueyo.com\" style=\"color:#666;text-decoration: none;\">adrianpueyo.com</a>, 2014-2017</span>"}
 addUserKnob {20 GPU_Settings l "GPU Settings"}
 addUserKnob {41 maxGPUMemory l "Percentage of GPU memory to use" T apDespillKernel.maxGPUMemory}
 addUserKnob {41 maxTileLines l "Percentage of image height per tile" T apDespillKernel.maxTileLines}
}
 Input {
  inputs 0
  name Inputmask
  xpos 339
  ypos -447
  number 1
 }
 Input {
  inputs 0
  name Inputimg
  xpos 449
  ypos -764
 }
set N936045b0 [stack 0]
 Colorspace {
  name Colorspace1
  label "\[value colorspace_in] >> \[value colorspace_out]"
  xpos 559
  ypos -703
 }
 Log2Lin {
  operation lin2log
  name Log2Lin1
  xpos 559
  ypos -665
  disable {{!logspace}}
 }
 Shuffle {
  name Shuffle
  xpos 559
  ypos -608
  disable {{"\[exists parent.input0]"}}
 }
 BlinkScript {
  ProgramGroup 1
  KernelDescription "2 \"apDespillKernel\" iterate pixelWise 86d17838f15464a9e9273cd415388c19006f9163a6efd15e7ad521c828dc89ac 2 \"src\" Read Point \"dst\" Write Point 17 \"limit\" Float 1 AACAPw== \"shift\" Float 1 AAAAAA== \"weights\" Float 1 AAAAAA== \"outmode\" Int 1 AAAAAA== \"output_alpha\" Int 1 AAAAAA== \"clr\" Int 1 AAAAAA== \"mode\" Int 1 AAAAAA== \"respill_math\" Int 1 AAAAAA== \"respill_color\" Float 4 AAAAAAAAAAAAAAAAAAAAAA== \"prot1_on\" Int 1 AAAAAA== \"prot1_preview\" Int 1 AAAAAA== \"prot1\" Float 3 AAAAAAAAAAAAAAAAAAAAAA== \"prot1_tolerance\" Float 1 AAAAAA== \"prot1_mult\" Float 1 AAAAAA== \"prot1_falloff\" Float 1 AAAAAA== \"lumaHueShift\" Int 1 AAAAAA== \"pickSpill\" Float 3 AAAAAAAAAAAAAAAAAAAAAA== 17 \"limit\" 1 1 \"shift\" 1 1 \"weights\" 1 1 \"outmode\" 1 1 \"output_alpha\" 1 1 \"clr\" 1 1 \"mode\" 1 1 \"respill_math\" 1 1 \"respill_color\" 4 1 \"prot1_on\" 1 1 \"prot1_preview\" 1 1 \"prot1\" 3 1 \"prot1_tolerance\" 1 1 \"prot1_mult\" 1 1 \"prot1_falloff\" 1 1 \"lumaHueShift\" 1 1 \"pickSpill\" 3 1 3 \"_usePicked\" Int 1 1 AAAAAA== \"_clr\" Int 1 1 AAAAAA== \"_ret\" Int 1 1 AAAAAA=="
  kernelSource "//---------------------------------------------------------\n// apDespillKernel - apDespill v1.0 by Adrian Pueyo\n//\n// Despill an image, with options to despill any hue (and\n// not only the primaries), select different algorithms for\n// des/respilling, and protect tones from the despill.\n//\n// adrianpueyo.com, 2014-2017\n// ---------------------------------------------------------\n\nstatic inline float y_convert_ccir601(const float4 in)\{\n  return in.x * 0.299f + in.y * 0.587f + in.z * 0.114f;\n\}\n\nstatic inline float y_convert_rec709(const float4 in)\{\n  return in.x * 0.2125f + in.y * 0.7154f + in.z * 0.0721f;\n\}\n\nstatic inline float4 hueShift(const float4 in, const float H)\{\n  if(H==0.0f)\{\n    return in;\n  \}else\{\n    float U = cos(H*PI/180);\n    float W = sin(H*PI/180);\n    float3 ret;\n    ret.x = (.299+.701*U+.168*W)*in.x + (.587-.587*U+.330*W)*in.y + (.114-.114*U-.497*W)*in.z;\n    ret.y = (.299-.299*U-.328*W)*in.x + (.587+.413*U+.035*W)*in.y + (.114-.114*U+.292*W)*in.z;\n    ret.z = (.299-.3*U+1.25*W)*in.x + (.587-.588*U-1.05*W)*in.y + (.114+.886*U-.203*W)*in.z;\n    return float4(ret.x,ret.y,ret.z,in\[3]);\n  \}\n\}\n\nstatic inline float4 hueRotate(const float4 in, const float H)\{\n  if(H==0.0f)\{\n    return in;\n  \}else\{\n    float cosH = cos(H*PI/180);\n    float sinH = sin(H*PI/180);\n    float3 ret;\n    ret.x = (in.x+in.y+in.z)*(1-cosH)/3 + in.x*cosH + (-in.y/sqrt(3.0f)+in.z/sqrt(3.0f))*sinH;\n    ret.y = (in.x+in.y+in.z)*(1-cosH)/3 + in.y*cosH + (in.x/sqrt(3.0f)-in.z/sqrt(3.0f))*sinH;\n    ret.z = (in.x+in.y+in.z)*(1-cosH)/3 + in.z*cosH + (-in.x/sqrt(3.0f)+in.y/sqrt(3.0f))*sinH;\n    return float4(ret.x,ret.y,ret.z,in\[3]);\n  \}\n\}\n\nfloat3 vecToPlane(float3 v1, float3 v2 = float3(1.0f,1.0f,1.0f))\{\n  float3 v1onv2;\n  v1onv2 = v2 * float((float(dot(v2,v1))/float(dot(v2,v2)))); //Projection of vector on another (plane's normal)\n  return v1-v1onv2; //Projection of vector on plane\n\}\n\nstatic inline float colorAngle(const float3 v1, const float3 v2)\{\n  const float3 vN=float3(1.0f,1.0f,1.0f);\n  float ang = acos(float(dot(v1,v2))/float(sqrt(dot(v1,v1)*dot(v2,v2))));\n  float3 crs = cross(v1,v2);\n  if (dot(vN, crs) > 0) \{\n    ang = -ang;\n  \}\n  return ang;\n\}\n\nkernel apDespillKernel : ImageComputationKernel<ePixelWise>\n\{\n  Image<eRead, eAccessPoint, eEdgeClamped> src;\n  Image<eWrite> dst;\n\n  param:\n    float limit;\n    float shift;\n    float weights;\n    int outmode;//0=despill,1=spill\n    int output_alpha;\n    int clr; //0=red,1=green,2=blue\n    int mode; //0=average,1=maximum,2=minimum,3=custom\n    int respill_math; //0=Rec709,1=Ccir601,2=Avg,3=Max\n    float4 respill_color;\n    int prot1_on;\n    int prot1_preview;\n    float3 prot1;\n    float prot1_tolerance;\n    float prot1_mult;\n    float prot1_falloff;\n    int lumaHueShift;//If disabled, the hue is just rotated without the luma coefficients\n    float3 pickSpill;\n  local:\n    int _usePicked;\n    int _clr;\n    int _ret;\n\n  void define() \{\n    defineParam(limit, \"limit\", 1.0f);\n    defineParam(shift, \"shift\", 0.0f);\n  \}\n\n  void init() \{\n    _ret = 0;\n    if(clr!=3)\{//red green or blue\n      _usePicked = 0;\n      _clr = clr;\n    \}else if(pickSpill.x==pickSpill.y && pickSpill.x==pickSpill.z)\{\n      _ret = 1;//if \"custom\" selected but has a gray value, avoid any calculations\n    \}else\{\n      _usePicked = 1;\n      _clr = 0;\n    \}\n  \}\n\n  void process() \{\n\n    if(_ret == 1)\{ dst()=src(); return; \}//Avoid any calculations if no despill selected\n    //0. Calculate autoShift if picked spill is not 0\n    float autoShift = 0.0f;\n    if(_usePicked==1)\{\n      float3 vNorm = float3(1.0f,1.0f,1.0f);\n      autoShift = colorAngle(vecToPlane(pickSpill,vNorm),vecToPlane(float3(1.0f,0.0f,0.0f),vNorm));\n      autoShift = autoShift*180/PI;//to deg\n    \}\n\n    //1. HueShift IN\n    float4 despilled;\n    if (lumaHueShift==1)\{\n      despilled = hueShift(src(),shift-autoShift);\n    \}else\{\n      despilled = hueRotate(src(),shift-autoShift);\n    \}\n\n    //2. Calculate the limit\n    float resultLimit = 0.0f;\n    int2 others;\n    if(_clr==0)\{//If red (and if _usePicked, also set red)\n      others = int2(1,2);\n    \}else if(_clr==1)\{\n      others=int2(0,2);\n    \}else if(_clr==2)\{\n      others=int2(0,1);\n    \}\n\n    if(mode==0)\{//average\n      resultLimit = (despilled\[others\[0]]+despilled\[others\[1]])/2;\n    \}else if(mode==1)\{//max\n      resultLimit = max(despilled\[others\[0]],despilled\[others\[1]]);\n    \}else if(mode==2)\{//min\n      resultLimit = min(despilled\[others\[0]],despilled\[others\[1]]);\n    \}else\{//custom\n      resultLimit = despilled\[others\[0]]*weights+despilled\[others\[1]]*(1-weights);\n    \}\n\n    //3. Protect tones\n    float prot1_result;\n    if(prot1_on==1&&(prot1\[0]!=prot1\[1]||prot1\[0]!=prot1\[2]||prot1\[1]!=prot1\[2]))\{\n      float cos_prot1_angle;\n      cos_prot1_angle = (src(0)*prot1\[0]+src(1)*prot1\[1]+src(2)*prot1\[2]) / (sqrt(prot1\[0]*prot1\[0]+prot1\[1]*prot1\[1]+prot1\[2]*prot1\[2]) * sqrt(src(0)*src(0)+src(1)*src(1)+src(2)*src(2)));\n      prot1_result = pow(clamp(cos_prot1_angle,0.0f,1.0f),1/pow(prot1_tolerance,prot1_falloff));\n      resultLimit = resultLimit*(1+prot1_result*prot1_mult);\n    \}\n    \n\n    //4. Calculate the despill and return the hue shift\n    for (int component = 0; component < dst.kComps; component++)\{\n      despilled\[component] = component==_clr?min(despilled\[component],resultLimit*limit):despilled\[component];\n    \}\n    if (lumaHueShift==1)\{\n      despilled = hueShift(despilled,-shift+autoShift);\n    \}else\{\n      despilled = hueRotate(despilled,-shift+autoShift);\n    \}\n\n    //5. Respill/restore despill values\n    float luma;\n    float4 spill = src()-despilled;\n    if(respill_math==0)\{\n      luma = y_convert_rec709(spill);\n    \}else if(respill_math==1)\{\n      luma = y_convert_ccir601(spill);\n    \}else if(respill_math==2)\{\n      luma = (spill\[0]+spill\[1]+spill\[2])/3;\n    \}else\{\n      luma = max(max(spill\[0],spill\[1]),spill\[2]);\n    \}\n\n    //6. Output (options)\n    if(prot1_preview==1 && prot1_on==1)\{\n      dst() = src()*clamp(prot1_result*prot1_mult,0.0f,1.0f);\n    \}else if(outmode==0)\{\n      dst() = despilled+luma*respill_color;\n      if(output_alpha==0)\{\n        dst(3)=src(3);\n      \}else\{\n        dst(3)=luma;\n      \}\n    \}else\{\n      if(output_alpha==0)\{\n        spill\[3]=src(3);\n      \}else\{\n        spill\[3]=luma;\n      \}\n      dst() = spill;\n    \}\n    //dst() = hueRotate(src(),shift-autoShift);\n    //dst() = autoShift;\n  \}\n\};"
  rebuild ""
  apDespillKernel_limit {{parent.tolerance}}
  apDespillKernel_shift {{parent.hue_offset}}
  apDespillKernel_weights {{(parent.custom_weight+1)/2}}
  apDespillKernel_outmode {{parent.out}}
  apDespillKernel_output_alpha {{parent.output_alpha}}
  apDespillKernel_clr {{parent.color}}
  apDespillKernel_mode {{parent.mode}}
  apDespillKernel_respill_math {{parent.respill_math}}
  apDespillKernel_respill_color {{parent.respill_color.r} {parent.respill_color.g} {parent.respill_color.b} 1}
  apDespillKernel_prot1_on {{parent.prot1_activate}}
  apDespillKernel_prot1_preview {{parent.prot1_preview}}
  apDespillKernel_prot1 {{parent.prot1} {parent.prot1} {parent.prot1}}
  apDespillKernel_prot1_tolerance {{parent.prot1_tolerance}}
  apDespillKernel_prot1_mult {{parent.prot1_effect}}
  apDespillKernel_prot1_falloff {{parent.prot1_falloff}}
  apDespillKernel_pickSpill {{parent.pick} {parent.pick} {parent.pick}}
  rebuild_finalise ""
  maxGPUMemory 60
  maxTileLines 8
  name apDespillKernel
  xpos 559
  ypos -582
 }
 Log2Lin {
  name Log2Lin2
  xpos 559
  ypos -520
  disable {{!logspace}}
 }
 Colorspace {
  channels {{{parent.Colorspace5.channels}}}
  colorspace_in {{parent.Colorspace1.colorspace_out}}
  illuminant_in {{parent.Colorspace1.illuminant_out}}
  primary_in {{parent.Colorspace1.primary_out}}
  name Colorspace2
  label "\[value colorspace_in] >> \[value colorspace_out]"
  xpos 559
  ypos -494
 }
push $N936045b0
 Merge2 {
  inputs 2+1
  operation copy
  bbox B
  name Merge
  xpos 449
  ypos -447
 }
 Output {
  name Output
  xpos 449
  ypos -400
 }
end_group
Dot {
 name Dot294
 selected true
 xpos -3071
 ypos -2085
}
set N933c0400 [stack 0]
push $N935e6b10
Dot {
 name Dot293
 selected true
 xpos -2489
 ypos -2516
}
Merge2 {
 inputs 2
 operation from
 name Merge13
 label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
 selected true
 xpos -2523
 ypos -2089
}
Saturation {
 saturation 0
 name Saturation1
 selected true
 xpos -2523
 ypos -2038
}
Dot {
 name Dot295
 selected true
 xpos -2489
 ypos -1947
}
Dot {
 name Dot296
 label "Restore Lum"
 note_font_size 41
 selected true
 xpos -2944
 ypos -1947
}
push $N933c0400
Merge2 {
 inputs 2
 operation plus
 output {rgba.red rgba.green rgba.blue -rgba.alpha}
 name Merge6
 selected true
 xpos -3105
 ypos -1951
}
Dot {
 name Dot297
 label "core \ndespill"
 note_font_size 60
 selected true
 xpos -3071
 ypos -1591
}
Dot {
 name Dot298
 selected true
 xpos -3071
 ypos -570
}
Dot {
 name Dot299
 label "core \ndespill"
 note_font_size 60
 selected true
 xpos -1722
 ypos -570
}
push $N935d7820
Dot {
 name Dot300
 note_font_size 41
 selected true
 xpos -1193
 ypos -693
}
push $N919a5f20
Remove {
 operation keep
 channels rgb
 name Remove34
 selected true
 xpos -1457
 ypos -2878
}
Dot {
 name Dot301
 selected true
 xpos -1423
 ypos -2529
}
set N9381fb20 [stack 0]
Group {
 name apDespill2
 help "apDespill v1.0 by Adrian Pueyo\n\nGizmo to despill an image, with options to despill any hue (and not only the primaries), select different algorithms for des/respilling, and protect tones from the despill.\n\nIf you just want a basic despill, its default values should already be enough and the tool will avoid any extra calculations.\n\nadrianpueyo.com, 2014-2017"
 onCreate "n = nuke.thisNode()\nn\['tolerance'].setRange(0,2)\nn\['prot1_tolerance'].setFlag(0x00000004)\nn\['prot1_effect'].setFlag(0x00000004)"
 knobChanged "n = nuke.thisNode()\nk = nuke.thisKnob()\nif k.name() == \"color\":\n    if k.getValue() == 0:\n        n\[\"custom_weight\"].setLabel(\"green - blue\")\n    elif k.getValue() == 1:\n        n\[\"custom_weight\"].setLabel(\"red - blue\")\n    elif k.getValue() == 2:\n        n\[\"custom_weight\"].setLabel(\"red - green\")\n    n\[\"pick\"].setVisible(k.getValue() == 3)\nelif k.name() == \"mode\":\n    n\[\"custom_weight\"].setVisible(n\[\"mode\"].getValue()==3)\nelif k.name() in \[\"out\",\"output_alpha\"]:\n    n\[\"respill_math\"].setEnabled(n\[\"out\"].getValue()==0 or n\[\"output_alpha\"].getValue()==1)\n    n\[\"respill_color\"].setEnabled(n\[\"out\"].getValue()==0)\nelif k.name() == \"prot1_activate\":\n    protA = n\[\"prot1_activate\"].value()\n    n\[\"prot1_preview\"].setEnabled(protA)\n    n\[\"prot1\"].setVisible(protA)\n    n\[\"prot1_tolerance\"].setVisible(protA)\n    n\[\"prot1_falloff\"].setVisible(protA)\n    n\[\"prot1_effect\"].setVisible(protA)"
 tile_color 0x8b8b8bff
 selected true
 xpos -1457
 ypos -2313
 addUserKnob {20 apDespill}
 addUserKnob {6 pick_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {41 "Local GPU: " T apDespillKernel.gpuName}
 addUserKnob {41 "Use GPU if Available" T apDespillKernel.useGPUIfAvailable}
 addUserKnob {41 vectorize l "Vectorize on CPU" -STARTLINE T apDespillKernel.vectorize}
 addUserKnob {26 ""}
 addUserKnob {4 color t "Select a primary as a starting point, or custom to show RGB controls to select any color." M {red green blue custom ""}}
 color green
 addUserKnob {18 pick +HIDDEN}
 pick {0 0 0}
 addUserKnob {6 pick_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 pick_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 pick_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 pick_panelDropped_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 pick_panelDropped_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 pick_panelDropped_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 dfg_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {4 out l output t "Quick switch to output the despilled image or the substracted one." M {despill spill}}
 addUserKnob {6 output_alpha l "output spill matte in alpha" t "Output the spill luminance in the alpha channel." -STARTLINE}
 addUserKnob {4 mode l "despill math" t "average = avg of other two channels\nmaximum = max of other two channels\nminimum = min of other two channels\ncustom = select custom weights" M {average maximum minimum custom}}
 addUserKnob {4 logLin l "Colorspace Log/Lin" -STARTLINE +INVISIBLE M {Log Lin ""}}
 logLin Lin
 addUserKnob {6 logspace l "Log Space" -STARTLINE}
 addUserKnob {7 custom_weight l "red - blue" t "-1 = only capped by the first channel\n0 = capped by avg of both\n1 = only capped by the second channel" -STARTLINE +HIDDEN R -1 1}
 addUserKnob {41 colorspace_out l colorspace T Colorspace1.colorspace_out}
 addUserKnob {41 illuminant_out l "" -STARTLINE T Colorspace1.illuminant_out}
 addUserKnob {41 primary_out l "" -STARTLINE T Colorspace1.primary_out}
 addUserKnob {26 text l " " T " "}
 addUserKnob {7 hue_offset l "hue offset" t "Rotate the despill vectors to despill an arbitrary tone other than the primaries.\nNote: A rotation of +-120 degrees is the same as selecting another color channel." R -180 180}
 addUserKnob {7 tolerance t "Use this to multiply the hue tolerance (the limiter value). You can move it all the way down to 0 to completely remove a hue from your image." R 0 2}
 tolerance 1
 addUserKnob {6 prot1_activate l "protect tones" t "Enable controls to select tones to protect from despilling." +STARTLINE}
 addUserKnob {6 prot1_preview l preview t "Output the protected tones." -STARTLINE +DISABLED}
 addUserKnob {18 prot1 l protect t "Pick the central hue to protect.\n(ctrl/cmd+alt+click)" +HIDDEN}
 prot1 {0 0 0}
 addUserKnob {6 prot1_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 prot1_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 prot1_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 prot1_panelDropped_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 prot1_panelDropped_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 prot1_panelDropped_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {7 prot1_tolerance l tolerance t "Amount of hues to include in the selection." +HIDDEN}
 prot1_tolerance 0.2
 addUserKnob {7 prot1_falloff l falloff t "Falloff for the hue selection. A higher falloff will make hues apart from the picked one lose weight more quickly." +HIDDEN R 0 4}
 prot1_falloff 2
 addUserKnob {7 prot1_effect l effect t "Multiplier for the hue protection, and for the spill limit value." +HIDDEN R 0 10}
 prot1_effect 1
 addUserKnob {26 respill_divider l "" +STARTLINE}
 addUserKnob {4 respill_math l "respill math" t "Settings for the way of desaturating the spill before adding it back." M {"Rec 709" "Ccir 601" Average Maximum "" ""}}
 addUserKnob {18 respill_color l "respill color" t "RGB multiplier for the desaturated spill when adding it back.\n\nNote: if used on non-degrained plates (which should be avoided anyway), any value other than 1 here will most likely produce grain artifacts." R 0 4}
 respill_color 1
 addUserKnob {6 respill_color_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 respill_color_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 respill_color_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 respill_color_panelDropped_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 respill_color_panelDropped_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 respill_color_panelDropped_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {26 ""}
 addUserKnob {41 maskChannelMask l mask T Merge.maskChannelMask}
 addUserKnob {41 inject -STARTLINE T Merge.inject}
 addUserKnob {41 invert_mask l invert -STARTLINE T Merge.invert_mask}
 addUserKnob {41 fringe -STARTLINE T Merge.fringe}
 addUserKnob {41 mix T Merge.mix}
 addUserKnob {26 version_author l "" t "apDespill v1.0\n14 March, 2017" +STARTLINE T "<span style=\"color:#666\"><br/><b>apDespill v1.0</b> - <a href=\"http://www.adrianpueyo.com\" style=\"color:#666;text-decoration: none;\">adrianpueyo.com</a>, 2014-2017</span>"}
 addUserKnob {20 GPU_Settings l "GPU Settings"}
 addUserKnob {41 maxGPUMemory l "Percentage of GPU memory to use" T apDespillKernel.maxGPUMemory}
 addUserKnob {41 maxTileLines l "Percentage of image height per tile" T apDespillKernel.maxTileLines}
}
 Input {
  inputs 0
  name Inputmask
  xpos 339
  ypos -447
  number 1
 }
 Input {
  inputs 0
  name Inputimg
  xpos 449
  ypos -764
 }
set N9320ed60 [stack 0]
 Colorspace {
  name Colorspace1
  label "\[value colorspace_in] >> \[value colorspace_out]"
  xpos 559
  ypos -703
 }
 Log2Lin {
  operation lin2log
  name Log2Lin1
  xpos 559
  ypos -665
  disable {{!logspace}}
 }
 Shuffle {
  name Shuffle
  xpos 559
  ypos -608
  disable {{"\[exists parent.input0]"}}
 }
 BlinkScript {
  ProgramGroup 1
  KernelDescription "2 \"apDespillKernel\" iterate pixelWise 86d17838f15464a9e9273cd415388c19006f9163a6efd15e7ad521c828dc89ac 2 \"src\" Read Point \"dst\" Write Point 17 \"limit\" Float 1 AACAPw== \"shift\" Float 1 AAAAAA== \"weights\" Float 1 AAAAAA== \"outmode\" Int 1 AAAAAA== \"output_alpha\" Int 1 AAAAAA== \"clr\" Int 1 AAAAAA== \"mode\" Int 1 AAAAAA== \"respill_math\" Int 1 AAAAAA== \"respill_color\" Float 4 AAAAAAAAAAAAAAAAAAAAAA== \"prot1_on\" Int 1 AAAAAA== \"prot1_preview\" Int 1 AAAAAA== \"prot1\" Float 3 AAAAAAAAAAAAAAAAAAAAAA== \"prot1_tolerance\" Float 1 AAAAAA== \"prot1_mult\" Float 1 AAAAAA== \"prot1_falloff\" Float 1 AAAAAA== \"lumaHueShift\" Int 1 AAAAAA== \"pickSpill\" Float 3 AAAAAAAAAAAAAAAAAAAAAA== 17 \"limit\" 1 1 \"shift\" 1 1 \"weights\" 1 1 \"outmode\" 1 1 \"output_alpha\" 1 1 \"clr\" 1 1 \"mode\" 1 1 \"respill_math\" 1 1 \"respill_color\" 4 1 \"prot1_on\" 1 1 \"prot1_preview\" 1 1 \"prot1\" 3 1 \"prot1_tolerance\" 1 1 \"prot1_mult\" 1 1 \"prot1_falloff\" 1 1 \"lumaHueShift\" 1 1 \"pickSpill\" 3 1 3 \"_usePicked\" Int 1 1 AAAAAA== \"_clr\" Int 1 1 AAAAAA== \"_ret\" Int 1 1 AAAAAA=="
  kernelSource "//---------------------------------------------------------\n// apDespillKernel - apDespill v1.0 by Adrian Pueyo\n//\n// Despill an image, with options to despill any hue (and\n// not only the primaries), select different algorithms for\n// des/respilling, and protect tones from the despill.\n//\n// adrianpueyo.com, 2014-2017\n// ---------------------------------------------------------\n\nstatic inline float y_convert_ccir601(const float4 in)\{\n  return in.x * 0.299f + in.y * 0.587f + in.z * 0.114f;\n\}\n\nstatic inline float y_convert_rec709(const float4 in)\{\n  return in.x * 0.2125f + in.y * 0.7154f + in.z * 0.0721f;\n\}\n\nstatic inline float4 hueShift(const float4 in, const float H)\{\n  if(H==0.0f)\{\n    return in;\n  \}else\{\n    float U = cos(H*PI/180);\n    float W = sin(H*PI/180);\n    float3 ret;\n    ret.x = (.299+.701*U+.168*W)*in.x + (.587-.587*U+.330*W)*in.y + (.114-.114*U-.497*W)*in.z;\n    ret.y = (.299-.299*U-.328*W)*in.x + (.587+.413*U+.035*W)*in.y + (.114-.114*U+.292*W)*in.z;\n    ret.z = (.299-.3*U+1.25*W)*in.x + (.587-.588*U-1.05*W)*in.y + (.114+.886*U-.203*W)*in.z;\n    return float4(ret.x,ret.y,ret.z,in\[3]);\n  \}\n\}\n\nstatic inline float4 hueRotate(const float4 in, const float H)\{\n  if(H==0.0f)\{\n    return in;\n  \}else\{\n    float cosH = cos(H*PI/180);\n    float sinH = sin(H*PI/180);\n    float3 ret;\n    ret.x = (in.x+in.y+in.z)*(1-cosH)/3 + in.x*cosH + (-in.y/sqrt(3.0f)+in.z/sqrt(3.0f))*sinH;\n    ret.y = (in.x+in.y+in.z)*(1-cosH)/3 + in.y*cosH + (in.x/sqrt(3.0f)-in.z/sqrt(3.0f))*sinH;\n    ret.z = (in.x+in.y+in.z)*(1-cosH)/3 + in.z*cosH + (-in.x/sqrt(3.0f)+in.y/sqrt(3.0f))*sinH;\n    return float4(ret.x,ret.y,ret.z,in\[3]);\n  \}\n\}\n\nfloat3 vecToPlane(float3 v1, float3 v2 = float3(1.0f,1.0f,1.0f))\{\n  float3 v1onv2;\n  v1onv2 = v2 * float((float(dot(v2,v1))/float(dot(v2,v2)))); //Projection of vector on another (plane's normal)\n  return v1-v1onv2; //Projection of vector on plane\n\}\n\nstatic inline float colorAngle(const float3 v1, const float3 v2)\{\n  const float3 vN=float3(1.0f,1.0f,1.0f);\n  float ang = acos(float(dot(v1,v2))/float(sqrt(dot(v1,v1)*dot(v2,v2))));\n  float3 crs = cross(v1,v2);\n  if (dot(vN, crs) > 0) \{\n    ang = -ang;\n  \}\n  return ang;\n\}\n\nkernel apDespillKernel : ImageComputationKernel<ePixelWise>\n\{\n  Image<eRead, eAccessPoint, eEdgeClamped> src;\n  Image<eWrite> dst;\n\n  param:\n    float limit;\n    float shift;\n    float weights;\n    int outmode;//0=despill,1=spill\n    int output_alpha;\n    int clr; //0=red,1=green,2=blue\n    int mode; //0=average,1=maximum,2=minimum,3=custom\n    int respill_math; //0=Rec709,1=Ccir601,2=Avg,3=Max\n    float4 respill_color;\n    int prot1_on;\n    int prot1_preview;\n    float3 prot1;\n    float prot1_tolerance;\n    float prot1_mult;\n    float prot1_falloff;\n    int lumaHueShift;//If disabled, the hue is just rotated without the luma coefficients\n    float3 pickSpill;\n  local:\n    int _usePicked;\n    int _clr;\n    int _ret;\n\n  void define() \{\n    defineParam(limit, \"limit\", 1.0f);\n    defineParam(shift, \"shift\", 0.0f);\n  \}\n\n  void init() \{\n    _ret = 0;\n    if(clr!=3)\{//red green or blue\n      _usePicked = 0;\n      _clr = clr;\n    \}else if(pickSpill.x==pickSpill.y && pickSpill.x==pickSpill.z)\{\n      _ret = 1;//if \"custom\" selected but has a gray value, avoid any calculations\n    \}else\{\n      _usePicked = 1;\n      _clr = 0;\n    \}\n  \}\n\n  void process() \{\n\n    if(_ret == 1)\{ dst()=src(); return; \}//Avoid any calculations if no despill selected\n    //0. Calculate autoShift if picked spill is not 0\n    float autoShift = 0.0f;\n    if(_usePicked==1)\{\n      float3 vNorm = float3(1.0f,1.0f,1.0f);\n      autoShift = colorAngle(vecToPlane(pickSpill,vNorm),vecToPlane(float3(1.0f,0.0f,0.0f),vNorm));\n      autoShift = autoShift*180/PI;//to deg\n    \}\n\n    //1. HueShift IN\n    float4 despilled;\n    if (lumaHueShift==1)\{\n      despilled = hueShift(src(),shift-autoShift);\n    \}else\{\n      despilled = hueRotate(src(),shift-autoShift);\n    \}\n\n    //2. Calculate the limit\n    float resultLimit = 0.0f;\n    int2 others;\n    if(_clr==0)\{//If red (and if _usePicked, also set red)\n      others = int2(1,2);\n    \}else if(_clr==1)\{\n      others=int2(0,2);\n    \}else if(_clr==2)\{\n      others=int2(0,1);\n    \}\n\n    if(mode==0)\{//average\n      resultLimit = (despilled\[others\[0]]+despilled\[others\[1]])/2;\n    \}else if(mode==1)\{//max\n      resultLimit = max(despilled\[others\[0]],despilled\[others\[1]]);\n    \}else if(mode==2)\{//min\n      resultLimit = min(despilled\[others\[0]],despilled\[others\[1]]);\n    \}else\{//custom\n      resultLimit = despilled\[others\[0]]*weights+despilled\[others\[1]]*(1-weights);\n    \}\n\n    //3. Protect tones\n    float prot1_result;\n    if(prot1_on==1&&(prot1\[0]!=prot1\[1]||prot1\[0]!=prot1\[2]||prot1\[1]!=prot1\[2]))\{\n      float cos_prot1_angle;\n      cos_prot1_angle = (src(0)*prot1\[0]+src(1)*prot1\[1]+src(2)*prot1\[2]) / (sqrt(prot1\[0]*prot1\[0]+prot1\[1]*prot1\[1]+prot1\[2]*prot1\[2]) * sqrt(src(0)*src(0)+src(1)*src(1)+src(2)*src(2)));\n      prot1_result = pow(clamp(cos_prot1_angle,0.0f,1.0f),1/pow(prot1_tolerance,prot1_falloff));\n      resultLimit = resultLimit*(1+prot1_result*prot1_mult);\n    \}\n    \n\n    //4. Calculate the despill and return the hue shift\n    for (int component = 0; component < dst.kComps; component++)\{\n      despilled\[component] = component==_clr?min(despilled\[component],resultLimit*limit):despilled\[component];\n    \}\n    if (lumaHueShift==1)\{\n      despilled = hueShift(despilled,-shift+autoShift);\n    \}else\{\n      despilled = hueRotate(despilled,-shift+autoShift);\n    \}\n\n    //5. Respill/restore despill values\n    float luma;\n    float4 spill = src()-despilled;\n    if(respill_math==0)\{\n      luma = y_convert_rec709(spill);\n    \}else if(respill_math==1)\{\n      luma = y_convert_ccir601(spill);\n    \}else if(respill_math==2)\{\n      luma = (spill\[0]+spill\[1]+spill\[2])/3;\n    \}else\{\n      luma = max(max(spill\[0],spill\[1]),spill\[2]);\n    \}\n\n    //6. Output (options)\n    if(prot1_preview==1 && prot1_on==1)\{\n      dst() = src()*clamp(prot1_result*prot1_mult,0.0f,1.0f);\n    \}else if(outmode==0)\{\n      dst() = despilled+luma*respill_color;\n      if(output_alpha==0)\{\n        dst(3)=src(3);\n      \}else\{\n        dst(3)=luma;\n      \}\n    \}else\{\n      if(output_alpha==0)\{\n        spill\[3]=src(3);\n      \}else\{\n        spill\[3]=luma;\n      \}\n      dst() = spill;\n    \}\n    //dst() = hueRotate(src(),shift-autoShift);\n    //dst() = autoShift;\n  \}\n\};"
  rebuild ""
  apDespillKernel_limit {{parent.tolerance}}
  apDespillKernel_shift {{parent.hue_offset}}
  apDespillKernel_weights {{(parent.custom_weight+1)/2}}
  apDespillKernel_outmode {{parent.out}}
  apDespillKernel_output_alpha {{parent.output_alpha}}
  apDespillKernel_clr {{parent.color}}
  apDespillKernel_mode {{parent.mode}}
  apDespillKernel_respill_math {{parent.respill_math}}
  apDespillKernel_respill_color {{parent.respill_color.r} {parent.respill_color.g} {parent.respill_color.b} 1}
  apDespillKernel_prot1_on {{parent.prot1_activate}}
  apDespillKernel_prot1_preview {{parent.prot1_preview}}
  apDespillKernel_prot1 {{parent.prot1} {parent.prot1} {parent.prot1}}
  apDespillKernel_prot1_tolerance {{parent.prot1_tolerance}}
  apDespillKernel_prot1_mult {{parent.prot1_effect}}
  apDespillKernel_prot1_falloff {{parent.prot1_falloff}}
  apDespillKernel_pickSpill {{parent.pick} {parent.pick} {parent.pick}}
  rebuild_finalise ""
  maxGPUMemory 60
  maxTileLines 8
  name apDespillKernel
  xpos 559
  ypos -582
 }
 Log2Lin {
  name Log2Lin2
  xpos 559
  ypos -520
  disable {{!logspace}}
 }
 Colorspace {
  channels {{{parent.Colorspace5.channels}}}
  colorspace_in {{parent.Colorspace1.colorspace_out}}
  illuminant_in {{parent.Colorspace1.illuminant_out}}
  primary_in {{parent.Colorspace1.primary_out}}
  name Colorspace2
  label "\[value colorspace_in] >> \[value colorspace_out]"
  xpos 559
  ypos -494
 }
push $N9320ed60
 Merge2 {
  inputs 2+1
  operation copy
  bbox B
  name Merge
  xpos 449
  ypos -447
 }
 Output {
  name Output
  xpos 449
  ypos -400
 }
end_group
set N92be2200 [stack 0]
Shuffle {
 red alpha
 green alpha
 blue alpha
 name Shuffle18
 tile_color 0xffffffff
 selected true
 xpos -1331
 ypos -2313
}
Grade {
 channels rgba
 blackpoint 0.0001
 whitepoint 0.01
 name Grade2
 selected true
 xpos -1331
 ypos -2261
}
push $N92be2200
Saturation {
 inputs 1+1
 saturation 0.67
 name Saturation4
 selected true
 xpos -1457
 ypos -2261
}
Dot {
 name Dot303
 selected true
 xpos -1423
 ypos -1973
}
set N9395bb60 [stack 0]
push $N9381fb20
Dot {
 name Dot302
 selected true
 xpos -809
 ypos -2529
}
Merge2 {
 inputs 2
 operation from
 name Merge5
 label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
 selected true
 xpos -843
 ypos -1977
}
Clamp {
 channels rgba
 maximum_enable false
 name Clamp1
 selected true
 xpos -843
 ypos -1951
}
Saturation {
 saturation 0
 name Saturation2
 selected true
 xpos -843
 ypos -1925
}
Clamp {
 channels rgba
 maximum_enable false
 name Clamp3
 selected true
 xpos -843
 ypos -1899
}
Shuffle {
 green red
 blue red
 alpha red
 name Shuffle11
 tile_color 0x93000000
 selected true
 xpos -843
 ypos -1873
}
Dot {
 name Dot304
 label "despill\nmatte"
 note_font_size 60
 selected true
 xpos -809
 ypos -1796
}
set N9399f500 [stack 0]
Dot {
 name Dot305
 label "despill\nMatte"
 note_font_size 60
 selected true
 xpos -809
 ypos -1599
}
push $N9395bb60
Dot {
 name Dot306
 selected true
 xpos -1423
 ypos -1797
}
set N939a7290 [stack 0]
add_layer {despill despill.red}
Copy {
 inputs 2
 from0 rgba.red
 to0 despill.red
 name Copy7
 selected true
 xpos -1457
 ypos -1609
}
Dot {
 name Dot307
 label "edge\ndespill"
 note_font_size 60
 selected true
 xpos -1423
 ypos -847
}
Multiply {
 inputs 1+1
 channels despill
 value 0
 name Multiply2
 label "\[value value]"
 selected true
 xpos -1457
 ypos -705
}
Keymix {
 inputs 3
 channels rgb
 name Keymix3
 selected true
 xpos -1457
 ypos -574
}
add_layer {despill_RGB despill_RGB.red despill_RGB.green despill_RGB.blue despill_RGB.alpha}
Shuffle {
 black red
 white green
 red2 blue
 green2 black
 out2 despill_RGB
 name Shuffle26
 label "\[value in] → \[value out2]"
 selected true
 xpos -1457
 ypos -501
}
Copy {
 inputs 2
 channels all
 name Copy12
 selected true
 xpos -1457
 ypos -14
}
CopyBBox {
 inputs 2
 name CopyBBox3
 selected true
 xpos -1457
 ypos 48
}
Copy {
 inputs 2
 from0 rgba.alpha
 to0 rgba.alpha
 bbox B
 name Copy14
 selected true
 xpos -1457
 ypos 303
}
Copy {
 inputs 2
 channels cleanplate
 bbox B
 name Copy15
 selected true
 xpos -1457
 ypos 659
}
Dot {
 name Dot313
 note_font_size 41
 selected true
 xpos -1423
 ypos 1063
}
Dot {
 name Dot314
 note_font_size 41
 selected true
 xpos -1423
 ypos 1524
}
Dot {
 name Dot315
 note_font_size 41
 selected true
 xpos -1423
 ypos 1850
}
Dot {
 name Dot15
 note_font_size 41
 selected true
 xpos -1423
 ypos 2372
}
set N939f8230 [stack 0]
Dot {
 name Dot7
 note_font_size 41
 selected true
 xpos -1159
 ypos 2372
}
set N93a000b0 [stack 0]
Dot {
 name Dot108
 note_font_size 41
 selected true
 xpos -968
 ypos 2372
}
set N93a04010 [stack 0]
Shuffle {
 in despill
 name Shuffle23
 label "\[value in]"
 selected true
 xpos -1002
 ypos 2416
}
Remove {
 operation keep
 channels rgba
 name Remove2
 selected true
 xpos -1002
 ypos 2454
}
NoOp {
 name Anchor_30be3b7c88
 help "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019"
 onCreate "if nuke.GUI:\n    try:\n        import stamps; stamps.anchorOnCreate()\n    except:\n        pass"
 knobChanged stamps.anchorKnobChanged()
 autolabel "nuke.thisNode().knob(\"title\").value()"
 tile_color 0xffffff01
 note_font_size 20
 selected true
 xpos -1002
 ypos 2505
 addUserKnob {20 anchor_tab l "Anchor Stamp"}
 addUserKnob {26 identifier -STARTLINE +HIDDEN T anchor}
 addUserKnob {1 title l Title: t "Displayed name on the Node Graph for this Stamp and its Anchor.\nIMPORTANT: This is only for display purposes, and is different from the real/internal name of the Stamps."}
 title "despill Mask"
 addUserKnob {26 prev_title l "" +STARTLINE +HIDDEN T Despill}
 addUserKnob {26 prev_name l "" +STARTLINE +HIDDEN T Anchor_30be3b7c88}
 addUserKnob {3 showing l "" +STARTLINE +HIDDEN}
 addUserKnob {1 tags l Tags t "Comma-separated tags you can define for each Anchor, that will help you find it when invoking the Stamp Selector by pressing the Stamps shortkey with nothing selected."}
 tags 2D,
 addUserKnob {26 line1 l "" +STARTLINE}
 addUserKnob {26 stamps_label l Stamps: T " "}
 addUserKnob {22 createStamp l new t "Create a new Stamp for this Anchor." -STARTLINE T stamps.stampCreateWired(nuke.thisNode())}
 addUserKnob {22 selectStamps l select t "Reconnect all of this Anchor's Stamps." -STARTLINE T stamps.wiredSelectSimilar(nuke.thisNode().name())}
 addUserKnob {22 reconnectStamps l reconnect -STARTLINE T stamps.anchorReconnectWired()}
 addUserKnob {22 zoomNext l "zoom next" t "Navigate to this Anchor's next Stamp on the Node Graph." -STARTLINE T stamps.wiredZoomNext(nuke.thisNode().name())}
 addUserKnob {26 line2 l "" +STARTLINE}
 addUserKnob {22 buttonHelp l Help -STARTLINE T stamps.showHelp()}
 addUserKnob {26 version l " " t "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019." -STARTLINE T "<a href=\"http://www.nukepedia.com/gizmos/other/stamps\" style=\"color:#666;text-decoration: none;\"><span style=\"color:#666\"> <big>Stamps v1.0</big></b></a>"}
}
NoOp {
 name Stamp40
 help "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019"
 onCreate "if nuke.GUI:\n    try:\n        import stamps; stamps.wiredOnCreate()\n    except:\n        pass\n"
 knobChanged "import stamps; stamps.wiredKnobChanged()"
 autolabel "nuke.thisNode().knob(\"title\").value()"
 tile_color 0x1000001
 note_font "Bitstream Vera Sans"
 note_font_size 20
 selected true
 xpos -1079
 ypos 2899
 hide_input true
 addUserKnob {20 wired_tab l "Wired Stamp"}
 addUserKnob {26 identifier -STARTLINE +HIDDEN T wired}
 addUserKnob {3 lockCallbacks l "" +STARTLINE +HIDDEN}
 addUserKnob {6 toReconnect -STARTLINE +HIDDEN}
 addUserKnob {1 title l Title: t "Displayed name on the Node Graph for this Stamp and its Anchor.\nIMPORTANT: This is only for display purposes, and is different from the real/internal name of the Stamps."}
 title "despill Mask"
 addUserKnob {26 prev_title l "" +STARTLINE +HIDDEN T "despill Mask"}
 addUserKnob {26 tags l Tags: t "Tags of this stamp's Anchor, for information purpose only.\nClick \"show anchor\" to change them." T <i>2D</i>}
 addUserKnob {26 backdrops l Backdrops: t "Labels of backdrop nodes which contain this stamp's Anchor." T "<i>Advanced Keying Template</i>"}
 addUserKnob {26 line1 l "" +STARTLINE}
 addUserKnob {26 anchor_label l Anchor: T " "}
 addUserKnob {22 show_anchor l " show anchor " t "Show the properties panel for this Stamp's Anchor." -STARTLINE T stamps.wiredShowAnchor()}
 addUserKnob {22 zoom_anchor l "zoom anchor" t "Navigate to this Stamp's Anchor on the Node Graph." -STARTLINE T stamps.wiredZoomAnchor()}
 addUserKnob {26 stamps_label l Stamps: T " "}
 addUserKnob {22 zoomNext l " zoom next " t "Navigate to this Stamp's next sibling on the Node Graph." -STARTLINE T stamps.wiredZoomNext()}
 addUserKnob {22 selectSimilar l " select similar " t "Select all similar Stamps to this one on the Node Graph." -STARTLINE T stamps.wiredSelectSimilar()}
 addUserKnob {26 space_1 l "" +STARTLINE T " "}
 addUserKnob {26 reconnect_label l Reconnect: t "Reconnect by the stored Anchor name." T " "}
 addUserKnob {22 reconnect_this l this t "Reconnect this Stamp to its Anchor, by its stored Anchor name." -STARTLINE T "n = nuke.thisNode()\ntry:\n    n.setInput(0,nuke.toNode(n.knob(\"anchor\").value()))\nexcept:\n    nuke.message(\"Unable to reconnect.\")\ntry:\n    import stamps\n    stamps.wiredGetStyle(n)\nexcept:\n    pass\n"}
 addUserKnob {22 reconnect_similar l similar t "Reconnect this Stamp and similar ones to their Anchor, by their stored anchor name." -STARTLINE T stamps.wiredReconnectSimilar()}
 addUserKnob {22 reconnect_all l all t "Reconnect all the Stamps to their Anchors, by their stored anchor names." -STARTLINE T stamps.wiredReconnectAll()}
 addUserKnob {26 space_2 l "" +STARTLINE T " "}
 addUserKnob {20 advanced_reconnection l "Advanced Reconnection" n 2}
 addUserKnob {26 reconnect_by_title_label l "<font color=gold>By Title:" t "Reconnect by searching for a matching title." T " "}
 addUserKnob {22 reconnect_by_title_this l this t "Look for an Anchor that shares this Stamp's title, and connect this Stamp to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitle()}
 addUserKnob {22 reconnect_by_title_similar l similar t "Look for an Anchor that shares this Stamp's title, and connect this Stamp and similar ones to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitleSimilar()}
 addUserKnob {22 reconnect_by_title_selected l selected t "For each Stamp selected, look for an Anchor that shares its title, and connect to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitleSelected()}
 addUserKnob {26 reconnect_by_selection_label l "<font color=orangered>By Selection:" t "Force reconnect to a selected Anchor." T " "}
 addUserKnob {22 reconnect_by_selection_this l this t "Force reconnect this Stamp to a selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelection()}
 addUserKnob {22 reconnect_by_selection_similar l similar t "Force reconnect this Stamp and similar ones to a selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelectionSimilar()}
 addUserKnob {22 reconnect_by_selection_selected l selected t "Force reconnect all selected Stamps to an also selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelectionSelected()}
 addUserKnob {1 anchor l Anchor}
 anchor Anchor_30be3b7c88
 addUserKnob {6 auto_reconnect_by_title l "<font color=#ED9977>&nbsp; auto-reconnect by title" t "When creating this stamp again (like on copy-paste), auto-reconnect it by title instead of doing it by the saved anchor's name, and auto-turn this off immediately.\nIMPORTANT: Should be off by default. Only use this for setting up templates." +STARTLINE}
 addUserKnob {20 advanced_reconnection_1 l "Advanced Reconnection" +INVISIBLE n -1}
 addUserKnob {26 line2 l "" +STARTLINE}
 addUserKnob {22 buttonHelp l Help -STARTLINE T stamps.showHelp()}
 addUserKnob {26 version l " " t "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019." -STARTLINE T "<a href=\"http://www.nukepedia.com/gizmos/other/stamps\" style=\"color:#666;text-decoration: none;\"><span style=\"color:#666\"> <big>Stamps v1.0</big></b></a>"}
}
Grade {
 channels rgba
 multiply 4
 black_clamp false
 name Grade4
 selected true
 xpos -1079
 ypos 2976
}
set N93a2c830 [stack 0]
Dot {
 name Dot318
 label "despill\nmatte"
 note_font_size 41
 selected true
 xpos -1045
 ypos 3112
}
set N93a38a50 [stack 0]
Dot {
 name Dot319
 note_font_size 41
 selected true
 xpos -1278
 ypos 3110
}
Dot {
 name Dot320
 note_font_size 41
 selected true
 xpos -1278
 ypos 3420
}
push $N914d1670
NoOp {
 name Stamp41
 help "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019"
 onCreate "if nuke.GUI:\n    try:\n        import stamps; stamps.wiredOnCreate()\n    except:\n        pass\n"
 knobChanged "import stamps; stamps.wiredKnobChanged()"
 autolabel "nuke.thisNode().knob(\"title\").value()"
 tile_color 0x1000001
 note_font "Bitstream Vera Sans"
 note_font_size 20
 selected true
 xpos -375
 ypos 2866
 hide_input true
 addUserKnob {20 wired_tab l "Wired Stamp"}
 addUserKnob {26 identifier -STARTLINE +HIDDEN T wired}
 addUserKnob {3 lockCallbacks l "" +STARTLINE +HIDDEN}
 addUserKnob {6 toReconnect -STARTLINE +HIDDEN}
 addUserKnob {1 title l Title: t "Displayed name on the Node Graph for this Stamp and its Anchor.\nIMPORTANT: This is only for display purposes, and is different from the real/internal name of the Stamps."}
 title "BG Before Key"
 addUserKnob {26 prev_title l "" +STARTLINE +HIDDEN T "BG Before Key"}
 addUserKnob {26 tags l Tags: t "Tags of this stamp's Anchor, for information purpose only.\nClick \"show anchor\" to change them." T <i>2D</i>}
 addUserKnob {26 backdrops l Backdrops: t "Labels of backdrop nodes which contain this stamp's Anchor." +HIDDEN T " "}
 addUserKnob {26 line1 l "" +STARTLINE}
 addUserKnob {26 anchor_label l Anchor: T " "}
 addUserKnob {22 show_anchor l " show anchor " t "Show the properties panel for this Stamp's Anchor." -STARTLINE T stamps.wiredShowAnchor()}
 addUserKnob {22 zoom_anchor l "zoom anchor" t "Navigate to this Stamp's Anchor on the Node Graph." -STARTLINE T stamps.wiredZoomAnchor()}
 addUserKnob {26 stamps_label l Stamps: T " "}
 addUserKnob {22 zoomNext l " zoom next " t "Navigate to this Stamp's next sibling on the Node Graph." -STARTLINE T stamps.wiredZoomNext()}
 addUserKnob {22 selectSimilar l " select similar " t "Select all similar Stamps to this one on the Node Graph." -STARTLINE T stamps.wiredSelectSimilar()}
 addUserKnob {26 space_1 l "" +STARTLINE T " "}
 addUserKnob {26 reconnect_label l Reconnect: t "Reconnect by the stored Anchor name." T " "}
 addUserKnob {22 reconnect_this l this t "Reconnect this Stamp to its Anchor, by its stored Anchor name." -STARTLINE T "n = nuke.thisNode()\ntry:\n    n.setInput(0,nuke.toNode(n.knob(\"anchor\").value()))\nexcept:\n    nuke.message(\"Unable to reconnect.\")\ntry:\n    import stamps\n    stamps.wiredGetStyle(n)\nexcept:\n    pass\n"}
 addUserKnob {22 reconnect_similar l similar t "Reconnect this Stamp and similar ones to their Anchor, by their stored anchor name." -STARTLINE T stamps.wiredReconnectSimilar()}
 addUserKnob {22 reconnect_all l all t "Reconnect all the Stamps to their Anchors, by their stored anchor names." -STARTLINE T stamps.wiredReconnectAll()}
 addUserKnob {26 space_2 l "" +STARTLINE T " "}
 addUserKnob {20 advanced_reconnection l "Advanced Reconnection" n 2}
 addUserKnob {26 reconnect_by_title_label l "<font color=gold>By Title:" t "Reconnect by searching for a matching title." T " "}
 addUserKnob {22 reconnect_by_title_this l this t "Look for an Anchor that shares this Stamp's title, and connect this Stamp to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitle()}
 addUserKnob {22 reconnect_by_title_similar l similar t "Look for an Anchor that shares this Stamp's title, and connect this Stamp and similar ones to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitleSimilar()}
 addUserKnob {22 reconnect_by_title_selected l selected t "For each Stamp selected, look for an Anchor that shares its title, and connect to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitleSelected()}
 addUserKnob {26 reconnect_by_selection_label l "<font color=orangered>By Selection:" t "Force reconnect to a selected Anchor." T " "}
 addUserKnob {22 reconnect_by_selection_this l this t "Force reconnect this Stamp to a selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelection()}
 addUserKnob {22 reconnect_by_selection_similar l similar t "Force reconnect this Stamp and similar ones to a selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelectionSimilar()}
 addUserKnob {22 reconnect_by_selection_selected l selected t "Force reconnect all selected Stamps to an also selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelectionSelected()}
 addUserKnob {1 anchor l Anchor}
 anchor Anchor_3cad2b60ea
 addUserKnob {6 auto_reconnect_by_title l "<font color=#ED9977>&nbsp; auto-reconnect by title" t "When creating this stamp again (like on copy-paste), auto-reconnect it by title instead of doing it by the saved anchor's name, and auto-turn this off immediately.\nIMPORTANT: Should be off by default. Only use this for setting up templates." +STARTLINE}
 addUserKnob {20 advanced_reconnection_1 l "Advanced Reconnection" +INVISIBLE n -1}
 addUserKnob {26 line2 l "" +STARTLINE}
 addUserKnob {22 buttonHelp l Help -STARTLINE T stamps.showHelp()}
 addUserKnob {26 version l " " t "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019." -STARTLINE T "<a href=\"http://www.nukepedia.com/gizmos/other/stamps\" style=\"color:#666;text-decoration: none;\"><span style=\"color:#666\"> <big>Stamps v1.0</big></b></a>"}
}
Dot {
 name Dot3
 note_font_size 41
 selected true
 xpos -341
 ypos 2941
}
set N93a4e120 [stack 0]
Dot {
 name Dot4
 note_font_size 41
 selected true
 xpos -341
 ypos 3508
}
Dot {
 name Dot20
 label BG
 note_font_size 101
 selected true
 xpos -946
 ypos 3508
}
push $N93a4e120
Dot {
 name Dot2
 note_font_size 41
 selected true
 xpos -739
 ypos 2941
}
Dot {
 name Dot321
 label BG
 note_font_size 101
 selected true
 xpos -739
 ypos 3029
}
Grade {
 blackpoint 0.008
 whitepoint 0.225
 black_clamp false
 name Grade6
 label "BG Prep"
 selected true
 xpos -773
 ypos 3108
}
Dot {
 name Dot322
 selected true
 xpos -739
 ypos 3197
}
push $N93a38a50
Merge2 {
 inputs 2
 operation multiply
 name Merge36
 selected true
 xpos -1079
 ypos 3195
}
Shuffle {
 alpha black
 name Shuffle40
 label "\[value in]"
 selected true
 xpos -1079
 ypos 3268
}
push $N93a2c830
Shuffle {
 green red
 blue red
 alpha red
 name Shuffle41
 label "\[value in]"
 selected true
 xpos -1288
 ypos 2972
}
Grade {
 channels rgba
 whitepoint 0.5
 black_clamp false
 white_clamp true
 name Grade7
 selected true
 xpos -1288
 ypos 3026
}
push $N939f8230
Remove {
 operation keep
 channels rgba
 channels2 GS_Plate
 name Remove6
 selected true
 xpos -1457
 ypos 2463
}
Saturation {
 inputs 1+1
 saturation 0.5
 name Saturation3
 label "change if necessary"
 selected true
 xpos -1457
 ypos 3022
}
Merge2 {
 inputs 2
 operation plus
 bbox B
 output {rgba.red rgba.green rgba.blue -rgba.alpha}
 name Merge49
 selected true
 xpos -1457
 ypos 3272
}
Group {
 inputs 3
 name BlacksMatch
 help "Choose a black point color or plug an image /constant you wish to be your blackpoint into BlackColor input.\n\nUse Mult Range to control how far above the blackpoint color to affect the lows\n\nUse the RollOff gamma to add fall off to the bottom of the curve\n\nTurn on the preview Plotscan and move the sampler over a region to see what your settings are doing to a linear 0-1 ramp.  This will help you see if you have weird curves, clamping or other funky problems as you adjust settings"
 knobChanged "n = nuke.thisNode()\nk = nuke.thisKnob()\n\nif k.name() == \"inputChange\":\n    nsd = nuke.toNode(\"SwitchDefault\")\n    n\[\"defaultBlack\"].setEnabled(nsd\[\"which\"].getValue()==1)\n\nif k.name() == \"previewPlotScan\":\n    p = n.knob(\"previewPlotScan\").value()\n    if p == True:\n        n.knob(\"plotscanSampler\").setVisible(True)\n    else:\n        n.knob(\"plotscanSampler\").setVisible(False)"
 tile_color 0x1c1c1cff
 note_font "Helvetica Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold Bold"
 selected true
 xpos -1457
 ypos 3505
 addUserKnob {20 BlacksMatch}
 addUserKnob {6 default_black_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 premultInput l "Premultiplied Input" +STARTLINE}
 addUserKnob {4 mergeOp l Operation: t "Plus and Screen do the same thing with our operation, so I only included a hypot between plus/screen and hypot.  Hypot raises the mult by x2 because I thought that gave more pleasising results.  It will probably be a harsher curve (more towards clamp) than the plus/screen result)." M {Plus/Screen Hypot "" ""}}
 addUserKnob {18 defaultBlack l "Default Black" +DISABLED}
 defaultBlack {0.05 0.05 0.05}
 addUserKnob {6 defaultBlack_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 defaultBlack_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 defaultBlack_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 defaultBlack_panelDropped_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 defaultBlack_panelDropped_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 defaultBlack_panelDropped_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 defaultBlack_panelDropped_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 defaultBlack_panelDropped_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 defaultBlack_panelDropped_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 defaultBlack_panelDropped_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 defaultBlack_panelDropped_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 defaultBlack_panelDropped_1_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 defaultBlack_panelDropped_1_1_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {26 ""}
 addUserKnob {7 multBase l "Mult Low Range" t "This is the Multiplier for the top of the \"toe\" curve.  It is multiplying the BlackPoint color by this number and setting it as the highest point weird the curve will influence the midtones and the highlights" R 1.5 10}
 multBase 4
 addUserKnob {7 rolloffGamma l "Rolloff Gamma" t "This controls the bottom of the curve, the falloff to where it is bending toward the \"cut off point\" which is out black color.  A lower value will act more like a clamp and a higher value will act more like a plus." R 0.1 1}
 rolloffGamma 0.35
 addUserKnob {4 minVal l "Min Value is:" M {"Toe Result" "Clamp Result" "" ""}}
 addUserKnob {6 previewPlotScan l "Preview PlotScan" t "Click to overlay a plotscan graph to show you how your black color is influenced by your settings." +STARTLINE}
 addUserKnob {12 plotscanSampler l "PlotScan Sampler" +HIDDEN}
 plotscanSampler {200 200}
 addUserKnob {6 color_rgb_panelDropped l "panel dropped state" +HIDDEN +STARTLINE}
 addUserKnob {26 ""}
 addUserKnob {41 maskChannelMask l mask -STARTLINE T MergeKeymix.maskChannelMask}
 addUserKnob {41 inject -STARTLINE T MergeKeymix.inject}
 addUserKnob {41 invert_mask l invert -STARTLINE T MergeKeymix.invert_mask}
 addUserKnob {41 fringe -STARTLINE T MergeKeymix.fringe}
 addUserKnob {41 mix T MergeKeymix.mix}
 addUserKnob {20 info l Info}
 addUserKnob {26 creator l Creator: T "<b><big>Tony Lyons"}
 addUserKnob {26 desc l Name: T BlacksMatch}
 addUserKnob {26 ver l Version: T v10}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x556a5000
  label "This Creates a \nPer Channel Key\nBased on the Blackpoint"
  note_font_size 30
  note_font_color 0xffffffff
  xpos 991
  ypos -77
  bdwidth 314
  bdheight 421
 }
 StickyNote {
  inputs 0
  name StickyNote2
  tile_color 0xff
  label green
  note_font_size 41
  note_font_color 0xffffffff
  xpos 177
  ypos 466
 }
 StickyNote {
  inputs 0
  name StickyNote1
  tile_color 0xff
  label red
  note_font_size 41
  note_font_color 0xffffffff
  xpos 188
  ypos 350
 }
 StickyNote {
  inputs 0
  name StickyNote3
  tile_color 0xff
  label blue
  note_font_size 41
  note_font_color 0xffffffff
  xpos 186
  ypos 570
 }
 StickyNote {
  inputs 0
  name StickyNote4
  tile_color 0xff
  label "min will be \nblack color"
  note_font_size 31
  note_font_color 0xffffffff
  xpos 143
  ypos 733
 }
 Input {
  inputs 0
  name Inputimg
  xpos 322
  ypos -550
 }
 Dot {
  name Dot17
  xpos 356
  ypos -418
 }
set N93aeb5f0 [stack 0]
 AddChannels {
  channels rgba
  color 1
  name AddChannels1
  xpos 322
  ypos -365
 }
 Dot {
  name Dot5
  note_font_size 41
  xpos 356
  ypos -288
 }
set N93af6a70 [stack 0]
 Grade {
  channels rgba
  white 0
  multiply 0
  add {{defaultBlack.r} {defaultBlack.g} {defaultBlack.b} 0}
  black_clamp false
  name Grade1
  label color
  xpos 922
  ypos -295
 }
 Input {
  inputs 0
  name InputBlackColor
  xpos 1138
  ypos -569
  number 1
 }
 Switch {
  inputs 2
  which {{"!\[exists parent.input1]"}}
  name SwitchDefault
  xpos 1138
  ypos -291
 }
 Dot {
  name Dot26
  label "Black Color"
  note_font_size 41
  xpos 1172
  ypos -212
 }
 Dot {
  name Dot4
  note_font_size 41
  xpos 1172
  ypos -151
 }
set N93b19980 [stack 0]
 Dot {
  name Dot36
  note_font_size 41
  xpos 1631
  ypos -151
 }
set N93b1d860 [stack 0]
 Dot {
  name Dot16
  note_font_size 41
  xpos 2140
  ypos -151
 }
set N93b21740 [stack 0]
 Crop {
  box {{plotscanSampler.x-2} {plotscanSampler.y-2} {plotscanSampler.x+2} {plotscanSampler.x+2}}
  reformat true
  crop false
  name Crop1
  xpos 2432
  ypos -154
  addUserKnob {20 User}
  addUserKnob {22 cropToBbox l "Crop to Bounding Box" -STARTLINE T codeBBox()}
  addUserKnob {22 cropToBbox_1 l "Crop to Bounding Box" -STARTLINE T codeBBox()}
 }
 Blur {
  channels rgb
  size 16
  name Blur1
  label "\[value size]"
  xpos 2432
  ypos -130
 }
 Reformat {
  format "512 512 0 0 512 512 1 square_512"
  name Reformat4
  xpos 2432
  ypos -92
 }
 Dot {
  name Dot12
  note_font_size 41
  xpos 2466
  ypos -43
 }
set N93b3cb20 [stack 0]
 Dot {
  name Dot47
  note_font_size 41
  xpos 2917
  ypos -43
 }
set N93b40a10 [stack 0]
 Dot {
  name Dot42
  label "Black Color"
  note_font_size 41
  xpos 2917
  ypos 286
 }
 Dot {
  name Dot43
  note_font_size 41
  xpos 2917
  ypos 366
 }
set N93b487d0 [stack 0]
 Dot {
  name Dot44
  note_font_size 41
  xpos 2917
  ypos 480
 }
set N93b4c6b0 [stack 0]
 Dot {
  name Dot45
  note_font_size 41
  xpos 2917
  ypos 588
 }
set N93b50710 [stack 0]
 Dot {
  name Dot31
  note_font_size 41
  xpos 2917
  ypos 656
 }
set N93b54530 [stack 0]
push $N93b54530
push $N93b40a10
 Dot {
  name Dot11
  label "Black Color"
  note_font_size 41
  xpos 3426
  ypos -43
 }
 Multiply {
  channels rgb
  value 2
  name Multiply6
  label "mult black color"
  xpos 3392
  ypos 77
 }
 Reformat {
  inputs 0
  format "512 512 0 0 512 512 1 square_512"
  pbb true
  name Reformat1
  xpos 2711
  ypos 61
 }
 Ramp {
  p0 {0 0}
  p1 {512 0}
  name Ramp1
  xpos 2711
  ypos 93
 }
 Dot {
  name Dot1
  note_font_size 41
  xpos 2745
  ypos 154
 }
set N93726030 [stack 0]
 Dot {
  name Dot7
  note_font_size 41
  xpos 3138
  ypos 154
 }
set N93843110 [stack 0]
 MergeExpression {
  inputs 2
  expr0 Br/Ar
  expr1 Bg/Ag
  expr2 Bb/Ab
  name MergeDivide2
  xpos 3392
  ypos 151
 }
 Invert {
  channels rgb
  name Invert5
  xpos 3392
  ypos 175
 }
 Clamp {
  channels rgb
  name Clamp4
  xpos 3392
  ypos 199
 }
 Gamma {
  channels rgb
  value 0.5
  name Gamma4
  xpos 3392
  ypos 223
 }
 Dot {
  name Dot39
  xpos 3426
  ypos 366
 }
set N93b8dc40 [stack 0]
 Dot {
  name Dot40
  xpos 3426
  ypos 480
 }
set N93b919d0 [stack 0]
 Dot {
  name Dot41
  xpos 3426
  ypos 588
 }
 Shuffle {
  red blue
  green blue
  alpha blue
  name Shuffle11
  tile_color 0x3fbfff
  label "\[value in] \[ expr \{ \[value out2] == \"none\" ? \" \" : \[concat --> \[value out2]] \}]"
  xpos 3277
  ypos 581
 }
push $N93b50710
push $N93b919d0
 Shuffle {
  red green
  blue green
  alpha green
  name Shuffle12
  tile_color 0xbf00ff
  label "\[value in] \[ expr \{ \[value out2] == \"none\" ? \" \" : \[concat --> \[value out2]] \}]"
  xpos 3276
  ypos 473
 }
push $N93b4c6b0
push $N93b8dc40
 Shuffle {
  green red
  blue red
  alpha red
  name Shuffle13
  tile_color 0xbf0000ff
  label "\[value in] \[ expr \{ \[value out2] == \"none\" ? \" \" : \[concat --> \[value out2]] \}]"
  xpos 3270
  ypos 359
 }
push $N93b487d0
push $N93843110
 Merge2 {
  inputs 2+1
  operation {{parent.Settings.mergeOpNum}}
  bbox B
  Achannels {rgba.red -rgba.green -rgba.blue -rgba.alpha}
  Bchannels {rgba.red -rgba.green -rgba.blue -rgba.alpha}
  output {rgba.red -rgba.green -rgba.blue -rgba.alpha}
  maskChannelInput -rgba.red
  name Merge14
  label red
  xpos 3104
  ypos 359
 }
 Merge2 {
  inputs 2+1
  operation {{parent.Settings.mergeOpNum}}
  bbox B
  Achannels {-rgba.red rgba.green -rgba.blue -rgba.alpha}
  Bchannels {-rgba.red rgba.green -rgba.blue -rgba.alpha}
  output {-rgba.red rgba.green -rgba.blue -rgba.alpha}
  maskChannelInput -rgba.red
  name Merge15
  label green
  xpos 3104
  ypos 473
 }
 Merge2 {
  inputs 2+1
  operation {{parent.Settings.mergeOpNum}}
  bbox B
  Achannels {-rgba.red -rgba.green rgba.blue -rgba.alpha}
  Bchannels {-rgba.red -rgba.green rgba.blue -rgba.alpha}
  output {-rgba.red -rgba.green rgba.blue -rgba.alpha}
  maskChannelInput -rgba.red
  name Merge16
  label blue
  xpos 3104
  ypos 581
 }
 Merge2 {
  inputs 2
  operation max
  bbox B
  Achannels rgb
  Bchannels rgb
  output rgb
  name Merge18
  label "Set Min Color\nto Blackpoint"
  xpos 3104
  ypos 644
 }
 Dot {
  name Dot46
  note_font_size 41
  xpos 3138
  ypos 742
 }
 Switch {
  inputs 2
  which {{minVal}}
  name SwitchMinColor1
  xpos 2883
  ypos 739
 }
push $N93b3cb20
 Multiply {
  channels rgb
  value {{multBase}}
  name Multiply3
  label "mult black color"
  xpos 2432
  ypos 63
 }
 Multiply {
  channels rgb
  value 2
  name Multiply4
  label "hypot Extra Mult\n"
  xpos 2432
  ypos 95
  disable {{"mergeOp == 1 ? 0 : 1"}}
 }
push $N93726030
 MergeExpression {
  inputs 2
  expr0 Br/Ar
  expr1 Bg/Ag
  expr2 Bb/Ab
  name MergeDivide1
  xpos 2432
  ypos 151
 }
 Invert {
  channels rgb
  name Invert2
  xpos 2432
  ypos 175
 }
 Clamp {
  channels rgb
  name Clamp2
  xpos 2432
  ypos 199
 }
 Gamma {
  channels rgb
  value {{rolloffGamma}}
  name Gamma2
  xpos 2432
  ypos 223
 }
 Dot {
  name Dot6
  xpos 2466
  ypos 366
 }
set N93c444b0 [stack 0]
 Dot {
  name Dot9
  xpos 2466
  ypos 480
 }
set N93c48360 [stack 0]
 Dot {
  name Dot10
  xpos 2466
  ypos 588
 }
 Shuffle {
  red blue
  green blue
  alpha blue
  name Shuffle4
  tile_color 0x3fbfff
  label "\[value in] \[ expr \{ \[value out2] == \"none\" ? \" \" : \[concat --> \[value out2]] \}]"
  xpos 2511
  ypos 581
 }
push $N93b50710
push $N93c48360
 Shuffle {
  red green
  blue green
  alpha green
  name Shuffle5
  tile_color 0xbf00ff
  label "\[value in] \[ expr \{ \[value out2] == \"none\" ? \" \" : \[concat --> \[value out2]] \}]"
  xpos 2511
  ypos 473
 }
push $N93b4c6b0
push $N93c444b0
 Shuffle {
  green red
  blue red
  alpha red
  name Shuffle6
  tile_color 0xbf0000ff
  label "\[value in] \[ expr \{ \[value out2] == \"none\" ? \" \" : \[concat --> \[value out2]] \}]"
  xpos 2517
  ypos 359
 }
push $N93b487d0
push $N93726030
 Merge2 {
  inputs 2+1
  operation {{parent.Settings.mergeOpNum}}
  bbox B
  Achannels {rgba.red -rgba.green -rgba.blue -rgba.alpha}
  Bchannels {rgba.red -rgba.green -rgba.blue -rgba.alpha}
  output {rgba.red -rgba.green -rgba.blue -rgba.alpha}
  maskChannelInput -rgba.red
  name Merge2
  label red
  xpos 2711
  ypos 359
 }
 Merge2 {
  inputs 2+1
  operation {{parent.Settings.mergeOpNum}}
  bbox B
  Achannels {-rgba.red rgba.green -rgba.blue -rgba.alpha}
  Bchannels {-rgba.red rgba.green -rgba.blue -rgba.alpha}
  output {-rgba.red rgba.green -rgba.blue -rgba.alpha}
  maskChannelInput -rgba.red
  name Merge6
  label green
  xpos 2711
  ypos 473
 }
 Merge2 {
  inputs 2+1
  operation {{parent.Settings.mergeOpNum}}
  bbox B
  Achannels {-rgba.red -rgba.green rgba.blue -rgba.alpha}
  Bchannels {-rgba.red -rgba.green rgba.blue -rgba.alpha}
  output {-rgba.red -rgba.green rgba.blue -rgba.alpha}
  maskChannelInput -rgba.red
  name Merge7
  label blue
  xpos 2711
  ypos 581
 }
 Merge2 {
  inputs 2
  operation max
  bbox B
  Achannels rgb
  Bchannels rgb
  output rgb
  name Merge8
  label "Set Min Color\nto Blackpoint"
  xpos 2711
  ypos 730
 }
 Group {
  name PlotScanline
  tile_color 0x9c0000ff
  xpos 2711
  ypos 805
  addUserKnob {20 Controls}
  addUserKnob {4 mode l "Sampling method" M {"Slice Per Pixel (faster)" "Slice Area (slower)" "Full Scanline" "" "" ""}}
  mode "Full Scanline"
  addUserKnob {6 add2image l "Add to original" +STARTLINE}
  addUserKnob {6 Normalize -STARTLINE}
  addUserKnob {6 tonemap l "Tone Map (HDRI)" -STARTLINE}
  addUserKnob {6 curve l "Plot as curve" +STARTLINE}
  curve true
  addUserKnob {3 curveFat l "Curve Thickness" -STARTLINE}
  addUserKnob {3 sa l "Sample Area" t "Disabled when using pr pixel method."}
  sa 1
  addUserKnob {7 lift l Lift R -1 1}
  addUserKnob {7 scale l Scale R 0 5}
  scale 1
  addUserKnob {26 ""}
  addUserKnob {12 p1 l "Start Point"}
  p1 {376 418}
  addUserKnob {12 p2 l "End Point" -STARTLINE}
  p2 {428.5 425.5}
  addUserKnob {26 ""}
  addUserKnob {26 "" l "About " T "Plot Scanline v0.4 | theo@euqahuba.com\nUse P1 to select your scanline and/or you start slice."}
 }
  Input {
   inputs 0
   name Input1
   xpos -480
   ypos 62
  }
set N93cb70a0 [stack 0]
  Expression {
   temp_name0 length
   temp_expr0 sqrt(r*r+g*g+b*b)
   expr0 r/length
   expr1 g/length
   expr2 b/length
   name Normalize
   xpos -480
   ypos 108
   disable {{1-parent.Normalize i}}
  }
  Expression {
   expr0 r/(r+1)
   expr1 g/(g+1)
   expr2 b/(b+1)
   name tonamap
   xpos -480
   ypos 134
   disable {{1-parent.tonemap i}}
  }
set N93cc7470 [stack 0]
  Expression {
   temp_name0 rExpr
   temp_expr0 "min(max(0,\r\nceil(r(x,parent.p1.y)-((y/height+parent.lift)*parent.scale))),1)"
   temp_name1 gExpr
   temp_expr1 "min(max(0,\r\nceil(g(x,parent.p1.y)-((y/height+parent.lift)*parent.scale))),1)"
   temp_name2 bExpr
   temp_expr2 "min(max(0,\r\nceil(b(x,parent.p1.y)-((y/height+parent.lift)*parent.scale))),1)"
   expr0 rExpr
   expr1 gExpr
   expr2 bExpr
   expr3 0
   name scanline
   xpos -302
   ypos 193
   addUserKnob {20 User}
  }
push $N93cc7470
  Expression {
   temp_name0 rExpr
   temp_expr0 "min(max(0,\r\nceil(r((x/width)*(parent.p2.x-parent.p1.x)+parent.p1.x,(x/width)*(parent.p2.y-parent.p1.y)+parent.p1.y,parent.sa,parent.sa)-((y/height+parent.lift)*parent.scale))),1)"
   temp_name1 gExpr
   temp_expr1 "min(max(0,\r\nceil(g((x/width)*(parent.p2.x-parent.p1.x)+parent.p1.x,(x/width)*(parent.p2.y-parent.p1.y)+parent.p1.y,parent.sa,parent.sa)-((y/height+parent.lift)*parent.scale))),1)"
   temp_name2 bExpr
   temp_expr2 "min(max(0,\r\nceil(b((x/width)*(parent.p2.x-parent.p1.x)+parent.p1.x,(x/width)*(parent.p2.y-parent.p1.y)+parent.p1.y,parent.sa,parent.sa)-((y/height+parent.lift)*parent.scale))),1)"
   expr0 rExpr
   expr1 gExpr
   expr2 bExpr
   expr3 0
   name Expression_highQuality
   xpos -515
   ypos 197
   addUserKnob {20 User}
  }
push $N93cc7470
  Expression {
   temp_name0 rExpr
   temp_expr0 "min(max(0,\r\nceil(r((x/width)*(parent.p2.x-parent.p1.x)+parent.p1.x,(x/width)*(parent.p2.y-parent.p1.y)+parent.p1.y)-((y/height+parent.lift)*parent.scale))),1)"
   temp_name1 gExpr
   temp_expr1 "min(max(0,\r\nceil(g((x/width)*(parent.p2.x-parent.p1.x)+parent.p1.x,(x/width)*(parent.p2.y-parent.p1.y)+parent.p1.y)-((y/height+parent.lift)*parent.scale))),1)"
   temp_name2 bExpr
   temp_expr2 "min(max(0,\r\nceil(b((x/width)*(parent.p2.x-parent.p1.x)+parent.p1.x,(x/width)*(parent.p2.y-parent.p1.y)+parent.p1.y)-((y/height+parent.lift)*parent.scale))),1)"
   expr0 rExpr
   expr1 gExpr
   expr2 bExpr
   expr3 0
   name perPixel
   xpos -419
   ypos 201
   addUserKnob {20 User}
  }
  Switch {
   inputs 3
   which {{parent.mode i}}
   name Switch2
   xpos -480
   ypos 253
  }
  Matrix {
   matrix {
       {0 1 0}
       {1 -4 1}
       {0 1 0}
     }
   name Matrix2
   xpos -480
   ypos 284
   disable {{-1+parent.curve i x70 1}}
  }
  Dilate {
   size {{parent.curveFat}}
   name Dilate1
   xpos -480
   ypos 326
   disable {{-1+parent.curve.main}}
  }
  Clamp {
   name Clamp1
   xpos -480
   ypos 383
  }
set N93d16c40 [stack 0]
push $N93cb70a0
  Dot {
   name Dot1
   xpos -556
   ypos 66
  }
  Clamp {
   maximum 331
   name Clamp2
   xpos -590
   ypos 352
  }
  Merge2 {
   inputs 2
   operation plus
   bbox intersection
   name Merge1
   xpos -590
   ypos 394
  }
  Dot {
   name Dot2
   xpos -556
   ypos 433
  }
push $N93d16c40
  Switch {
   inputs 2
   which {{parent.add2image i}}
   name Switch1
   xpos -480
   ypos 430
  }
  Output {
   name Output1
   xpos -480
   ypos 470
  }
 end_group
 Dot {
  name Dot15
  note_font_size 41
  xpos 2745
  ypos 857
 }
set N93d4d480 [stack 0]
 Shuffle {
  red white
  green white
  blue white
  alpha white
  name Shuffle7
  label "\[value in] \[ expr \{ \[value out2] == \"none\" ? \" \" : \[concat --> \[value out2]] \}]"
  xpos 2821
  ypos 850
 }
 BlackOutside {
  name BlackOutside1
  xpos 2821
  ypos 882
 }
 Dilate {
  channels rgba
  size -2
  name Dilate1
  xpos 2821
  ypos 910
 }
 Invert {
  name Invert3
  xpos 2821
  ypos 934
 }
push $N93d4d480
 Merge2 {
  inputs 2
  name Merge9
  label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
  xpos 2711
  ypos 938
 }
 Group {
  name BinaryAlpha
  tile_color 0x2a2a2aff
  label "(\[value an] --> \[value output1])"
  note_font Verdana
  note_font_color 0xfffff9ff
  xpos 2711
  ypos 983
  addUserKnob {20 BinaryAlpha}
  addUserKnob {4 an l Analyze: M {rgb rgba alpha "" "" ""}}
  addUserKnob {4 output1 l Output: M {rgba alpha "" "" "" ""}}
  output1 alpha
  addUserKnob {20 info l Info}
  addUserKnob {26 creator l Creator: T "<b><big>Tony Lyons"}
  addUserKnob {26 desc l Description: t "Analyzes channel input and creates a binary result 0 or 1 and outputs it into output channel" T BinaryAlpha}
  addUserKnob {26 ver l Version: T v03}
 }
  Input {
   inputs 0
   name Input
   xpos -398
   ypos 275
  }
  Expression {
   temp_name0 rgb_an
   temp_expr0 "r !=0 || g!=0 || b!=0?1:0"
   temp_name1 rgba_an
   temp_expr1 "r!=0 || g!=0 || b!=0 || a!=0?1:0"
   temp_name2 alpha_an
   temp_expr2 a!=0?1:0
   expr3 "parent.an == 0 ? rgb_an : parent.an == 1 ? rgba_an : alpha_an"
   name Expression
   xpos -398
   ypos 341
  }
  Shuffle {
   red alpha
   green alpha
   blue alpha
   name Shuffle
   label "\[value in]"
   xpos -398
   ypos 367
   disable {{parent.output1}}
  }
  Output {
   name Output1
   xpos -398
   ypos 456
  }
 end_group
 Reformat {
  type "to box"
  box_height {{"\[exists parent.input0] ? parent.input.height : root.format.height"}}
  resize height
  filter Impulse
  pbb true
  name Reformat2
  xpos 2711
  ypos 1041
 }
 Reformat {
  type "to box"
  box_width {{"\[exists parent.input0] ? parent.input.width : root.format.width"}}
  box_height {{input.height}}
  resize none
  filter Impulse
  black_outside true
  pbb true
  name Reformat3
  xpos 2711
  ypos 1081
 }
 Dilate {
  channels rgba
  size 1
  name Dilate2
  xpos 2711
  ypos 1121
 }
 Dot {
  name Dot14
  note_font_size 41
  xpos 2745
  ypos 1192
 }
 Input {
  inputs 0
  name Inputmask
  xpos 864
  ypos 878
  number 2
 }
 Dot {
  name Dot29
  xpos 898
  ypos 1015
 }
push $N93b1d860
 Dot {
  name Dot33
  label "Black Color"
  note_font_size 41
  xpos 1631
  ypos 295
 }
 Dot {
  name Dot37
  note_font_size 41
  xpos 1631
  ypos 360
 }
set N93dc4c70 [stack 0]
 Dot {
  name Dot34
  note_font_size 41
  xpos 1631
  ypos 474
 }
set N93dc8b50 [stack 0]
 Dot {
  name Dot35
  note_font_size 41
  xpos 1631
  ypos 582
 }
set N93dcca30 [stack 0]
 Dot {
  name Dot13
  note_font_size 41
  xpos 1631
  ypos 674
 }
set N93dd0910 [stack 0]
push $N93dd0910
push $N93b21740
 Multiply {
  channels rgb
  value 2
  name Multiply7
  label "mult black color"
  xpos 2106
  ypos 87
 }
push $N93af6a70
 Unpremult {
  name Unpremult1
  xpos 322
  ypos -16
  disable {{"! premultInput"}}
 }
 Dot {
  name Dot18
  xpos 356
  ypos 145
 }
set N93de53e0 [stack 0]
 Dot {
  name Dot22
  note_font_size 41
  xpos 1028
  ypos 145
 }
set N93de91e0 [stack 0]
 Dot {
  name Dot32
  note_font_size 41
  xpos 1852
  ypos 145
 }
set N93ded0c0 [stack 0]
 MergeExpression {
  inputs 2
  expr0 Br/Ar
  expr1 Bg/Ag
  expr2 Bb/Ab
  name MergeDivide3
  xpos 2106
  ypos 142
 }
 Invert {
  channels rgb
  name Invert4
  xpos 2106
  ypos 166
 }
 Clamp {
  channels rgb
  name Clamp3
  xpos 2106
  ypos 190
 }
 Gamma {
  channels rgb
  value 0.51
  name Gamma3
  xpos 2106
  ypos 214
 }
 Dot {
  name Dot24
  xpos 2140
  ypos 360
 }
set N93e1f9d0 [stack 0]
 Dot {
  name Dot25
  xpos 2140
  ypos 474
 }
set N93e23760 [stack 0]
 Dot {
  name Dot27
  xpos 2140
  ypos 582
 }
 Shuffle {
  red blue
  green blue
  alpha blue
  name Shuffle8
  tile_color 0x3fbfff
  label "\[value in] \[ expr \{ \[value out2] == \"none\" ? \" \" : \[concat --> \[value out2]] \}]"
  xpos 1990
  ypos 575
 }
push $N93dcca30
push $N93e23760
 Shuffle {
  red green
  blue green
  alpha green
  name Shuffle9
  tile_color 0xbf00ff
  label "\[value in] \[ expr \{ \[value out2] == \"none\" ? \" \" : \[concat --> \[value out2]] \}]"
  xpos 1990
  ypos 467
 }
push $N93dc8b50
push $N93e1f9d0
 Shuffle {
  green red
  blue red
  alpha red
  name Shuffle10
  tile_color 0xbf0000ff
  label "\[value in] \[ expr \{ \[value out2] == \"none\" ? \" \" : \[concat --> \[value out2]] \}]"
  xpos 1984
  ypos 353
 }
push $N93dc4c70
push $N93ded0c0
 Merge2 {
  inputs 2+1
  operation {{parent.Settings.mergeOpNum}}
  bbox B
  Achannels {rgba.red -rgba.green -rgba.blue -rgba.alpha}
  Bchannels {rgba.red -rgba.green -rgba.blue -rgba.alpha}
  output {rgba.red -rgba.green -rgba.blue -rgba.alpha}
  maskChannelInput -rgba.red
  name Merge11
  label red
  xpos 1818
  ypos 353
 }
 Merge2 {
  inputs 2+1
  operation {{parent.Settings.mergeOpNum}}
  bbox B
  Achannels {-rgba.red rgba.green -rgba.blue -rgba.alpha}
  Bchannels {-rgba.red rgba.green -rgba.blue -rgba.alpha}
  output {-rgba.red rgba.green -rgba.blue -rgba.alpha}
  maskChannelInput -rgba.red
  name Merge12
  label green
  xpos 1818
  ypos 467
 }
 Merge2 {
  inputs 2+1
  operation {{parent.Settings.mergeOpNum}}
  bbox B
  Achannels {-rgba.red -rgba.green rgba.blue -rgba.alpha}
  Bchannels {-rgba.red -rgba.green rgba.blue -rgba.alpha}
  output {-rgba.red -rgba.green rgba.blue -rgba.alpha}
  maskChannelInput -rgba.red
  name Merge13
  label blue
  xpos 1818
  ypos 575
 }
 Merge2 {
  inputs 2
  operation max
  bbox B
  Achannels rgb
  Bchannels rgb
  output rgb
  name Merge17
  label "Set Min Color\nto Blackpoint"
  xpos 1818
  ypos 662
 }
 Dot {
  name Dot38
  note_font_size 41
  xpos 1852
  ypos 760
 }
 Switch {
  inputs 2
  which {{minVal}}
  name SwitchMinColor
  xpos 1597
  ypos 757
 }
push $N93b19980
 Multiply {
  channels rgb
  value {{multBase}}
  name Multiply1
  label "mult black color"
  xpos 1138
  ypos 52
 }
 Multiply {
  channels rgb
  value 2
  name Multiply2
  label "hypot Extra Mult\n"
  xpos 1138
  ypos 84
  disable {{"mergeOp == 1 ? 0 : 1"}}
 }
push $N93de91e0
 MergeExpression {
  inputs 2
  expr0 Br/Ar
  expr1 Bg/Ag
  expr2 Bb/Ab
  name MergeDivide
  xpos 1138
  ypos 194
 }
 Invert {
  channels rgb
  name Invert1
  xpos 1138
  ypos 239
 }
 Clamp {
  channels rgb
  name Clamp1
  xpos 1138
  ypos 263
 }
 Gamma {
  channels rgb
  value {{rolloffGamma}}
  name Gamma1
  xpos 1138
  ypos 287
 }
 Dot {
  name Dot19
  xpos 1172
  ypos 364
 }
set N93e96c10 [stack 0]
 Dot {
  name Dot20
  xpos 1172
  ypos 478
 }
set N93e9ab40 [stack 0]
 Dot {
  name Dot21
  xpos 1172
  ypos 586
 }
 Shuffle {
  red blue
  green blue
  alpha blue
  name Shuffle3
  tile_color 0x3fbfff
  label "\[value in] \[ expr \{ \[value out2] == \"none\" ? \" \" : \[concat --> \[value out2]] \}]"
  xpos 1022
  ypos 579
 }
push $N93b19980
 Dot {
  name Dot23
  xpos 706
  ypos -151
 }
 Dot {
  name Dot8
  label "Black Color"
  note_font_size 41
  xpos 706
  ypos 293
 }
set N93eb3e10 [stack 0]
 Dot {
  name Dot2
  note_font_size 41
  xpos 706
  ypos 404
 }
set N93eb7cf0 [stack 0]
 Dot {
  name Dot3
  note_font_size 41
  xpos 706
  ypos 523
 }
push $N93e9ab40
 Shuffle {
  red green
  blue green
  alpha green
  name Shuffle2
  tile_color 0xbf00ff
  label "\[value in] \[ expr \{ \[value out2] == \"none\" ? \" \" : \[concat --> \[value out2]] \}]"
  xpos 1022
  ypos 471
 }
push $N93eb7cf0
push $N93e96c10
 Shuffle {
  green red
  blue red
  alpha red
  name Shuffle1
  tile_color 0xbf0000ff
  label "\[value in] \[ expr \{ \[value out2] == \"none\" ? \" \" : \[concat --> \[value out2]] \}]"
  xpos 1016
  ypos 357
 }
push $N93eb3e10
push $N93de53e0
 Merge2 {
  inputs 2+1
  operation {{parent.Settings.mergeOpNum}}
  bbox B
  Achannels {rgba.red -rgba.green -rgba.blue -rgba.alpha}
  Bchannels {rgba.red -rgba.green -rgba.blue -rgba.alpha}
  output {rgba.red -rgba.green -rgba.blue -rgba.alpha}
  maskChannelInput -rgba.red
  name Merge3
  label red
  xpos 322
  ypos 357
 }
 Merge2 {
  inputs 2+1
  operation {{parent.Settings.mergeOpNum}}
  bbox B
  Achannels {-rgba.red rgba.green -rgba.blue -rgba.alpha}
  Bchannels {-rgba.red rgba.green -rgba.blue -rgba.alpha}
  output {-rgba.red rgba.green -rgba.blue -rgba.alpha}
  maskChannelInput -rgba.red
  name Merge4
  label green
  xpos 322
  ypos 471
 }
 Merge2 {
  inputs 2+1
  operation {{parent.Settings.mergeOpNum}}
  bbox B
  Achannels {-rgba.red -rgba.green rgba.blue -rgba.alpha}
  Bchannels {-rgba.red -rgba.green rgba.blue -rgba.alpha}
  output {-rgba.red -rgba.green rgba.blue -rgba.alpha}
  maskChannelInput -rgba.red
  name Merge5
  label blue
  xpos 322
  ypos 579
 }
 Merge2 {
  inputs 2
  operation max
  bbox B
  Achannels rgb
  Bchannels rgb
  output rgb
  name Merge1
  label "Set Min Color\nto Blackpoint"
  xpos 322
  ypos 748
 }
 Premult {
  name Premult4
  xpos 322
  ypos 881
  disable {{"! premultInput"}}
 }
push $N93aeb5f0
 Dot {
  name Dot28
  xpos -146
  ypos -418
 }
 Dot {
  name Dot30
  xpos -146
  ypos 1015
 }
 Merge2 {
  inputs 2+1
  operation copy
  bbox B
  Achannels {rgba.red rgba.green rgba.blue -rgba.alpha}
  Bchannels {rgba.red rgba.green rgba.blue -rgba.alpha}
  output {rgba.red rgba.green rgba.blue -rgba.alpha}
  mix 0.8
  name MergeKeymix
  label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
  xpos 322
  ypos 1012
 }
 Merge2 {
  inputs 2
  name Merge10
  label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
  xpos 322
  ypos 1189
  disable {{!previewPlotScan}}
 }
 Output {
  name Output1
  xpos 322
  ypos 1395
 }
 NoOp {
  inputs 0
  name Settings
  note_font_size 51
  xpos 2494
  ypos -414
  addUserKnob {20 User}
  addUserKnob {7 mergeOpNum l "Merge Op Num"}
  mergeOpNum {{"mergeOp == 0 ? 24 : 13"}}
 }
end_group
Premult {
 name Premult2
 selected true
 xpos -1457
 ypos 3949
}
Group {
 inputs 2
 name LightWrapPro
 help "Adds exponentially blurred lightwrap\n\nAdds a bright highlight wrap and an overall wrap"
 tile_color 0x1e252eff
 label "(\[value outputView])"
 note_font "DejaVu Sans Bold Bold Bold Bold Bold Bold"
 note_font_color 0xb7e6ffff
 selected true
 xpos -1457
 ypos 4401
 disable true
 mapsize {0.15 0.15}
 addUserKnob {20 LightWrapPro}
 addUserKnob {4 outputView l "Output View" t "Chose one to view while adjusting" M {"Final Output" "Highlight Key" "Highlight Wrap" "OverAll Wrap" "Effect Only" "" "" "" "" "" "" "" "" ""}}
 addUserKnob {6 premultiplied l "FG premultiplied" -STARTLINE}
 premultiplied true
 addUserKnob {26 highlightKeyTitle l "<b><font color = skyblue>HighLight Key"}
 addUserKnob {7 blackPt l Black R 0 4}
 blackPt 1
 addUserKnob {7 whitePt l White R 0 4}
 whitePt 2
 addUserKnob {26 wrapHighlightsTitle l "<b><font color = skyblue>HighLight Wrap"}
 addUserKnob {6 Mult_Flare_panelDropped l "panel dropped state" +HIDDEN +STARTLINE}
 addUserKnob {41 steps l " Steps" T ExponGlowWrapHighlight.steps}
 addUserKnob {41 falloffType l Falloff -STARTLINE T ExponGlowWrapHighlight.falloffType}
 addUserKnob {41 size l Size T ExponGlowWrapHighlight.size}
 addUserKnob {7 wrapHighlightAmount l Amount R 0 4}
 wrapHighlightAmount 1
 addUserKnob {26 WrapAllTitle l "<b><font color=skyblue>Overall Wrap "}
 addUserKnob {6 WrapAllMult_panelDropped l "panel dropped state" +HIDDEN +STARTLINE}
 addUserKnob {41 steps_1 l " Steps" T ExponGlowWrapAll.steps}
 addUserKnob {41 falloffType_1 l Falloff -STARTLINE T ExponGlowWrapAll.falloffType}
 addUserKnob {41 size_1 l Size T ExponGlowWrapAll.size}
 addUserKnob {7 wrapAllAmount l Amount R 0 4}
 wrapAllAmount 1
 addUserKnob {6 removeHighlights l "Dim Highlights" +STARTLINE}
 removeHighlights true
 addUserKnob {7 dimHighlightsAmount l "" -STARTLINE R 0 3}
 dimHighlightsAmount 1
 addUserKnob {26 blendEdgesTitle l "<b><font color=skyblue>Blend Edges"}
 addUserKnob {7 blendEdgesAmount l Amount}
 addUserKnob {6 ColorBleedMult_panelDropped l "panel dropped state" +HIDDEN +STARTLINE}
 addUserKnob {26 bleedColorTitle l "<b><font color=skyblue>Bleed Color"}
 addUserKnob {7 bleedColorAmount l Amount}
 addUserKnob {7 bleedColorSize l Size R 0.1 4}
 bleedColorSize 1
 addUserKnob {7 bleedColorFalloff_2 l Falloff R 0.2 2}
 bleedColorFalloff_2 0.5
 addUserKnob {26 ""}
 addUserKnob {7 globalAmount l "<b><font color=skyblue>Global Amount"}
 globalAmount 1
 addUserKnob {26 _1 l mask T ""}
 addUserKnob {41 maskChannelInput l "" -STARTLINE T MergeCopyLightWrapPro.maskChannelInput}
 addUserKnob {41 inject -STARTLINE T MergeCopyLightWrapPro.inject}
 addUserKnob {41 invert_mask l invert -STARTLINE T MergeCopyLightWrapPro.invert_mask}
 addUserKnob {41 fringe -STARTLINE T MergeCopyLightWrapPro.fringe}
 addUserKnob {41 mix T MergeCopyLightWrapPro.mix}
 addUserKnob {20 info l Info}
 addUserKnob {26 creator l Creator: T "<b><big>Tony Lyons"}
 addUserKnob {26 desc l Description: t "\n\n" T LightWrapPro}
 addUserKnob {26 ver l Version: T v06}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x402f27ff
  label "Bleed Color"
  note_font_size 60
  note_font_color 0xffffffff
  xpos -683
  ypos 2273
  bdwidth 1316
  bdheight 787
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x39464200
  label "highlight key"
  note_font_size 40
  note_font_color 0xffffffff
  xpos 1630
  ypos 113
  bdwidth 272
  bdheight 393
 }
 Input {
  inputs 0
  name Inputmask
  xpos 1887
  ypos 3580
  number 2
 }
 Input {
  inputs 0
  name FG
  xpos -413
  ypos -318
 }
 AddChannels {
  channels rgba
  name AddChannels1
  xpos -413
  ypos -150
 }
 Dot {
  name Dot1
  xpos -379
  ypos 375
 }
set N938b49e0 [stack 0]
 Dot {
  name Dot7
  xpos -825
  ypos 375
 }
 Dot {
  name Dot46
  xpos -825
  ypos 3104
 }
set N938bc6a0 [stack 0]
 Dot {
  name Dot15
  xpos 915
  ypos 3107
 }
set N938c0580 [stack 0]
 Dot {
  name Dot26
  note_font_size 41
  xpos 915
  ypos 3224
 }
set N938c44e0 [stack 0]
 Dot {
  name Dot32
  note_font_size 41
  xpos 915
  ypos 3277
 }
push $N938b49e0
 Dot {
  name Dot8
  note_font_size 41
  xpos 717
  ypos 378
 }
set N938cc260 [stack 0]
 Dot {
  name Dot11
  note_font_size 41
  xpos 717
  ypos 550
 }
 Input {
  inputs 0
  name BG
  label "\n"
  xpos 1702
  ypos -276
  number 1
 }
 AddChannels {
  channels rgba
  name AddChannels2
  xpos 1702
  ypos -145
 }
 Remove {
  operation keep
  channels rgba
  name Remove2
  xpos 1702
  ypos -68
 }
 Dot {
  name Dot3
  xpos 1736
  ypos 177
 }
set N938e6830 [stack 0]
 Keyer {
  operation "luminance key"
  range {{parent.blackPt} {parent.whitePt} {range.B} {range.B}}
  name Keyer2
  xpos 1702
  ypos 303
 }
 Dot {
  name Dot4
  note_font_size 41
  xpos 1736
  ypos 397
 }
set N938f34d0 [stack 0]
 Premult {
  name Premult1
  xpos 1702
  ypos 452
 }
 Multiply {
  inputs 1+1
  channels rgba
  value 0
  name Multiply1
  label "\[value value]"
  xpos 1702
  ypos 543
 }
 Dot {
  name Dot30
  note_font_size 41
  xpos 1734
  ypos 746
 }
 Group {
  name ExponGlowWrapHighlight
  onCreate "n = nuke.thisNode()\nn.knob('size').setRange(0, 50)\n#n.knob('exp').setRange(1, 4)\nnuke.thisNode().knob('steps').setFlag(0x02000000)"
  knobChanged "n = nuke.thisNode()\nk = nuke.thisKnob()\n\nif k.name() == \"includeOriginal\":\n    if n.knob('includeOriginal').getValue() == 1:\n        merge = nuke.toNode(\"Merge1\")\n        original = nuke.toNode('Original')\n        AvgMult = nuke.toNode(\"AverageMult\")\n        steps = int(n.knob('steps').getValue())\n        merge.setInput(steps+1, original)\n        AvgMult\['whitepoint'].setValue(2 if steps<2 else steps+1)\n\n    else:\n        merge.setInput(steps+1, None)\n        AvgMult\['whitepoint'].setValue(2 if steps<2 else steps)\n\nelif k.name() == \"steps\":\n\n    s = int(k.value())\n    if s<1:\n        k.setValue(1)\n    else:\n        start = nuke.toNode(\"Start\")\n        end   = nuke.toNode(\"End\")\n        b1    = nuke.toNode(\"Blur1\")\n        m1    = nuke.toNode(\"Multiply1\")\n        merge = nuke.toNode(\"Merge1\")\n        AvgMult = nuke.toNode(\"AverageMult\")\n\n        b1x   = b1.xpos()\n        b1y   = b1.ypos()\n        b1n   = b1.name()\n\n        m1x   = m1.xpos()\n        m1y   = m1.ypos()\n        m1n   = m1.name()\n\n        steps = int(n.knob('steps').getValue())\n        size  = n.knob('size').getValue()\n        mult  = n.knob('exp').getValue()\n\n        #b1.setInput(0, start)\n        for i in range(1,merge.inputs()):\n            merge.setInput(i,None)\n        merge.setInput(0, m1)\n        \[nuke.delete(i) for i in nuke.allNodes() if i.xpos()>start.xpos()]\n        for i in range(1,steps):\n            # Blur\n            b = nuke.nodes.Blur()\n            m = nuke.nodes.Multiply()\n            b.setXYpos(b1x+i*100,b1y)\n            b.setInput(0,start)\n            b\[\"channels\"].setValue(\"all\")\n            b\[\"crop\"].setValue(0)\n            b\[\"size\"].setValue(0, 1)\n            b\[\"size\"].setExpression( \"((width/100*parent.size.w)*(aspectCalc.aspect.w/100)*(\{\}**2))\".format(str(i+1)), 0 )\n            b\[\"size\"].setExpression( \"((height/100*parent.size.h)*(aspectCalc.aspect.h/100)*(\{\}**2))\".format(str(i+1)), 1 )\n            b\[\"label\"].setValue('')\n            blurAbove = b.name()\n\n            m.setXYpos(m1x+i*100,m1y)\n            m.setInput(0, nuke.toNode(blurAbove))\n            m\[\"channels\"].setValue(\"all\")\n            m\[\"value\"].setValue(1,1,1,1)\n            j = 1-(i/steps)\n            m\[\"value\"].setExpression('falloffType == 0 ? \{\} :falloffType == 1 ? pow(\{\}, 3) : falloffType == 2 ? \{\}*\{\}*(3-2*\{\}) : falloffType == 3 ? \{\}*\{\}*(2 - \{\}) : falloffType == 4 ? \{\}*(1 + \{\}*(1 - \{\})) : 0'.format(j,j,j,j,j,j,j,j,j,j,j))\n            m\[\"mix\"].setExpression(\"falloff\")\n            m\[\"label\"].setValue('')\n\n            merge.setInput(i if i<2 else i+1, m)\n            AvgMult\['whitepoint'].setValue(i if i<2 else i+1)\n\n        if n.knob('includeOriginal').getValue() == 1:\n            merge = nuke.toNode(\"Merge1\")\n            original = nuke.toNode('Original')\n            AvgMult = nuke.toNode(\"AverageMult\")\n            steps = int(n.knob('steps').getValue())\n            merge.setInput(steps+1, original)\n            AvgMult\['whitepoint'].setValue(2 if steps<2 else steps+1)\n\nelif k.name() == \"output2\":\n    if n.knob(\"output2\").getValue() == 4:\n        n.knob('AvgMaxOriginal').setVisible(True)\n    else:\n        n.knob('AvgMaxOriginal').setVisible(False)\n\n"
  tile_color 0xcc804eff
  label "(\[value output2])"
  note_font "Verdana Bold Bold Bold Bold Bold Bold Bold"
  note_font_color 0xffffffff
  xpos 1700
  ypos 1012
  addUserKnob {20 ExponBlurSimple}
  addUserKnob {41 channels T Remove1.channels}
  addUserKnob {26 ""}
  addUserKnob {4 output2 l Operation: M {Screen Plus Over Hypot Average Max Min "" "" "" "" ""}}
  output2 Over
  addUserKnob {3 steps l "  Steps" -STARTLINE}
  steps 6
  addUserKnob {26 text l " " T " "}
  addUserKnob {6 includeOriginal l "Include Original?" -STARTLINE}
  addUserKnob {6 AvgMaxOriginal l "Use Max of Average and Original" +HIDDEN +STARTLINE}
  AvgMaxOriginal true
  addUserKnob {14 size l Size R 0 50}
  size 4
  addUserKnob {14 exp l Exponent +INVISIBLE R 1 4}
  exp 3
  addUserKnob {6 color_rgba_panelDropped l "panel dropped state" +HIDDEN +STARTLINE}
  addUserKnob {7 falloff l Falloff}
  falloff 1
  addUserKnob {4 falloffType l "Falloff Type" M {Linear pLinear smooth smooth0 smooth1 ""}}
  falloffType smooth1
  addUserKnob {14 postBlur l "Post Blur" R 0 100}
  addUserKnob {26 ""}
  addUserKnob {41 maskChannelMask l mask T MergeKeymix.maskChannelMask}
  addUserKnob {41 inject -STARTLINE T MergeKeymix.inject}
  addUserKnob {41 invert_mask l invert -STARTLINE T MergeKeymix.invert_mask}
  addUserKnob {41 fringe -STARTLINE T MergeKeymix.fringe}
  addUserKnob {41 mix T MergeKeymix.mix}
  addUserKnob {14 safeBBoxPixels l "" +STARTLINE +HIDDEN R 0 400}
  safeBBoxPixels 100
  addUserKnob {14 adjustBBoxPercent l "" -STARTLINE +HIDDEN R 1 2}
  adjustBBoxPercent 1
  addUserKnob {20 info l Info}
  addUserKnob {26 creator l Creator: T "Tony Lyons"}
  addUserKnob {26 desc l Description: t "Add description and tooltip for gizmo" T ExponBlurSimple}
  addUserKnob {26 ver l Version: T v02}
 }
  Input {
   inputs 0
   name Inputmask
   xpos 346
   ypos 596
   number 1
  }
  Dot {
   name Dot19
   label Mask
   note_font_size 41
   xpos 380
   ypos 662
  }
  Dot {
   name Dot10
   note_font_size 41
   xpos 380
   ypos 899
  }
  Input {
   inputs 0
   name Inputimg
   xpos -221
   ypos -1229
  }
  Dot {
   name Dot16
   note_font_size 41
   xpos -187
   ypos -1062
  }
set N94026840 [stack 0]
  Dot {
   name Dot1
   note_font_size 41
   xpos 461
   ypos -1058
  }
  Remove {
   operation keep
   channels rgba
   name Remove1
   xpos 427
   ypos -980
  }
  NoOp {
   name aspectCalc
   xpos 427
   ypos -939
   addUserKnob {20 User}
   addUserKnob {14 aspect R 0 100}
   aspect {{parent.size.w} {parent.size.h/format.pixel_aspect/height*width}}
  }
  Dot {
   name Dot21
   note_font_size 41
   xpos 461
   ypos -853
  }
set N9403a1d0 [stack 0]
  Invert {
   name Invert1
   xpos 864
   ypos -860
   disable {{"parent.size < 0 ? 0 : 1"}}
  }
set N9403e130 [stack 0]
  Dot {
   name Dot4
   note_font_size 41
   xpos 540
   ypos -604
  }
  NoOp {
   name Original
   xpos 506
   ypos -327
  }
  Dot {
   name Dot5
   note_font_size 41
   xpos 540
   ypos 100
  }
push $N9403e130
  NoOp {
   name Start
   xpos 864
   ypos -706
  }
set N94053e30 [stack 0]
  Blur {
   size {{((width/100*parent.size.w)*(aspectCalc.aspect.w/100)*(6**2))} {((height/100*parent.size.h)*(aspectCalc.aspect.h/100)*(6**2))}}
   crop false
   name Blur6
   xpos 1364
   ypos -554
  }
  Multiply {
   value {{"falloffType == 0 ? 0.166666666667 :falloffType == 1 ? pow(0.166666666667, 3) : falloffType == 2 ? 0.166666666667*0.166666666667*(3-2*0.166666666667) : falloffType == 3 ? 0.166666666667*0.166666666667*(2 - 0.166666666667) : falloffType == 4 ? 0.166666666667*(1 + 0.166666666667*(1 - 0.166666666667)) : 0"} {"falloffType == 0 ? 0.166666666667 :falloffType == 1 ? pow(0.166666666667, 3) : falloffType == 2 ? 0.166666666667*0.166666666667*(3-2*0.166666666667) : falloffType == 3 ? 0.166666666667*0.166666666667*(2 - 0.166666666667) : falloffType == 4 ? 0.166666666667*(1 + 0.166666666667*(1 - 0.166666666667)) : 0"} {"falloffType == 0 ? 0.166666666667 :falloffType == 1 ? pow(0.166666666667, 3) : falloffType == 2 ? 0.166666666667*0.166666666667*(3-2*0.166666666667) : falloffType == 3 ? 0.166666666667*0.166666666667*(2 - 0.166666666667) : falloffType == 4 ? 0.166666666667*(1 + 0.166666666667*(1 - 0.166666666667)) : 0"} {"falloffType == 0 ? 0.166666666667 :falloffType == 1 ? pow(0.166666666667, 3) : falloffType == 2 ? 0.166666666667*0.166666666667*(3-2*0.166666666667) : falloffType == 3 ? 0.166666666667*0.166666666667*(2 - 0.166666666667) : falloffType == 4 ? 0.166666666667*(1 + 0.166666666667*(1 - 0.166666666667)) : 0"}}
   mix {{falloff}}
   name Multiply6
   xpos 1364
   ypos -477
  }
push $N94053e30
  Blur {
   size {{((width/100*parent.size.w)*(aspectCalc.aspect.w/100)*(5**2))} {((height/100*parent.size.h)*(aspectCalc.aspect.h/100)*(5**2))}}
   crop false
   name Blur5
   xpos 1264
   ypos -554
  }
  Multiply {
   value {{"falloffType == 0 ? 0.333333333333 :falloffType == 1 ? pow(0.333333333333, 3) : falloffType == 2 ? 0.333333333333*0.333333333333*(3-2*0.333333333333) : falloffType == 3 ? 0.333333333333*0.333333333333*(2 - 0.333333333333) : falloffType == 4 ? 0.333333333333*(1 + 0.333333333333*(1 - 0.333333333333)) : 0"} {"falloffType == 0 ? 0.333333333333 :falloffType == 1 ? pow(0.333333333333, 3) : falloffType == 2 ? 0.333333333333*0.333333333333*(3-2*0.333333333333) : falloffType == 3 ? 0.333333333333*0.333333333333*(2 - 0.333333333333) : falloffType == 4 ? 0.333333333333*(1 + 0.333333333333*(1 - 0.333333333333)) : 0"} {"falloffType == 0 ? 0.333333333333 :falloffType == 1 ? pow(0.333333333333, 3) : falloffType == 2 ? 0.333333333333*0.333333333333*(3-2*0.333333333333) : falloffType == 3 ? 0.333333333333*0.333333333333*(2 - 0.333333333333) : falloffType == 4 ? 0.333333333333*(1 + 0.333333333333*(1 - 0.333333333333)) : 0"} {"falloffType == 0 ? 0.333333333333 :falloffType == 1 ? pow(0.333333333333, 3) : falloffType == 2 ? 0.333333333333*0.333333333333*(3-2*0.333333333333) : falloffType == 3 ? 0.333333333333*0.333333333333*(2 - 0.333333333333) : falloffType == 4 ? 0.333333333333*(1 + 0.333333333333*(1 - 0.333333333333)) : 0"}}
   mix {{falloff}}
   name Multiply5
   xpos 1264
   ypos -477
  }
push $N94053e30
  Blur {
   size {{((width/100*parent.size.w)*(aspectCalc.aspect.w/100)*(4**2))} {((height/100*parent.size.h)*(aspectCalc.aspect.h/100)*(4**2))}}
   crop false
   name Blur4
   xpos 1164
   ypos -554
  }
  Multiply {
   value {{"falloffType == 0 ? 0.5 :falloffType == 1 ? pow(0.5, 3) : falloffType == 2 ? 0.5*0.5*(3-2*0.5) : falloffType == 3 ? 0.5*0.5*(2 - 0.5) : falloffType == 4 ? 0.5*(1 + 0.5*(1 - 0.5)) : 0"} {"falloffType == 0 ? 0.5 :falloffType == 1 ? pow(0.5, 3) : falloffType == 2 ? 0.5*0.5*(3-2*0.5) : falloffType == 3 ? 0.5*0.5*(2 - 0.5) : falloffType == 4 ? 0.5*(1 + 0.5*(1 - 0.5)) : 0"} {"falloffType == 0 ? 0.5 :falloffType == 1 ? pow(0.5, 3) : falloffType == 2 ? 0.5*0.5*(3-2*0.5) : falloffType == 3 ? 0.5*0.5*(2 - 0.5) : falloffType == 4 ? 0.5*(1 + 0.5*(1 - 0.5)) : 0"} {"falloffType == 0 ? 0.5 :falloffType == 1 ? pow(0.5, 3) : falloffType == 2 ? 0.5*0.5*(3-2*0.5) : falloffType == 3 ? 0.5*0.5*(2 - 0.5) : falloffType == 4 ? 0.5*(1 + 0.5*(1 - 0.5)) : 0"}}
   mix {{falloff}}
   name Multiply4
   xpos 1164
   ypos -477
  }
push $N94053e30
  Blur {
   size {{((width/100*parent.size.w)*(aspectCalc.aspect.w/100)*(3**2))} {((height/100*parent.size.h)*(aspectCalc.aspect.h/100)*(3**2))}}
   crop false
   name Blur3
   xpos 1064
   ypos -554
  }
  Multiply {
   value {{"falloffType == 0 ? 0.666666666667 :falloffType == 1 ? pow(0.666666666667, 3) : falloffType == 2 ? 0.666666666667*0.666666666667*(3-2*0.666666666667) : falloffType == 3 ? 0.666666666667*0.666666666667*(2 - 0.666666666667) : falloffType == 4 ? 0.666666666667*(1 + 0.666666666667*(1 - 0.666666666667)) : 0"} {"falloffType == 0 ? 0.666666666667 :falloffType == 1 ? pow(0.666666666667, 3) : falloffType == 2 ? 0.666666666667*0.666666666667*(3-2*0.666666666667) : falloffType == 3 ? 0.666666666667*0.666666666667*(2 - 0.666666666667) : falloffType == 4 ? 0.666666666667*(1 + 0.666666666667*(1 - 0.666666666667)) : 0"} {"falloffType == 0 ? 0.666666666667 :falloffType == 1 ? pow(0.666666666667, 3) : falloffType == 2 ? 0.666666666667*0.666666666667*(3-2*0.666666666667) : falloffType == 3 ? 0.666666666667*0.666666666667*(2 - 0.666666666667) : falloffType == 4 ? 0.666666666667*(1 + 0.666666666667*(1 - 0.666666666667)) : 0"} {"falloffType == 0 ? 0.666666666667 :falloffType == 1 ? pow(0.666666666667, 3) : falloffType == 2 ? 0.666666666667*0.666666666667*(3-2*0.666666666667) : falloffType == 3 ? 0.666666666667*0.666666666667*(2 - 0.666666666667) : falloffType == 4 ? 0.666666666667*(1 + 0.666666666667*(1 - 0.666666666667)) : 0"}}
   mix {{falloff}}
   name Multiply3
   xpos 1064
   ypos -477
  }
push 0
push $N94053e30
  Blur {
   size {{((width/100*parent.size.w)*(aspectCalc.aspect.w/100)*(2**2))} {((height/100*parent.size.h)*(aspectCalc.aspect.h/100)*(2**2))}}
   crop false
   name Blur2
   xpos 964
   ypos -554
  }
  Multiply {
   value {{"falloffType == 0 ? 0.833333333333 :falloffType == 1 ? pow(0.833333333333, 3) : falloffType == 2 ? 0.833333333333*0.833333333333*(3-2*0.833333333333) : falloffType == 3 ? 0.833333333333*0.833333333333*(2 - 0.833333333333) : falloffType == 4 ? 0.833333333333*(1 + 0.833333333333*(1 - 0.833333333333)) : 0"} {"falloffType == 0 ? 0.833333333333 :falloffType == 1 ? pow(0.833333333333, 3) : falloffType == 2 ? 0.833333333333*0.833333333333*(3-2*0.833333333333) : falloffType == 3 ? 0.833333333333*0.833333333333*(2 - 0.833333333333) : falloffType == 4 ? 0.833333333333*(1 + 0.833333333333*(1 - 0.833333333333)) : 0"} {"falloffType == 0 ? 0.833333333333 :falloffType == 1 ? pow(0.833333333333, 3) : falloffType == 2 ? 0.833333333333*0.833333333333*(3-2*0.833333333333) : falloffType == 3 ? 0.833333333333*0.833333333333*(2 - 0.833333333333) : falloffType == 4 ? 0.833333333333*(1 + 0.833333333333*(1 - 0.833333333333)) : 0"} {"falloffType == 0 ? 0.833333333333 :falloffType == 1 ? pow(0.833333333333, 3) : falloffType == 2 ? 0.833333333333*0.833333333333*(3-2*0.833333333333) : falloffType == 3 ? 0.833333333333*0.833333333333*(2 - 0.833333333333) : falloffType == 4 ? 0.833333333333*(1 + 0.833333333333*(1 - 0.833333333333)) : 0"}}
   mix {{falloff}}
   name Multiply2
   xpos 964
   ypos -477
  }
push $N94053e30
  Blur {
   size {{(width/100*parent.size*(aspectCalc.aspect.w/100))} {(height/100*parent.size*(aspectCalc.aspect.h/100))}}
   crop false
   name Blur1
   selected true
   xpos 864
   ypos -554
  }
  Multiply {
   value {1 1 1 1}
   mix {{falloff}}
   name Multiply1
   xpos 864
   ypos -477
  }
  Merge2 {
   inputs 6+1
   operation {{MergeNumber.mergeNumber}}
   also_merge all
   name Merge1
   label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
   xpos 864
   ypos -327
  }
  NoOp {
   name End
   xpos 864
   ypos -279
  }
  Grade {
   channels all
   whitepoint 6
   black_clamp false
   name AverageMult
   xpos 864
   ypos 49
   disable {{"output2 == 4 ? 0 : 1"}}
  }
  Merge2 {
   inputs 2
   operation max
   also_merge all
   name Merge2
   label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
   xpos 864
   ypos 96
   disable {{"output2 == 4 && includeOriginal == 1 && AvgMaxOriginal == 1 ? 0 : 1"}}
  }
  Blur {
   size {{postBlur} {postBlur}}
   name BlurOriginal
   xpos 864
   ypos 155
  }
  Invert {
   name Invert2
   xpos 864
   ypos 283
   disable {{"parent.size < 0 ? 0 : 1"}}
  }
push $N9403a1d0
  Switch {
   inputs 2
   which {{"parent.size == 0 ? 0 : 1"}}
   name Switch1
   label "\[value which]"
   xpos 427
   ypos 283
  }
  Crop {
   inputs 0
   box {{input.format.x} {input.format.y} {input.format.r} {input.format.t}}
   reformat true
   crop false
   name Crop1
   xpos 96
   ypos -931
   addUserKnob {20 User}
   addUserKnob {22 cropToBbox l "Crop to Bounding Box" -STARTLINE T codeBBox()}
  }
  AddChannels {
   channels rgba
   name AddChannels2
   xpos 96
   ypos -891
  }
push $N94026840
  Merge2 {
   inputs 2
   name Merge3
   label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
   xpos -60
   ypos -891
  }
set N9412b060 [stack 0]
  Group {
   name BBoxToFormat
   onCreate "n = nuke.thisNode()\ninputFormat = n.knob(\"inputFormat\")\ninputBBox = n.knob(\"inputBBox\")\ncrop = nuke.toNode(\"Crop6\")\ncropb = crop.knob('box')\noutputBBox = n.knob('outputBBox')\noutputBBoxCenter = n.knob(\"outputBBoxCenter\")\n\ninputFormat.setFlag(0x0000000000008000)\ninputBBox.setFlag(0x0000000000008000)\ncropb.setFlag(0x0000000000008000)\noutputBBox.setFlag(0x0000000000008000)\noutputBBoxCenter.setFlag(0x0000000000008000)\n\nn = nuke.thisNode()\nn.knob(\"overscan\").setRange(0,400)\nn.knob(\"overscanPercent\").setRange(1,4)"
   knobChanged "n = nuke.thisNode()\nk = nuke.thisKnob()\nif k.name() == \"overscanType\":\n    if n.knob(\"overscanType\").getValue() == 1:\n        n.knob(\"overscanPercent\").setVisible(True)\n        n.knob(\"overscan\").setVisible(False)\n    else:\n        n.knob(\"overscanPercent\").setVisible(False)\n        n.knob(\"overscan\").setVisible(True)"
   tile_color 0xa57aaaff
   note_font "Verdana Bold Bold Bold Bold Bold Bold Bold"
   note_font_color 0xffffffff
   xpos 29
   ypos -812
   addUserKnob {20 CropBBox}
   addUserKnob {4 type l Type +INVISIBLE M {"To Format" "To BBox"}}
   addUserKnob {41 intersect T Crop6.intersect}
   addUserKnob {6 blackOutside l "Black Outside" -STARTLINE}
   addUserKnob {4 overscanType l "Overscan Type:" M {Pixels Percentage}}
   overscanType Percentage
   addUserKnob {14 overscan l Overscan +HIDDEN R 0 400}
   addUserKnob {14 overscanPercent l "Overscan Percent" R 1 4}
   overscanPercent 1.2
   addUserKnob {20 inputBbox l "BBox Data" n 1}
   addUserKnob {15 inputFormat l "Input Format"}
   inputFormat {0 0 {input.width} {input.height}}
   addUserKnob {15 inputBBox l "Input BBox"}
   inputBBox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
   addUserKnob {12 outputBBoxCenter l OutputBBoxCenter}
   outputBBoxCenter {{OutputBBox1.outputBBoxCenter.w} {OutputBBox1.outputBBoxCenter.h}}
   addUserKnob {15 outputBBox l "Output BBox"}
   outputBBox {{OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox}}
   addUserKnob {20 endGroup n -1}
   addUserKnob {20 info_1 l Info}
   addUserKnob {26 creator l Creator: T "<b><big>Tony Lyons"}
   addUserKnob {26 desc l Description: t "crop to inputformat\n\ndisplays values of input bbox" T CropBBox}
   addUserKnob {26 ver l Version: T v02}
  }
   Input {
    inputs 0
    name Input
    xpos 261
    ypos 394
   }
   Dot {
    name Dot2
    note_font_size 41
    xpos 295
    ypos 462
   }
set N941474b0 [stack 0]
   Dot {
    name Dot1
    note_font_size 41
    xpos -160
    ypos 462
   }
set N9414b3d0 [stack 0]
push $N941474b0
   Crop {
    box {{curve} {curve} {input.width} {input.height}}
    crop {{parent.blackOutside}}
    name Crop6
    xpos 261
    ypos 510
    addUserKnob {20 User}
    addUserKnob {22 cropToBbox l "Crop to Bounding Box" -STARTLINE T codeBBox()}
   }
set N9414f2b0 [stack 0]
   Remove {
    operation keep
    channels none
    name Remove1
    xpos 120
    ypos 504
   }
set N94158aa0 [stack 0]
   Transform {
    scale {{parent.overscanPercent} {parent.overscanPercent}}
    center {{input.bbox.r/2} {input.bbox.t/2}}
    shutteroffset centred
    name Transform1
    xpos 120
    ypos 555
   }
push $N94158aa0
   AdjBBox {
    numpixels {{parent.overscan} {parent.overscan}}
    name AdjBBox1
    xpos -5
    ypos 510
   }
   Switch {
    inputs 2
    which {{overscanType}}
    name Switch2
    label "\[value which]"
    xpos -5
    ypos 549
   }
   Merge2 {
    inputs 2
    bbox intersection
    Achannels {-rgba.red -rgba.green -rgba.blue rgba.alpha}
    Bchannels {-rgba.red -rgba.green -rgba.blue rgba.alpha}
    output {-rgba.red -rgba.green -rgba.blue rgba.alpha}
    name Merge1
    xpos -5
    ypos 647
    disable {{!parent.Crop6.intersect}}
   }
push $N9414b3d0
   CopyBBox {
    inputs 2
    name CopyBBox1
    xpos -194
    ypos 653
   }
   BlackOutside {
    name BlackOutside1
    xpos -194
    ypos 692
    disable {{!parent.blackOutside}}
   }
   Dot {
    name Dot4
    note_font_size 41
    xpos -160
    ypos 769
   }
push $N9414f2b0
   Switch {
    inputs 2
    which {{"overscanType == 0 ? overscan.w != 0 || overscan.h != 0 : overscanPercent.w != 1 || overscanPercent.h != 1 ? 1 : 0"}}
    name Switch1
    label "\[value which]"
    xpos 261
    ypos 759
   }
set N94196ca0 [stack 0]
   Output {
    name Output1
    xpos 261
    ypos 921
   }
push $N94196ca0
   NoOp {
    name OutputBBox1
    selected true
    xpos 378
    ypos 821
    addUserKnob {20 User}
    addUserKnob {15 OutputBBox l "Output BBox"}
    OutputBBox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
    addUserKnob {14 outputBBoxCenter l "Output BBox Center" R 0 100}
    outputBBoxCenter {{OutputBBox.x+(OutputBBox.r-OutputBBox.x)/2} {OutputBBox.y+(OutputBBox.t-OutputBBox.y)/2}}
   }
  end_group
push $N9412b060
  Merge2 {
   inputs 2
   name Merge4
   label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
   xpos -60
   ypos -748
  }
push $N94026840
  CopyBBox {
   inputs 2
   name CopyBBox1
   xpos -221
   ypos -748
  }
  Dot {
   name Dot22
   note_font_size 41
   xpos -187
   ypos 198
  }
  Merge2 {
   inputs 2
   operation copy
   bbox B
   Achannels none
   Bchannels none
   output none
   also_merge {{{parent.Remove1.channels}}}
   name Merge5
   label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
   xpos -221
   ypos 283
  }
  Dot {
   name Dot17
   label A
   note_font_size 41
   xpos -187
   ypos 675
  }
  Dot {
   name Dot7
   note_font_size 41
   xpos -187
   ypos 805
  }
push $N94026840
  Dot {
   name Dot2
   note_font_size 41
   xpos -588
   ypos -1062
  }
  Dot {
   name Dot18
   label B
   note_font_size 41
   xpos -588
   ypos 654
  }
  Dot {
   name Dot3
   note_font_size 41
   xpos -588
   ypos 895
  }
  Merge2 {
   inputs 2+1
   operation copy
   Achannels none
   Bchannels none
   output none
   also_merge all
   name MergeKeymix
   xpos -221
   ypos 888
  }
  Output {
   name Output1
   xpos -221
   ypos 1202
  }
  NoOp {
   inputs 0
   name MergeNumber
   xpos 202
   ypos -1145
   addUserKnob {20 User}
   addUserKnob {3 mergeNumber}
   mergeNumber {{"output2 == 0 ? 25 : output2 == 1 ? 24 : output2 == 2 ? 22 : output2 == 3 ? 13 : output2 == 4 ? 24 : output2 == 5 ? 17 : 18"}}
  }
 end_group
 Grade {
  channels all
  white {{wrapHighlightAmount/10}}
  name FlareAmount
  xpos 1702
  ypos 1393
 }
 Multiply {
  channels rgba
  value {{globalAmount}}
  name MultiplyGlobal3
  label "\[value value]"
  xpos 1702
  ypos 1577
 }
 Dot {
  name Dot25
  label "LIGHT FLARE"
  note_font_size 61
  xpos 1736
  ypos 1801
 }
set N9420f030 [stack 0]
 Dot {
  name Dot31
  note_font_size 41
  xpos 1738
  ypos 2915
 }
set N94212ee0 [stack 0]
push $N938cc260
push $N938e6830
 Dot {
  name Dot20
  xpos 1059
  ypos 179
 }
 Shuffle {
  alpha white
  name Shuffle1
  label "\[value in] \[ expr \{ \[value out2] == \"none\" ? \" \" : \[concat -> \[value out2]] \}]"
  note_font_size 21
  note_font_color 0xffffffff
  xpos 1025
  ypos 238
 }
 Multiply {
  inputs 1+1
  channels rgba
  value 0
  name Multiply2
  label "\[value value]"
  xpos 1025
  ypos 366
 }
 Dot {
  name Dot9
  xpos 1059
  ypos 725
 }
set N94232060 [stack 0]
 Dot {
  name Dot28
  note_font_size 41
  xpos 1343
  ypos 725
 }
 Keyer {
  operation "luminance key"
  name Keyer1
  xpos 1309
  ypos 823
 }
push $N94232060
 Colorspace {
  colorspace_out CIE-Yxy
  name Colorspace4
  xpos 1188
  ypos 786
 }
 Expression {
  inputs 1+1
  expr0 "(r*(1+(r/((parent.dimHighlightsAmount+1)**2))) ) / (1+r)"
  channel1 {-rgba.red -rgba.green -rgba.blue none}
  expr1 "(g*(1+(g/((parent.dimHighlightsAmount+1)**2))) ) / (1+g)"
  channel2 {-rgba.red -rgba.green -rgba.blue none}
  expr2 "(b*(1+(b/((parent.dimHighlightsAmount+1)**2))) ) / (1+b)"
  expr3 a
  name Tonemap_whitepoint
  xpos 1188
  ypos 827
 }
 Colorspace {
  colorspace_in CIE-Yxy
  name Colorspace3
  xpos 1188
  ypos 867
 }
push $N94232060
 Switch {
  inputs 2
  which {{removeHighlights}}
  name Switch4
  xpos 1025
  ypos 867
 }
 Group {
  name ExponGlowWrapAll
  onCreate "n = nuke.thisNode()\nn.knob('size').setRange(0, 50)\n#n.knob('exp').setRange(1, 4)\nnuke.thisNode().knob('steps').setFlag(0x02000000)"
  knobChanged "n = nuke.thisNode()\nk = nuke.thisKnob()\n\nif k.name() == \"includeOriginal\":\n    if n.knob('includeOriginal').getValue() == 1:\n        merge = nuke.toNode(\"Merge1\")\n        original = nuke.toNode('Original')\n        AvgMult = nuke.toNode(\"AverageMult\")\n        steps = int(n.knob('steps').getValue())\n        merge.setInput(steps+1, original)\n        AvgMult\['whitepoint'].setValue(2 if steps<2 else steps+1)\n\n    else:\n        merge.setInput(steps+1, None)\n        AvgMult\['whitepoint'].setValue(2 if steps<2 else steps)\n\nelif k.name() == \"steps\":\n\n    s = int(k.value())\n    if s<1:\n        k.setValue(1)\n    else:\n        start = nuke.toNode(\"Start\")\n        end   = nuke.toNode(\"End\")\n        b1    = nuke.toNode(\"Blur1\")\n        m1    = nuke.toNode(\"Multiply1\")\n        merge = nuke.toNode(\"Merge1\")\n        AvgMult = nuke.toNode(\"AverageMult\")\n\n        b1x   = b1.xpos()\n        b1y   = b1.ypos()\n        b1n   = b1.name()\n\n        m1x   = m1.xpos()\n        m1y   = m1.ypos()\n        m1n   = m1.name()\n\n        steps = int(n.knob('steps').getValue())\n        size  = n.knob('size').getValue()\n        mult  = n.knob('exp').getValue()\n\n        #b1.setInput(0, start)\n        for i in range(1,merge.inputs()):\n            merge.setInput(i,None)\n        merge.setInput(0, m1)\n        \[nuke.delete(i) for i in nuke.allNodes() if i.xpos()>start.xpos()]\n        for i in range(1,steps):\n            # Blur\n            b = nuke.nodes.Blur()\n            m = nuke.nodes.Multiply()\n            b.setXYpos(b1x+i*100,b1y)\n            b.setInput(0,start)\n            b\[\"channels\"].setValue(\"all\")\n            b\[\"crop\"].setValue(0)\n            b\[\"size\"].setValue(0, 1)\n            b\[\"size\"].setExpression( \"((width/100*parent.size.w)*(aspectCalc.aspect.w/100)*(\{\}**2))\".format(str(i+1)), 0 )\n            b\[\"size\"].setExpression( \"((height/100*parent.size.h)*(aspectCalc.aspect.h/100)*(\{\}**2))\".format(str(i+1)), 1 )\n            b\[\"label\"].setValue('')\n            blurAbove = b.name()\n\n            m.setXYpos(m1x+i*100,m1y)\n            m.setInput(0, nuke.toNode(blurAbove))\n            m\[\"channels\"].setValue(\"all\")\n            m\[\"value\"].setValue(1,1,1,1)\n            j = 1-(i/steps)\n            m\[\"value\"].setExpression('falloffType == 0 ? \{\} :falloffType == 1 ? pow(\{\}, 3) : falloffType == 2 ? \{\}*\{\}*(3-2*\{\}) : falloffType == 3 ? \{\}*\{\}*(2 - \{\}) : falloffType == 4 ? \{\}*(1 + \{\}*(1 - \{\})) : 0'.format(j,j,j,j,j,j,j,j,j,j,j))\n            m\[\"mix\"].setExpression(\"falloff\")\n            m\[\"label\"].setValue('')\n\n            merge.setInput(i if i<2 else i+1, m)\n            AvgMult\['whitepoint'].setValue(i if i<2 else i+1)\n\n        if n.knob('includeOriginal').getValue() == 1:\n            merge = nuke.toNode(\"Merge1\")\n            original = nuke.toNode('Original')\n            AvgMult = nuke.toNode(\"AverageMult\")\n            steps = int(n.knob('steps').getValue())\n            merge.setInput(steps+1, original)\n            AvgMult\['whitepoint'].setValue(2 if steps<2 else steps+1)\n\nelif k.name() == \"output2\":\n    if n.knob(\"output2\").getValue() == 4:\n        n.knob('AvgMaxOriginal').setVisible(True)\n    else:\n        n.knob('AvgMaxOriginal').setVisible(False)\n\n"
  tile_color 0xcc804eff
  label "(\[value output2])"
  note_font "Verdana Bold Bold Bold Bold Bold Bold Bold"
  note_font_color 0xffffffff
  xpos 1025
  ypos 995
  addUserKnob {20 ExponBlurSimple}
  addUserKnob {41 channels T Remove1.channels}
  addUserKnob {26 ""}
  addUserKnob {4 output2 l Operation: M {Screen Plus Over Hypot Average Max Min "" "" "" "" ""}}
  output2 Over
  addUserKnob {3 steps l "  Steps" -STARTLINE}
  steps 8
  addUserKnob {26 text l " " T " "}
  addUserKnob {6 includeOriginal l "Include Original?" -STARTLINE}
  addUserKnob {6 AvgMaxOriginal l "Use Max of Average and Original" +HIDDEN +STARTLINE}
  AvgMaxOriginal true
  addUserKnob {14 size l Size R 0 50}
  size 10
  addUserKnob {14 exp l Exponent +INVISIBLE R 1 4}
  exp 3
  addUserKnob {6 color_rgba_panelDropped l "panel dropped state" +HIDDEN +STARTLINE}
  addUserKnob {7 falloff l Falloff}
  falloff 1
  addUserKnob {4 falloffType l "Falloff Type" M {Linear pLinear smooth smooth0 smooth1 ""}}
  falloffType pLinear
  addUserKnob {14 postBlur l "Post Blur" R 0 100}
  addUserKnob {26 ""}
  addUserKnob {41 maskChannelMask l mask T MergeKeymix.maskChannelMask}
  addUserKnob {41 inject -STARTLINE T MergeKeymix.inject}
  addUserKnob {41 invert_mask l invert -STARTLINE T MergeKeymix.invert_mask}
  addUserKnob {41 fringe -STARTLINE T MergeKeymix.fringe}
  addUserKnob {41 mix T MergeKeymix.mix}
  addUserKnob {14 safeBBoxPixels l "" +STARTLINE +HIDDEN R 0 400}
  safeBBoxPixels 100
  addUserKnob {14 adjustBBoxPercent l "" -STARTLINE +HIDDEN R 1 2}
  adjustBBoxPercent 1
  addUserKnob {20 info l Info}
  addUserKnob {26 creator l Creator: T "Tony Lyons"}
  addUserKnob {26 desc l Description: t "Add description and tooltip for gizmo" T ExponBlurSimple}
  addUserKnob {26 ver l Version: T v02}
 }
  Input {
   inputs 0
   name Inputmask
   xpos 346
   ypos 596
   number 1
  }
  Dot {
   name Dot19
   label Mask
   note_font_size 41
   xpos 380
   ypos 662
  }
  Dot {
   name Dot10
   note_font_size 41
   xpos 380
   ypos 899
  }
  Input {
   inputs 0
   name Inputimg
   xpos -221
   ypos -1229
  }
  Dot {
   name Dot16
   note_font_size 41
   xpos -187
   ypos -1062
  }
set N93767490 [stack 0]
  Dot {
   name Dot1
   note_font_size 41
   xpos 461
   ypos -1058
  }
  Remove {
   operation keep
   channels rgba
   name Remove1
   xpos 427
   ypos -980
  }
  NoOp {
   name aspectCalc
   xpos 427
   ypos -939
   addUserKnob {20 User}
   addUserKnob {14 aspect R 0 100}
   aspect {{parent.size.w} {parent.size.h/format.pixel_aspect/height*width}}
  }
  Dot {
   name Dot21
   note_font_size 41
   xpos 461
   ypos -853
  }
set N9377adc0 [stack 0]
  Invert {
   name Invert1
   xpos 864
   ypos -860
   disable {{"parent.size < 0 ? 0 : 1"}}
  }
set N9377ed20 [stack 0]
  Dot {
   name Dot4
   note_font_size 41
   xpos 540
   ypos -604
  }
  NoOp {
   name Original
   xpos 506
   ypos -327
  }
  Dot {
   name Dot5
   note_font_size 41
   xpos 540
   ypos 100
  }
push $N9377ed20
  NoOp {
   name Start
   xpos 864
   ypos -706
  }
set N93794a20 [stack 0]
  Blur {
   size {{((width/100*parent.size.w)*(aspectCalc.aspect.w/100)*(8**2))} {((height/100*parent.size.h)*(aspectCalc.aspect.h/100)*(8**2))}}
   crop false
   name Blur8
   xpos 1564
   ypos -554
  }
  Multiply {
   value {{"falloffType == 0 ? 0.125 :falloffType == 1 ? pow(0.125, 3) : falloffType == 2 ? 0.125*0.125*(3-2*0.125) : falloffType == 3 ? 0.125*0.125*(2 - 0.125) : falloffType == 4 ? 0.125*(1 + 0.125*(1 - 0.125)) : 0"} {"falloffType == 0 ? 0.125 :falloffType == 1 ? pow(0.125, 3) : falloffType == 2 ? 0.125*0.125*(3-2*0.125) : falloffType == 3 ? 0.125*0.125*(2 - 0.125) : falloffType == 4 ? 0.125*(1 + 0.125*(1 - 0.125)) : 0"} {"falloffType == 0 ? 0.125 :falloffType == 1 ? pow(0.125, 3) : falloffType == 2 ? 0.125*0.125*(3-2*0.125) : falloffType == 3 ? 0.125*0.125*(2 - 0.125) : falloffType == 4 ? 0.125*(1 + 0.125*(1 - 0.125)) : 0"} {"falloffType == 0 ? 0.125 :falloffType == 1 ? pow(0.125, 3) : falloffType == 2 ? 0.125*0.125*(3-2*0.125) : falloffType == 3 ? 0.125*0.125*(2 - 0.125) : falloffType == 4 ? 0.125*(1 + 0.125*(1 - 0.125)) : 0"}}
   mix {{falloff}}
   name Multiply8
   xpos 1564
   ypos -477
  }
push $N93794a20
  Blur {
   size {{((width/100*parent.size.w)*(aspectCalc.aspect.w/100)*(7**2))} {((height/100*parent.size.h)*(aspectCalc.aspect.h/100)*(7**2))}}
   crop false
   name Blur7
   xpos 1464
   ypos -554
  }
  Multiply {
   value {{"falloffType == 0 ? 0.25 :falloffType == 1 ? pow(0.25, 3) : falloffType == 2 ? 0.25*0.25*(3-2*0.25) : falloffType == 3 ? 0.25*0.25*(2 - 0.25) : falloffType == 4 ? 0.25*(1 + 0.25*(1 - 0.25)) : 0"} {"falloffType == 0 ? 0.25 :falloffType == 1 ? pow(0.25, 3) : falloffType == 2 ? 0.25*0.25*(3-2*0.25) : falloffType == 3 ? 0.25*0.25*(2 - 0.25) : falloffType == 4 ? 0.25*(1 + 0.25*(1 - 0.25)) : 0"} {"falloffType == 0 ? 0.25 :falloffType == 1 ? pow(0.25, 3) : falloffType == 2 ? 0.25*0.25*(3-2*0.25) : falloffType == 3 ? 0.25*0.25*(2 - 0.25) : falloffType == 4 ? 0.25*(1 + 0.25*(1 - 0.25)) : 0"} {"falloffType == 0 ? 0.25 :falloffType == 1 ? pow(0.25, 3) : falloffType == 2 ? 0.25*0.25*(3-2*0.25) : falloffType == 3 ? 0.25*0.25*(2 - 0.25) : falloffType == 4 ? 0.25*(1 + 0.25*(1 - 0.25)) : 0"}}
   mix {{falloff}}
   name Multiply7
   xpos 1464
   ypos -477
  }
push $N93794a20
  Blur {
   size {{((width/100*parent.size.w)*(aspectCalc.aspect.w/100)*(6**2))} {((height/100*parent.size.h)*(aspectCalc.aspect.h/100)*(6**2))}}
   crop false
   name Blur6
   xpos 1364
   ypos -554
  }
  Multiply {
   value {{"falloffType == 0 ? 0.375 :falloffType == 1 ? pow(0.375, 3) : falloffType == 2 ? 0.375*0.375*(3-2*0.375) : falloffType == 3 ? 0.375*0.375*(2 - 0.375) : falloffType == 4 ? 0.375*(1 + 0.375*(1 - 0.375)) : 0"} {"falloffType == 0 ? 0.375 :falloffType == 1 ? pow(0.375, 3) : falloffType == 2 ? 0.375*0.375*(3-2*0.375) : falloffType == 3 ? 0.375*0.375*(2 - 0.375) : falloffType == 4 ? 0.375*(1 + 0.375*(1 - 0.375)) : 0"} {"falloffType == 0 ? 0.375 :falloffType == 1 ? pow(0.375, 3) : falloffType == 2 ? 0.375*0.375*(3-2*0.375) : falloffType == 3 ? 0.375*0.375*(2 - 0.375) : falloffType == 4 ? 0.375*(1 + 0.375*(1 - 0.375)) : 0"} {"falloffType == 0 ? 0.375 :falloffType == 1 ? pow(0.375, 3) : falloffType == 2 ? 0.375*0.375*(3-2*0.375) : falloffType == 3 ? 0.375*0.375*(2 - 0.375) : falloffType == 4 ? 0.375*(1 + 0.375*(1 - 0.375)) : 0"}}
   mix {{falloff}}
   name Multiply6
   xpos 1364
   ypos -477
  }
push $N93794a20
  Blur {
   size {{((width/100*parent.size.w)*(aspectCalc.aspect.w/100)*(5**2))} {((height/100*parent.size.h)*(aspectCalc.aspect.h/100)*(5**2))}}
   crop false
   name Blur5
   xpos 1264
   ypos -554
  }
  Multiply {
   value {{"falloffType == 0 ? 0.5 :falloffType == 1 ? pow(0.5, 3) : falloffType == 2 ? 0.5*0.5*(3-2*0.5) : falloffType == 3 ? 0.5*0.5*(2 - 0.5) : falloffType == 4 ? 0.5*(1 + 0.5*(1 - 0.5)) : 0"} {"falloffType == 0 ? 0.5 :falloffType == 1 ? pow(0.5, 3) : falloffType == 2 ? 0.5*0.5*(3-2*0.5) : falloffType == 3 ? 0.5*0.5*(2 - 0.5) : falloffType == 4 ? 0.5*(1 + 0.5*(1 - 0.5)) : 0"} {"falloffType == 0 ? 0.5 :falloffType == 1 ? pow(0.5, 3) : falloffType == 2 ? 0.5*0.5*(3-2*0.5) : falloffType == 3 ? 0.5*0.5*(2 - 0.5) : falloffType == 4 ? 0.5*(1 + 0.5*(1 - 0.5)) : 0"} {"falloffType == 0 ? 0.5 :falloffType == 1 ? pow(0.5, 3) : falloffType == 2 ? 0.5*0.5*(3-2*0.5) : falloffType == 3 ? 0.5*0.5*(2 - 0.5) : falloffType == 4 ? 0.5*(1 + 0.5*(1 - 0.5)) : 0"}}
   mix {{falloff}}
   name Multiply5
   xpos 1264
   ypos -477
  }
push $N93794a20
  Blur {
   size {{((width/100*parent.size.w)*(aspectCalc.aspect.w/100)*(4**2))} {((height/100*parent.size.h)*(aspectCalc.aspect.h/100)*(4**2))}}
   crop false
   name Blur4
   xpos 1164
   ypos -554
  }
  Multiply {
   value {{"falloffType == 0 ? 0.625 :falloffType == 1 ? pow(0.625, 3) : falloffType == 2 ? 0.625*0.625*(3-2*0.625) : falloffType == 3 ? 0.625*0.625*(2 - 0.625) : falloffType == 4 ? 0.625*(1 + 0.625*(1 - 0.625)) : 0"} {"falloffType == 0 ? 0.625 :falloffType == 1 ? pow(0.625, 3) : falloffType == 2 ? 0.625*0.625*(3-2*0.625) : falloffType == 3 ? 0.625*0.625*(2 - 0.625) : falloffType == 4 ? 0.625*(1 + 0.625*(1 - 0.625)) : 0"} {"falloffType == 0 ? 0.625 :falloffType == 1 ? pow(0.625, 3) : falloffType == 2 ? 0.625*0.625*(3-2*0.625) : falloffType == 3 ? 0.625*0.625*(2 - 0.625) : falloffType == 4 ? 0.625*(1 + 0.625*(1 - 0.625)) : 0"} {"falloffType == 0 ? 0.625 :falloffType == 1 ? pow(0.625, 3) : falloffType == 2 ? 0.625*0.625*(3-2*0.625) : falloffType == 3 ? 0.625*0.625*(2 - 0.625) : falloffType == 4 ? 0.625*(1 + 0.625*(1 - 0.625)) : 0"}}
   mix {{falloff}}
   name Multiply4
   xpos 1164
   ypos -477
  }
push $N93794a20
  Blur {
   size {{((width/100*parent.size.w)*(aspectCalc.aspect.w/100)*(3**2))} {((height/100*parent.size.h)*(aspectCalc.aspect.h/100)*(3**2))}}
   crop false
   name Blur3
   xpos 1064
   ypos -554
  }
  Multiply {
   value {{"falloffType == 0 ? 0.75 :falloffType == 1 ? pow(0.75, 3) : falloffType == 2 ? 0.75*0.75*(3-2*0.75) : falloffType == 3 ? 0.75*0.75*(2 - 0.75) : falloffType == 4 ? 0.75*(1 + 0.75*(1 - 0.75)) : 0"} {"falloffType == 0 ? 0.75 :falloffType == 1 ? pow(0.75, 3) : falloffType == 2 ? 0.75*0.75*(3-2*0.75) : falloffType == 3 ? 0.75*0.75*(2 - 0.75) : falloffType == 4 ? 0.75*(1 + 0.75*(1 - 0.75)) : 0"} {"falloffType == 0 ? 0.75 :falloffType == 1 ? pow(0.75, 3) : falloffType == 2 ? 0.75*0.75*(3-2*0.75) : falloffType == 3 ? 0.75*0.75*(2 - 0.75) : falloffType == 4 ? 0.75*(1 + 0.75*(1 - 0.75)) : 0"} {"falloffType == 0 ? 0.75 :falloffType == 1 ? pow(0.75, 3) : falloffType == 2 ? 0.75*0.75*(3-2*0.75) : falloffType == 3 ? 0.75*0.75*(2 - 0.75) : falloffType == 4 ? 0.75*(1 + 0.75*(1 - 0.75)) : 0"}}
   mix {{falloff}}
   name Multiply3
   xpos 1064
   ypos -477
  }
push 0
push $N93794a20
  Blur {
   size {{((width/100*parent.size.w)*(aspectCalc.aspect.w/100)*(2**2))} {((height/100*parent.size.h)*(aspectCalc.aspect.h/100)*(2**2))}}
   crop false
   name Blur2
   xpos 964
   ypos -554
  }
  Multiply {
   value {{"falloffType == 0 ? 0.875 :falloffType == 1 ? pow(0.875, 3) : falloffType == 2 ? 0.875*0.875*(3-2*0.875) : falloffType == 3 ? 0.875*0.875*(2 - 0.875) : falloffType == 4 ? 0.875*(1 + 0.875*(1 - 0.875)) : 0"} {"falloffType == 0 ? 0.875 :falloffType == 1 ? pow(0.875, 3) : falloffType == 2 ? 0.875*0.875*(3-2*0.875) : falloffType == 3 ? 0.875*0.875*(2 - 0.875) : falloffType == 4 ? 0.875*(1 + 0.875*(1 - 0.875)) : 0"} {"falloffType == 0 ? 0.875 :falloffType == 1 ? pow(0.875, 3) : falloffType == 2 ? 0.875*0.875*(3-2*0.875) : falloffType == 3 ? 0.875*0.875*(2 - 0.875) : falloffType == 4 ? 0.875*(1 + 0.875*(1 - 0.875)) : 0"} {"falloffType == 0 ? 0.875 :falloffType == 1 ? pow(0.875, 3) : falloffType == 2 ? 0.875*0.875*(3-2*0.875) : falloffType == 3 ? 0.875*0.875*(2 - 0.875) : falloffType == 4 ? 0.875*(1 + 0.875*(1 - 0.875)) : 0"}}
   mix {{falloff}}
   name Multiply2
   xpos 964
   ypos -477
  }
push $N93794a20
  Blur {
   size {{(width/100*parent.size*(aspectCalc.aspect.w/100))} {(height/100*parent.size*(aspectCalc.aspect.h/100))}}
   crop false
   name Blur1
   xpos 864
   ypos -554
  }
  Multiply {
   value {1 1 1 1}
   mix {{falloff}}
   name Multiply1
   xpos 864
   ypos -477
  }
  Merge2 {
   inputs 8+1
   operation {{MergeNumber.mergeNumber}}
   also_merge all
   name Merge1
   label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
   xpos 864
   ypos -327
  }
  NoOp {
   name End
   xpos 864
   ypos -279
  }
  Grade {
   channels all
   whitepoint 8
   black_clamp false
   name AverageMult
   xpos 864
   ypos 49
   disable {{"output2 == 4 ? 0 : 1"}}
  }
  Merge2 {
   inputs 2
   operation max
   also_merge all
   name Merge2
   label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
   xpos 864
   ypos 96
   disable {{"output2 == 4 && includeOriginal == 1 && AvgMaxOriginal == 1 ? 0 : 1"}}
  }
  Blur {
   size {{postBlur} {postBlur}}
   name BlurOriginal
   xpos 864
   ypos 155
  }
  Invert {
   name Invert2
   xpos 864
   ypos 283
   disable {{"parent.size < 0 ? 0 : 1"}}
  }
push $N9377adc0
  Switch {
   inputs 2
   which {{"parent.size == 0 ? 0 : 1"}}
   name Switch1
   label "\[value which]"
   xpos 427
   ypos 283
  }
  Crop {
   inputs 0
   box {{input.format.x} {input.format.y} {input.format.r} {input.format.t}}
   reformat true
   crop false
   name Crop1
   xpos 96
   ypos -931
   addUserKnob {20 User}
   addUserKnob {22 cropToBbox l "Crop to Bounding Box" -STARTLINE T codeBBox()}
  }
  AddChannels {
   channels rgba
   name AddChannels2
   xpos 96
   ypos -891
  }
push $N93767490
  Merge2 {
   inputs 2
   name Merge3
   label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
   xpos -60
   ypos -891
  }
set N93f29f80 [stack 0]
  Group {
   name BBoxToFormat
   onCreate "n = nuke.thisNode()\ninputFormat = n.knob(\"inputFormat\")\ninputBBox = n.knob(\"inputBBox\")\ncrop = nuke.toNode(\"Crop6\")\ncropb = crop.knob('box')\noutputBBox = n.knob('outputBBox')\noutputBBoxCenter = n.knob(\"outputBBoxCenter\")\n\ninputFormat.setFlag(0x0000000000008000)\ninputBBox.setFlag(0x0000000000008000)\ncropb.setFlag(0x0000000000008000)\noutputBBox.setFlag(0x0000000000008000)\noutputBBoxCenter.setFlag(0x0000000000008000)\n\nn = nuke.thisNode()\nn.knob(\"overscan\").setRange(0,400)\nn.knob(\"overscanPercent\").setRange(1,4)"
   knobChanged "n = nuke.thisNode()\nk = nuke.thisKnob()\nif k.name() == \"overscanType\":\n    if n.knob(\"overscanType\").getValue() == 1:\n        n.knob(\"overscanPercent\").setVisible(True)\n        n.knob(\"overscan\").setVisible(False)\n    else:\n        n.knob(\"overscanPercent\").setVisible(False)\n        n.knob(\"overscan\").setVisible(True)"
   tile_color 0xa57aaaff
   note_font "Verdana Bold Bold Bold Bold Bold Bold Bold"
   note_font_color 0xffffffff
   xpos 29
   ypos -812
   addUserKnob {20 CropBBox}
   addUserKnob {4 type l Type +INVISIBLE M {"To Format" "To BBox"}}
   addUserKnob {41 intersect T Crop6.intersect}
   addUserKnob {6 blackOutside l "Black Outside" -STARTLINE}
   addUserKnob {4 overscanType l "Overscan Type:" M {Pixels Percentage}}
   overscanType Percentage
   addUserKnob {14 overscan l Overscan +HIDDEN R 0 400}
   addUserKnob {14 overscanPercent l "Overscan Percent" R 1 4}
   overscanPercent 1.2
   addUserKnob {20 inputBbox l "BBox Data" n 1}
   addUserKnob {15 inputFormat l "Input Format"}
   inputFormat {0 0 {input.width} {input.height}}
   addUserKnob {15 inputBBox l "Input BBox"}
   inputBBox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
   addUserKnob {12 outputBBoxCenter l OutputBBoxCenter}
   outputBBoxCenter {{OutputBBox1.outputBBoxCenter.w} {OutputBBox1.outputBBoxCenter.h}}
   addUserKnob {15 outputBBox l "Output BBox"}
   outputBBox {{OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox}}
   addUserKnob {20 endGroup n -1}
   addUserKnob {20 info_1 l Info}
   addUserKnob {26 creator l Creator: T "<b><big>Tony Lyons"}
   addUserKnob {26 desc l Description: t "crop to inputformat\n\ndisplays values of input bbox" T CropBBox}
   addUserKnob {26 ver l Version: T v02}
  }
   Input {
    inputs 0
    name Input
    xpos 261
    ypos 394
   }
   Dot {
    name Dot2
    note_font_size 41
    xpos 295
    ypos 462
   }
set N93265d70 [stack 0]
   Dot {
    name Dot1
    note_font_size 41
    xpos -160
    ypos 462
   }
set N93269c90 [stack 0]
push $N93265d70
   Crop {
    box {{curve} {curve} {input.width} {input.height}}
    crop {{parent.blackOutside}}
    name Crop6
    xpos 261
    ypos 510
    addUserKnob {20 User}
    addUserKnob {22 cropToBbox l "Crop to Bounding Box" -STARTLINE T codeBBox()}
   }
set N9326db70 [stack 0]
   Remove {
    operation keep
    channels none
    name Remove1
    xpos 120
    ypos 504
   }
set N93277360 [stack 0]
   Transform {
    scale {{parent.overscanPercent} {parent.overscanPercent}}
    center {{input.bbox.r/2} {input.bbox.t/2}}
    shutteroffset centred
    name Transform1
    xpos 120
    ypos 555
   }
push $N93277360
   AdjBBox {
    numpixels {{parent.overscan} {parent.overscan}}
    name AdjBBox1
    xpos -5
    ypos 510
   }
   Switch {
    inputs 2
    which {{overscanType}}
    name Switch2
    label "\[value which]"
    xpos -5
    ypos 549
   }
   Merge2 {
    inputs 2
    bbox intersection
    Achannels {-rgba.red -rgba.green -rgba.blue rgba.alpha}
    Bchannels {-rgba.red -rgba.green -rgba.blue rgba.alpha}
    output {-rgba.red -rgba.green -rgba.blue rgba.alpha}
    name Merge1
    xpos -5
    ypos 647
    disable {{!parent.Crop6.intersect}}
   }
push $N93269c90
   CopyBBox {
    inputs 2
    name CopyBBox1
    xpos -194
    ypos 653
   }
   BlackOutside {
    name BlackOutside1
    xpos -194
    ypos 692
    disable {{!parent.blackOutside}}
   }
   Dot {
    name Dot4
    note_font_size 41
    xpos -160
    ypos 769
   }
push $N9326db70
   Switch {
    inputs 2
    which {{"overscanType == 0 ? overscan.w != 0 || overscan.h != 0 : overscanPercent.w != 1 || overscanPercent.h != 1 ? 1 : 0"}}
    name Switch1
    label "\[value which]"
    xpos 261
    ypos 759
   }
set N932b5560 [stack 0]
   Output {
    name Output1
    xpos 261
    ypos 921
   }
push $N932b5560
   NoOp {
    name OutputBBox1
    selected true
    xpos 378
    ypos 821
    addUserKnob {20 User}
    addUserKnob {15 OutputBBox l "Output BBox"}
    OutputBBox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
    addUserKnob {14 outputBBoxCenter l "Output BBox Center" R 0 100}
    outputBBoxCenter {{OutputBBox.x+(OutputBBox.r-OutputBBox.x)/2} {OutputBBox.y+(OutputBBox.t-OutputBBox.y)/2}}
   }
  end_group
push $N93f29f80
  Merge2 {
   inputs 2
   name Merge4
   label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
   xpos -60
   ypos -748
  }
push $N93767490
  CopyBBox {
   inputs 2
   name CopyBBox1
   xpos -221
   ypos -748
  }
  Dot {
   name Dot22
   note_font_size 41
   xpos -187
   ypos 198
  }
  Merge2 {
   inputs 2
   operation copy
   bbox B
   Achannels none
   Bchannels none
   output none
   also_merge {{{parent.Remove1.channels}}}
   name Merge5
   label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
   xpos -221
   ypos 283
  }
  Dot {
   name Dot17
   label A
   note_font_size 41
   xpos -187
   ypos 675
  }
  Dot {
   name Dot7
   note_font_size 41
   xpos -187
   ypos 805
  }
push $N93767490
  Dot {
   name Dot2
   note_font_size 41
   xpos -588
   ypos -1062
  }
  Dot {
   name Dot18
   label B
   note_font_size 41
   xpos -588
   ypos 654
  }
  Dot {
   name Dot3
   note_font_size 41
   xpos -588
   ypos 895
  }
  Merge2 {
   inputs 2+1
   operation copy
   Achannels none
   Bchannels none
   output none
   also_merge all
   name MergeKeymix
   xpos -221
   ypos 888
  }
  Output {
   name Output1
   xpos -221
   ypos 1202
  }
  NoOp {
   inputs 0
   name MergeNumber
   xpos 202
   ypos -1145
   addUserKnob {20 User}
   addUserKnob {3 mergeNumber}
   mergeNumber {{"output2 == 0 ? 25 : output2 == 1 ? 24 : output2 == 2 ? 22 : output2 == 3 ? 13 : output2 == 4 ? 24 : output2 == 5 ? 17 : 18"}}
  }
 end_group
 Dot {
  name Dot40
  note_font_size 41
  xpos 1059
  ypos 1277
 }
set N937f0610 [stack 0]
 Grade {
  channels all
  white {{wrapAllAmount/10}}
  name GradeBgWrapAmount
  xpos 1025
  ypos 1399
 }
 Multiply {
  channels rgba
  value {{globalAmount}}
  name MultiplyGlobal1
  label "\[value value]"
  xpos 1025
  ypos 1566
 }
 Dot {
  name Dot37
  label "WRAP ALL"
  note_font_size 61
  xpos 1059
  ypos 1692
 }
set N9437dcc0 [stack 0]
 Dot {
  name Dot27
  note_font_size 41
  xpos 1059
  ypos 3062
 }
set N94381b70 [stack 0]
 Merge2 {
  inputs 2
  name Merge1
  xpos 1530
  ypos 3168
 }
 Shuffle {
  alpha white
  name Shuffle5
  tile_color 0xffffffff
  note_font_color 0xffffffff
  xpos 1530
  ypos 3216
 }
 Merge2 {
  inputs 2
  operation mask
  name Merge14
  xpos 1530
  ypos 3274
 }
push $N938c44e0
push $N94381b70
 Shuffle {
  alpha white
  name Shuffle2
  tile_color 0xffffffff
  note_font_color 0xffffffff
  xpos 1025
  ypos 3158
 }
 Merge2 {
  inputs 2
  operation mask
  name Merge7
  xpos 1025
  ypos 3221
 }
push $N938c0580
push $N94212ee0
 Shuffle {
  alpha white
  name Shuffle4
  tile_color 0xffffffff
  note_font_color 0xffffffff
  xpos 1708
  ypos 3020
 }
 Merge2 {
  inputs 2
  operation mask
  name Merge13
  xpos 1708
  ypos 3104
 }
push $N938f34d0
 Dot {
  name Dot21
  xpos 2349
  ypos 397
 }
 Shuffle {
  red alpha
  green alpha
  blue alpha
  name Shuffle3
  tile_color 0xffffffff
  label alpha
  note_font_size 21
  note_font_color 0xffffffff
  xpos 2315
  ypos 496
 }
 Dot {
  name Dot23
  xpos 2349
  ypos 3399
 }
push $N937f0610
 Dot {
  name Dot29
  note_font_size 41
  xpos 757
  ypos 1277
 }
set N943f7fa0 [stack 0]
 Grade {
  channels rgba
  gamma {{parent.bleedColorFalloff_2}}
  name Grade1
  selected true
  xpos 724
  ypos 2638
 }
 Dot {
  name Dot33
  note_font_size 41
  xpos 758
  ypos 2835
 }
 Multiply {
  channels rgba
  value {{globalAmount}}
  name MultiplyGlobal2
  label "\[value value]"
  xpos 297
  ypos 2828
 }
push $N94232060
 Dot {
  name Dot38
  note_font_size 41
  xpos 438
  ypos 725
 }
set N94419f70 [stack 0]
 Dot {
  name Dot2
  note_font_size 41
  xpos 439
  ypos 802
 }
set N9441de20 [stack 0]
 Dot {
  name Dot17
  note_font_size 41
  xpos 334
  ypos 802
 }
 Dot {
  name Dot16
  note_font_size 41
  xpos 334
  ypos 1201
 }
push $N9441de20
 Blur {
  size {{(width/13*parent.bleedColorSize*16*(ExponGlowWrapAll.aspectCalc.aspect.w/100))} {(height/13*parent.bleedColorSize*16*(ExponGlowWrapAll.aspectCalc.aspect.h/100))}}
  crop false
  name Blur6
  xpos 856
  ypos 874
 }
push $N9441de20
 Blur {
  size {{(width/13*parent.bleedColorSize*8*(ExponGlowWrapAll.aspectCalc.aspect.w/100))} {(height/13*parent.bleedColorSize*8*(ExponGlowWrapAll.aspectCalc.aspect.h/100))}}
  crop false
  name Blur4
  xpos 743
  ypos 873
 }
push $N9441de20
 Blur {
  size {{(width/15*parent.bleedColorSize*4*(ExponGlowWrapAll.aspectCalc.aspect.w/100))} {(height/15*parent.bleedColorSize*4*(ExponGlowWrapAll.aspectCalc.aspect.h/100))}}
  crop false
  name Blur3
  xpos 627
  ypos 874
 }
push $N9441de20
 Blur {
  size {{(width/20*parent.bleedColorSize*2*(ExponGlowWrapAll.aspectCalc.aspect.w/100))} {(height/20*parent.bleedColorSize*2*(ExponGlowWrapAll.aspectCalc.aspect.h/100))}}
  crop false
  name Blur2
  xpos 515
  ypos 872
 }
push $N9441de20
 Blur {
  size {{(width/25*parent.bleedColorSize*(ExponGlowWrapAll.aspectCalc.aspect.w/100))} {(height/25*parent.bleedColorSize*(ExponGlowWrapAll.aspectCalc.aspect.h/100))}}
  crop false
  name Blur1
  xpos 404
  ypos 871
 }
 Merge2 {
  inputs 2
  operation under
  bbox B
  name Merge2
  label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
  xpos 404
  ypos 941
 }
 Merge2 {
  inputs 2
  operation under
  bbox B
  name Merge4
  label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
  xpos 404
  ypos 999
 }
 Merge2 {
  inputs 2
  operation under
  bbox B
  name Merge8
  label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
  xpos 404
  ypos 1049
 }
 Merge2 {
  inputs 2
  operation under
  bbox B
  name Merge12
  label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
  xpos 404
  ypos 1087
 }
 Unpremult {
  name Unpremult2
  xpos 404
  ypos 1111
 }
 Blur {
  size {{(width/50*parent.bleedColorSize*10*(ExponGlowWrapAll.aspectCalc.aspect.w/100))} {(height/50*parent.bleedColorSize*10*(ExponGlowWrapAll.aspectCalc.aspect.h/100))}}
  crop false
  name Blur5
  xpos 404
  ypos 1151
 }
 CopyBBox {
  inputs 2
  name CopyBBox1
  xpos 404
  ypos 1198
 }
 Unpremult {
  name Unpremult5
  xpos 404
  ypos 2385
 }
 Colorspace {
  channels all
  colorspace_out HSV
  name Colorspace1
  xpos 404
  ypos 2456
 }
 Multiply {
  value {1 1 0 1}
  name Multiply5
  label "\[value value]"
  xpos 404
  ypos 2532
 }
push $N9420f030
push $N9437dcc0
push $N94419f70
 Dot {
  name Dot10
  xpos 201
  ypos 725
 }
 Clamp {
  minimum 0.001
  maximum 100
  name Clamp1
  xpos 167
  ypos 996
 }
 Dot {
  name Dot24
  xpos 201
  ypos 1517
 }
 Multiply {
  channels rgba
  value {{globalAmount}}
  name MultiplyGlobal
  label "\[value value]"
  xpos 19
  ypos 1507
 }
push $N943f7fa0
 Colorspace {
  channels all
  colorspace_out HSV
  name Colorspace6
  xpos -13
  ypos 1267
 }
 Multiply {
  value {1 1 0 1}
  name Multiply4
  label "\[value value]"
  xpos -123
  ypos 1262
 }
push $N938b49e0
 Remove {
  operation keep
  channels rgba
  name Remove1
  xpos -413
  ypos 594
 }
 Unpremult {
  channels all
  name Unpremult1
  xpos -407
  ypos 1094
  disable {{premultiplied*-1+1 x1 1}}
 }
set N94515860 [stack 0]
 Dot {
  name Dot12
  xpos -226
  ypos 1101
 }
 Colorspace {
  channels all
  colorspace_out HSV
  name Colorspace5
  xpos -260
  ypos 1140
 }
 Multiply {
  value {0 0 1 1}
  name Multiply3
  label "\[value value]"
  xpos -260
  ypos 1188
 }
 Merge2 {
  inputs 2
  operation plus
  Achannels none
  Bchannels none
  output none
  also_merge all
  name Merge3
  label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
  xpos -260
  ypos 1267
 }
 Colorspace {
  channels all
  colorspace_in HSV
  name Colorspace7
  xpos -260
  ypos 1327
 }
 Dot {
  name Dot36
  label "BLEND EDGES"
  note_font_size 45
  xpos -226
  ypos 1408
 }
push $N94515860
 Dot {
  name Dot18
  note_font_size 41
  xpos -373
  ypos 1514
 }
set N9455eaf0 [stack 0]
 Merge2 {
  inputs 2+1
  operation copy
  bbox B
  Achannels none
  Bchannels none
  output none
  also_merge all
  mix {{blendEdgesAmount}}
  name Merge10
  xpos -260
  ypos 1507
 }
 Dot {
  name Dot22
  note_font_size 41
  xpos -226
  ypos 1588
 }
push $N9455eaf0
 Switch {
  inputs 2
  which {{"blendEdgesAmount == 0 ? 0 : 1"}}
  name Switch3
  xpos -407
  ypos 1585
 }
 Merge2 {
  inputs 2
  bbox B
  Achannels none
  Bchannels none
  output none
  also_merge all
  name Merge5
  xpos -407
  ypos 1685
 }
 Merge2 {
  inputs 2
  bbox B
  Achannels none
  Bchannels none
  output none
  also_merge all
  name Merge6
  xpos -407
  ypos 1791
 }
 Dot {
  name Dot34
  note_font_size 41
  xpos -373
  ypos 2417
 }
set N932ec7a0 [stack 0]
 Colorspace {
  channels all
  colorspace_out HSV
  name Colorspace2
  xpos -81
  ypos 2410
 }
 Multiply {
  value {0 0 1 1}
  name Multiply6
  label "\[value value]"
  xpos -81
  ypos 2458
 }
 Merge2 {
  inputs 2
  operation plus
  Achannels none
  Bchannels none
  output none
  also_merge all
  name Merge11
  label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
  xpos -81
  ypos 2537
 }
 Colorspace {
  channels all
  colorspace_in HSV
  name Colorspace8
  xpos -81
  ypos 2606
 }
push $N94515860
 Dot {
  name Dot13
  xpos -579
  ypos 1101
 }
 Dot {
  name Dot14
  xpos -579
  ypos 2559
 }
push $N932ec7a0
 Copy {
  inputs 2
  from0 rgba.alpha
  to0 rgba.alpha
  name Copy1
  xpos -407
  ypos 2552
 }
 Dot {
  name Dot6
  note_font_size 41
  xpos -373
  ypos 2649
 }
set N93f9cc00 [stack 0]
 Merge2 {
  inputs 2+1
  operation copy
  output {rgba.red rgba.green rgba.blue -rgba.alpha}
  mix {{bleedColorAmount}}
  name Merge9
  label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
  xpos -81
  ypos 2828
 }
push $N93f9cc00
 Switch {
  inputs 2
  which {{"parent.bleedColorAmount== 0 ? 0 : 1"}}
  name Switch2
  xpos -407
  ypos 2832
 }
 Premult {
  name Premult3
  xpos -407
  ypos 2983
  disable {{premultiplied*-1+1 i}}
 }
 Dot {
  name Dot19
  xpos -373
  ypos 3396
 }
 Switch {
  inputs 5
  which {{"\[value ls parent.outputView]"}}
  name Switch1
  xpos 1708
  ypos 3395
 }
push $N938bc6a0
 Dot {
  name Dot5
  note_font_size 41
  xpos -825
  ypos 3581
 }
 Merge2 {
  inputs 2+1
  operation copy
  also_merge all
  name MergeCopyLightWrapPro
  label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
  xpos 1708
  ypos 3580
 }
 Output {
  name Output1
  xpos 1708
  ypos 3898
 }
end_group
Dot {
 name Dot323
 selected true
 xpos -1423
 ypos 5192
}
Dot {
 name Dot324
 note_font_size 41
 selected true
 xpos 5461
 ypos 5192
}
set N94579930 [stack 0]
Remove {
 operation keep
 channels rgba
 name Remove7
 selected true
 xpos 5571
 ypos 5188
}
push $N93a04010
Dot {
 name Dot121
 note_font_size 41
 selected true
 xpos -809
 ypos 2372
}
set N945822f0 [stack 0]
Dot {
 name Dot124
 note_font_size 41
 selected true
 xpos -661
 ypos 2372
}
Shuffle {
 in GS_Plate
 name Shuffle25
 label "\[value in]"
 selected true
 xpos -695
 ypos 2415
}
Remove {
 operation keep
 channels rgba
 name Remove4
 selected true
 xpos -695
 ypos 2453
}
NoOp {
 name Anchor_2bcb55a0c8
 help "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019"
 onCreate "if nuke.GUI:\n    try:\n        import stamps; stamps.anchorOnCreate()\n    except:\n        pass"
 knobChanged stamps.anchorKnobChanged()
 autolabel "nuke.thisNode().knob(\"title\").value()"
 tile_color 0xffffff01
 note_font_size 20
 selected true
 xpos -695
 ypos 2509
 addUserKnob {20 anchor_tab l "Anchor Stamp"}
 addUserKnob {26 identifier -STARTLINE +HIDDEN T anchor}
 addUserKnob {1 title l Title: t "Displayed name on the Node Graph for this Stamp and its Anchor.\nIMPORTANT: This is only for display purposes, and is different from the real/internal name of the Stamps."}
 title "GS Plate"
 addUserKnob {26 prev_title l "" +STARTLINE +HIDDEN T "GS Plate"}
 addUserKnob {26 prev_name l "" +STARTLINE +HIDDEN T Anchor_2bcb55a0c8}
 addUserKnob {3 showing l "" +STARTLINE +HIDDEN}
 addUserKnob {1 tags l Tags t "Comma-separated tags you can define for each Anchor, that will help you find it when invoking the Stamp Selector by pressing the Stamps shortkey with nothing selected."}
 tags 2D,
 addUserKnob {26 line1 l "" +STARTLINE}
 addUserKnob {26 stamps_label l Stamps: T " "}
 addUserKnob {22 createStamp l new t "Create a new Stamp for this Anchor." -STARTLINE T stamps.stampCreateWired(nuke.thisNode())}
 addUserKnob {22 selectStamps l select t "Reconnect all of this Anchor's Stamps." -STARTLINE T stamps.wiredSelectSimilar(nuke.thisNode().name())}
 addUserKnob {22 reconnectStamps l reconnect -STARTLINE T stamps.anchorReconnectWired()}
 addUserKnob {22 zoomNext l "zoom next" t "Navigate to this Anchor's next Stamp on the Node Graph." -STARTLINE T stamps.wiredZoomNext(nuke.thisNode().name())}
 addUserKnob {26 line2 l "" +STARTLINE}
 addUserKnob {22 buttonHelp l Help -STARTLINE T stamps.showHelp()}
 addUserKnob {26 version l " " t "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019." -STARTLINE T "<a href=\"http://www.nukepedia.com/gizmos/other/stamps\" style=\"color:#666;text-decoration: none;\"><span style=\"color:#666\"> <big>Stamps v1.0</big></b></a>"}
}
NoOp {
 name Stamp34
 help "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019"
 onCreate "if nuke.GUI:\n    try:\n        import stamps; stamps.wiredOnCreate()\n    except:\n        pass\n"
 knobChanged "import stamps; stamps.wiredKnobChanged()"
 autolabel "nuke.thisNode().knob(\"title\").value()"
 tile_color 0x1000001
 note_font "Bitstream Vera Sans"
 note_font_size 20
 selected true
 xpos 5639
 ypos 4755
 hide_input true
 addUserKnob {20 wired_tab l "Wired Stamp"}
 addUserKnob {26 identifier -STARTLINE +HIDDEN T wired}
 addUserKnob {3 lockCallbacks l "" +STARTLINE +HIDDEN}
 addUserKnob {6 toReconnect -STARTLINE +HIDDEN}
 addUserKnob {1 title l Title: t "Displayed name on the Node Graph for this Stamp and its Anchor.\nIMPORTANT: This is only for display purposes, and is different from the real/internal name of the Stamps."}
 title "GS Plate"
 addUserKnob {26 prev_title l "" +STARTLINE +HIDDEN T "GS Plate"}
 addUserKnob {26 tags l Tags: t "Tags of this stamp's Anchor, for information purpose only.\nClick \"show anchor\" to change them." T <i>2D</i>}
 addUserKnob {26 backdrops l Backdrops: t "Labels of backdrop nodes which contain this stamp's Anchor." T "<i>Advanced Keying Template</i>"}
 addUserKnob {26 line1 l "" +STARTLINE}
 addUserKnob {26 anchor_label l Anchor: T " "}
 addUserKnob {22 show_anchor l " show anchor " t "Show the properties panel for this Stamp's Anchor." -STARTLINE T stamps.wiredShowAnchor()}
 addUserKnob {22 zoom_anchor l "zoom anchor" t "Navigate to this Stamp's Anchor on the Node Graph." -STARTLINE T stamps.wiredZoomAnchor()}
 addUserKnob {26 stamps_label l Stamps: T " "}
 addUserKnob {22 zoomNext l " zoom next " t "Navigate to this Stamp's next sibling on the Node Graph." -STARTLINE T stamps.wiredZoomNext()}
 addUserKnob {22 selectSimilar l " select similar " t "Select all similar Stamps to this one on the Node Graph." -STARTLINE T stamps.wiredSelectSimilar()}
 addUserKnob {26 space_1 l "" +STARTLINE T " "}
 addUserKnob {26 reconnect_label l Reconnect: t "Reconnect by the stored Anchor name." T " "}
 addUserKnob {22 reconnect_this l this t "Reconnect this Stamp to its Anchor, by its stored Anchor name." -STARTLINE T "n = nuke.thisNode()\ntry:\n    n.setInput(0,nuke.toNode(n.knob(\"anchor\").value()))\nexcept:\n    nuke.message(\"Unable to reconnect.\")\ntry:\n    import stamps\n    stamps.wiredGetStyle(n)\nexcept:\n    pass\n"}
 addUserKnob {22 reconnect_similar l similar t "Reconnect this Stamp and similar ones to their Anchor, by their stored anchor name." -STARTLINE T stamps.wiredReconnectSimilar()}
 addUserKnob {22 reconnect_all l all t "Reconnect all the Stamps to their Anchors, by their stored anchor names." -STARTLINE T stamps.wiredReconnectAll()}
 addUserKnob {26 space_2 l "" +STARTLINE T " "}
 addUserKnob {20 advanced_reconnection l "Advanced Reconnection" n 2}
 addUserKnob {26 reconnect_by_title_label l "<font color=gold>By Title:" t "Reconnect by searching for a matching title." T " "}
 addUserKnob {22 reconnect_by_title_this l this t "Look for an Anchor that shares this Stamp's title, and connect this Stamp to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitle()}
 addUserKnob {22 reconnect_by_title_similar l similar t "Look for an Anchor that shares this Stamp's title, and connect this Stamp and similar ones to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitleSimilar()}
 addUserKnob {22 reconnect_by_title_selected l selected t "For each Stamp selected, look for an Anchor that shares its title, and connect to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitleSelected()}
 addUserKnob {26 reconnect_by_selection_label l "<font color=orangered>By Selection:" t "Force reconnect to a selected Anchor." T " "}
 addUserKnob {22 reconnect_by_selection_this l this t "Force reconnect this Stamp to a selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelection()}
 addUserKnob {22 reconnect_by_selection_similar l similar t "Force reconnect this Stamp and similar ones to a selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelectionSimilar()}
 addUserKnob {22 reconnect_by_selection_selected l selected t "Force reconnect all selected Stamps to an also selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelectionSelected()}
 addUserKnob {1 anchor l Anchor}
 anchor Anchor_2bcb55a0c8
 addUserKnob {6 auto_reconnect_by_title l "<font color=#ED9977>&nbsp; auto-reconnect by title" t "When creating this stamp again (like on copy-paste), auto-reconnect it by title instead of doing it by the saved anchor's name, and auto-turn this off immediately.\nIMPORTANT: Should be off by default. Only use this for setting up templates." +STARTLINE}
 addUserKnob {20 advanced_reconnection_1 l "Advanced Reconnection" +INVISIBLE n -1}
 addUserKnob {26 line2 l "" +STARTLINE}
 addUserKnob {22 buttonHelp l Help -STARTLINE T stamps.showHelp()}
 addUserKnob {26 version l " " t "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019." -STARTLINE T "<a href=\"http://www.nukepedia.com/gizmos/other/stamps\" style=\"color:#666;text-decoration: none;\"><span style=\"color:#666\"> <big>Stamps v1.0</big></b></a>"}
}
Dot {
 name Dot325
 note_font_size 41
 selected true
 xpos 5673
 ypos 4828
}
push $N945822f0
Shuffle {
 in cleanplate
 name Shuffle1
 label "\[value in]"
 selected true
 xpos -843
 ypos 2416
}
Remove {
 operation keep
 channels rgba
 name Remove3
 selected true
 xpos -843
 ypos 2454
}
NoOp {
 name Anchor_3d5fc4c58e
 help "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019"
 onCreate "if nuke.GUI:\n    try:\n        import stamps; stamps.anchorOnCreate()\n    except:\n        pass"
 knobChanged stamps.anchorKnobChanged()
 autolabel "nuke.thisNode().knob(\"title\").value()"
 tile_color 0xffffff01
 note_font_size 20
 selected true
 xpos -843
 ypos 2506
 addUserKnob {20 anchor_tab l "Anchor Stamp"}
 addUserKnob {26 identifier -STARTLINE +HIDDEN T anchor}
 addUserKnob {1 title l Title: t "Displayed name on the Node Graph for this Stamp and its Anchor.\nIMPORTANT: This is only for display purposes, and is different from the real/internal name of the Stamps."}
 title "GS cleanplate"
 addUserKnob {26 prev_title l "" +STARTLINE +HIDDEN T cleanplate}
 addUserKnob {26 prev_name l "" +STARTLINE +HIDDEN T Anchor_3d5fc4c58e}
 addUserKnob {3 showing l "" +STARTLINE +HIDDEN}
 addUserKnob {1 tags l Tags t "Comma-separated tags you can define for each Anchor, that will help you find it when invoking the Stamp Selector by pressing the Stamps shortkey with nothing selected."}
 tags 2D,
 addUserKnob {26 line1 l "" +STARTLINE}
 addUserKnob {26 stamps_label l Stamps: T " "}
 addUserKnob {22 createStamp l new t "Create a new Stamp for this Anchor." -STARTLINE T stamps.stampCreateWired(nuke.thisNode())}
 addUserKnob {22 selectStamps l select t "Reconnect all of this Anchor's Stamps." -STARTLINE T stamps.wiredSelectSimilar(nuke.thisNode().name())}
 addUserKnob {22 reconnectStamps l reconnect -STARTLINE T stamps.anchorReconnectWired()}
 addUserKnob {22 zoomNext l "zoom next" t "Navigate to this Anchor's next Stamp on the Node Graph." -STARTLINE T stamps.wiredZoomNext(nuke.thisNode().name())}
 addUserKnob {26 line2 l "" +STARTLINE}
 addUserKnob {22 buttonHelp l Help -STARTLINE T stamps.showHelp()}
 addUserKnob {26 version l " " t "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019." -STARTLINE T "<a href=\"http://www.nukepedia.com/gizmos/other/stamps\" style=\"color:#666;text-decoration: none;\"><span style=\"color:#666\"> <big>Stamps v1.0</big></b></a>"}
}
NoOp {
 name Stamp33
 help "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019"
 onCreate "if nuke.GUI:\n    try:\n        import stamps; stamps.wiredOnCreate()\n    except:\n        pass\n"
 knobChanged "import stamps; stamps.wiredKnobChanged()"
 autolabel "nuke.thisNode().knob(\"title\").value()"
 tile_color 0x1000001
 note_font "Bitstream Vera Sans"
 note_font_size 20
 selected true
 xpos 5513
 ypos 4756
 hide_input true
 addUserKnob {20 wired_tab l "Wired Stamp"}
 addUserKnob {26 identifier -STARTLINE +HIDDEN T wired}
 addUserKnob {3 lockCallbacks l "" +STARTLINE +HIDDEN}
 addUserKnob {6 toReconnect -STARTLINE +HIDDEN}
 addUserKnob {1 title l Title: t "Displayed name on the Node Graph for this Stamp and its Anchor.\nIMPORTANT: This is only for display purposes, and is different from the real/internal name of the Stamps."}
 title "GS cleanplate"
 addUserKnob {26 prev_title l "" +STARTLINE +HIDDEN T "GS cleanplate"}
 addUserKnob {26 tags l Tags: t "Tags of this stamp's Anchor, for information purpose only.\nClick \"show anchor\" to change them." T <i>2D</i>}
 addUserKnob {26 backdrops l Backdrops: t "Labels of backdrop nodes which contain this stamp's Anchor." T "<i>Advanced Keying Template</i>"}
 addUserKnob {26 line1 l "" +STARTLINE}
 addUserKnob {26 anchor_label l Anchor: T " "}
 addUserKnob {22 show_anchor l " show anchor " t "Show the properties panel for this Stamp's Anchor." -STARTLINE T stamps.wiredShowAnchor()}
 addUserKnob {22 zoom_anchor l "zoom anchor" t "Navigate to this Stamp's Anchor on the Node Graph." -STARTLINE T stamps.wiredZoomAnchor()}
 addUserKnob {26 stamps_label l Stamps: T " "}
 addUserKnob {22 zoomNext l " zoom next " t "Navigate to this Stamp's next sibling on the Node Graph." -STARTLINE T stamps.wiredZoomNext()}
 addUserKnob {22 selectSimilar l " select similar " t "Select all similar Stamps to this one on the Node Graph." -STARTLINE T stamps.wiredSelectSimilar()}
 addUserKnob {26 space_1 l "" +STARTLINE T " "}
 addUserKnob {26 reconnect_label l Reconnect: t "Reconnect by the stored Anchor name." T " "}
 addUserKnob {22 reconnect_this l this t "Reconnect this Stamp to its Anchor, by its stored Anchor name." -STARTLINE T "n = nuke.thisNode()\ntry:\n    n.setInput(0,nuke.toNode(n.knob(\"anchor\").value()))\nexcept:\n    nuke.message(\"Unable to reconnect.\")\ntry:\n    import stamps\n    stamps.wiredGetStyle(n)\nexcept:\n    pass\n"}
 addUserKnob {22 reconnect_similar l similar t "Reconnect this Stamp and similar ones to their Anchor, by their stored anchor name." -STARTLINE T stamps.wiredReconnectSimilar()}
 addUserKnob {22 reconnect_all l all t "Reconnect all the Stamps to their Anchors, by their stored anchor names." -STARTLINE T stamps.wiredReconnectAll()}
 addUserKnob {26 space_2 l "" +STARTLINE T " "}
 addUserKnob {20 advanced_reconnection l "Advanced Reconnection" n 2}
 addUserKnob {26 reconnect_by_title_label l "<font color=gold>By Title:" t "Reconnect by searching for a matching title." T " "}
 addUserKnob {22 reconnect_by_title_this l this t "Look for an Anchor that shares this Stamp's title, and connect this Stamp to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitle()}
 addUserKnob {22 reconnect_by_title_similar l similar t "Look for an Anchor that shares this Stamp's title, and connect this Stamp and similar ones to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitleSimilar()}
 addUserKnob {22 reconnect_by_title_selected l selected t "For each Stamp selected, look for an Anchor that shares its title, and connect to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitleSelected()}
 addUserKnob {26 reconnect_by_selection_label l "<font color=orangered>By Selection:" t "Force reconnect to a selected Anchor." T " "}
 addUserKnob {22 reconnect_by_selection_this l this t "Force reconnect this Stamp to a selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelection()}
 addUserKnob {22 reconnect_by_selection_similar l similar t "Force reconnect this Stamp and similar ones to a selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelectionSimilar()}
 addUserKnob {22 reconnect_by_selection_selected l selected t "Force reconnect all selected Stamps to an also selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelectionSelected()}
 addUserKnob {1 anchor l Anchor}
 anchor Anchor_3d5fc4c58e
 addUserKnob {6 auto_reconnect_by_title l "<font color=#ED9977>&nbsp; auto-reconnect by title" t "When creating this stamp again (like on copy-paste), auto-reconnect it by title instead of doing it by the saved anchor's name, and auto-turn this off immediately.\nIMPORTANT: Should be off by default. Only use this for setting up templates." +STARTLINE}
 addUserKnob {20 advanced_reconnection_1 l "Advanced Reconnection" +INVISIBLE n -1}
 addUserKnob {26 line2 l "" +STARTLINE}
 addUserKnob {22 buttonHelp l Help -STARTLINE T stamps.showHelp()}
 addUserKnob {26 version l " " t "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019." -STARTLINE T "<a href=\"http://www.nukepedia.com/gizmos/other/stamps\" style=\"color:#666;text-decoration: none;\"><span style=\"color:#666\"> <big>Stamps v1.0</big></b></a>"}
}
Dot {
 name Dot328
 note_font_size 41
 selected true
 xpos 5547
 ypos 4875
}
push $N914af150
Dot {
 name Dot331
 note_font_size 41
 selected true
 xpos 5787
 ypos 4701
}
Group {
 inputs 3
 name AdditiveKeyerPro
 tile_color 0x5200ff
 note_font "Verdana Bold Bold"
 note_font_color 0xffffffff
 selected true
 xpos 5753
 ypos 4872
 disable true
 addUserKnob {20 AdditiveKeyer}
 addUserKnob {6 useSC l "Use Screen Color as CleanPlate" +STARTLINE}
 addUserKnob {41 screenColor l "Screen Color" T Keylight1.screenColour}
 addUserKnob {6 despillSat l "Despill Screen Color from Saturation?" +STARTLINE}
 despillSat true
 addUserKnob {26 ""}
 addUserKnob {7 DarkValue l "Dark Value" R 0 5}
 DarkValue 1
 addUserKnob {7 satDarks l "Saturate Darks"}
 satDarks 0.2
 addUserKnob {18 darkTint l "Dark Tint"}
 darkTint 1
 addUserKnob {6 darkTint_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 darkTint_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {26 ""}
 addUserKnob {6 lightTint_panelDropped l "panel dropped state" +HIDDEN +STARTLINE}
 addUserKnob {7 ExtraLightValue l "Light Value Plus" R 0 2}
 ExtraLightValue 1
 addUserKnob {7 satLights l "Saturate Lights"}
 satLights 0.2
 addUserKnob {18 lightTint l "Light Tint"}
 lightTint 1
 addUserKnob {6 lightTint_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 lightTint_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {7 LightValue l "Light Value BG Mult" R 0 5}
 LightValue 0.25
 addUserKnob {26 ""}
 addUserKnob {6 darkTint_panelDropped_1_1_1_1_1_1_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" +HIDDEN +STARTLINE}
 addUserKnob {6 lightTint_panelDropped_1_1_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" +HIDDEN +STARTLINE}
 addUserKnob {6 compositeSwitch l "Output Difference to RGB" +STARTLINE}
 addUserKnob {6 outputDiffAlpha l "Output Difference Matte to Alpha" +STARTLINE}
 addUserKnob {26 ""}
 addUserKnob {41 maskChannelMask l mask T MergeKeymix.maskChannelMask}
 addUserKnob {41 inject -STARTLINE T MergeKeymix.inject}
 addUserKnob {41 invert_mask l invert -STARTLINE T MergeKeymix.invert_mask}
 addUserKnob {41 fringe -STARTLINE T MergeKeymix.fringe}
 addUserKnob {41 mix T MergeKeymix.mix}
 addUserKnob {20 info l Info}
 addUserKnob {26 creator l "Modified By:" T "<b><big>Tony Lyons"}
 addUserKnob {26 desc l Description: t "adds the difference between cleanplate and key plate to the BG\n\nGood for hair details and shadows and sensitive edge treatment" T AdditiveKeyer}
 addUserKnob {26 ver l Version: T v04}
}
 Input {
  inputs 0
  name Inputmask
  xpos 685
  ypos 1141
  number 3
 }
 Dot {
  name Dot10
  label Mask
  note_font_size 41
  xpos 719
  ypos 1883
 }
 Dot {
  name Dot11
  note_font_size 41
  xpos 719
  ypos 1983
 }
 Input {
  inputs 0
  name fg
  label "\[value number]"
  xpos -500
  ypos -221
  number 1
 }
 Remove {
  channels alpha
  name Remove2
  xpos -500
  ypos -147
 }
 AddChannels {
  channels rgba
  name AddChannels2
  xpos -500
  ypos -109
 }
 Dot {
  name Dot26
  note_font_size 41
  xpos -466
  ypos 5
 }
set N94c8aae0 [stack 0]
 OFXuk.co.thefoundry.keylight.keylight_v201 {
  show "Final Result"
  unPreMultiply false
  screenColour {0 0 0}
  screenGain 1
  screenBalance 0.5
  alphaBias {0.5 0.5 0.5}
  despillBias {0.5 0.5 0.5}
  gangBiases true
  preBlur 0
  "Screen Matte" 0
  screenClipMin 0
  screenClipMax 1
  screenClipRollback 0
  screenGrowShrink 0
  screenSoftness 0
  screenDespotBlack 0
  screenDespotWhite 0
  screenReplaceMethod "Soft Colour"
  screenReplaceColour {0.5 0.5 0.5}
  Tuning 0
  midPoint 0.5
  lowGain 1
  midGain 1
  highGain 1
  "Inside Mask" 0
  sourceAlphaHandling Ignore
  insideReplaceMethod "Soft Colour"
  insideReplaceColour {0.5 0.5 0.5}
  Crops 0
  SourceXMethod Colour
  SourceYMethod Colour
  SourceEdgeColour 0
  SourceCropL 0
  SourceCropR 1
  SourceCropB 0
  SourceCropT 1
  balanceSet false
  insideComponent None
  outsideComponent None
  cacheBreaker true
  name Keylight1
  xpos -500
  ypos 73
 }
set N94ceb950 [stack 0]
push $N94c8aae0
 Dot {
  name Dot27
  note_font_size 41
  xpos -356
  ypos 5
 }
 Merge2 {
  inputs 2
  operation from
  name Merge3
  label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
  xpos -390
  ypos 73
 }
 Clamp {
  channels rgba
  name Clamp1
  xpos -390
  ypos 99
 }
 Saturation {
  saturation 0
  name Saturation4
  xpos -390
  ypos 125
 }
push $N94ceb950
 Merge2 {
  inputs 2
  operation plus
  name Merge7
  label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
  xpos -500
  ypos 125
 }
push $N94c8aae0
 Dot {
  name Dot30
  note_font_size 41
  xpos -598
  ypos 5
 }
 Dot {
  name Dot31
  note_font_size 41
  xpos -598
  ypos 218
 }
 Switch {
  inputs 2
  which {{parent.despillSat}}
  name DespillSwitch1
  label "\[value which]"
  xpos -500
  ypos 208
 }
 Dot {
  name Dot8
  xpos -466
  ypos 373
 }
set N94cd70a0 [stack 0]
 Input {
  inputs 0
  name clean
  label "\[value number]"
  xpos 126
  ypos -175
  number 2
 }
 Remove {
  channels alpha
  name Remove3
  xpos 126
  ypos -101
 }
 AddChannels {
  channels rgba
  name AddChannels1
  xpos 126
  ypos -63
 }
 Grade {
  multiply 0
  add {{parent.Keylight1.screenColour} {parent.Keylight1.screenColour} {parent.Keylight1.screenColour} {parent.Keylight1.screenColour}}
  name ScreenColor
  xpos 126
  ypos -14
  disable {{!parent.useSC}}
 }
 Dot {
  name Dot28
  note_font_size 41
  xpos 160
  ypos 50
 }
set N95bc0010 [stack 0]
 OFXuk.co.thefoundry.keylight.keylight_v201 {
  show "Final Result"
  unPreMultiply false
  screenColour {{parent.Keylight1.screenColour x1 0} {parent.Keylight1.screenColour x1 0} {parent.Keylight1.screenColour x1 0}}
  screenGain 1
  screenBalance 0.5
  alphaBias {0.5 0.5 0.5}
  despillBias {0.5 0.5 0.5}
  gangBiases true
  preBlur 0
  "Screen Matte" 0
  screenClipMin 0
  screenClipMax 1
  screenClipRollback 0
  screenGrowShrink 0
  screenSoftness 0
  screenDespotBlack 0
  screenDespotWhite 0
  screenReplaceMethod "Soft Colour"
  screenReplaceColour {0.5 0.5 0.5}
  Tuning 0
  midPoint 0.5
  lowGain 1
  midGain 1
  highGain 1
  "Inside Mask" 0
  sourceAlphaHandling Ignore
  insideReplaceMethod "Soft Colour"
  insideReplaceColour {0.5 0.5 0.5}
  Crops 0
  SourceXMethod Colour
  SourceYMethod Colour
  SourceEdgeColour 0
  SourceCropL 0
  SourceCropR 1
  SourceCropB 0
  SourceCropT 1
  balanceSet false
  insideComponent None
  outsideComponent None
  cacheBreaker true
  name Keylight2
  xpos 126
  ypos 118
 }
set N95bc3f50 [stack 0]
push $N95bc0010
 Dot {
  name Dot29
  note_font_size 41
  xpos 270
  ypos 50
 }
 Merge2 {
  inputs 2
  operation from
  name Merge8
  label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
  xpos 236
  ypos 118
 }
 Clamp {
  channels rgba
  name Clamp2
  xpos 236
  ypos 144
 }
 Saturation {
  saturation 0
  name Saturation5
  xpos 236
  ypos 170
 }
push $N95bc3f50
 Merge2 {
  inputs 2
  operation plus
  name Merge9
  label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
  xpos 126
  ypos 170
 }
push $N95bc0010
 Dot {
  name Dot33
  note_font_size 41
  xpos 28
  ypos 50
 }
 Dot {
  name Dot34
  note_font_size 41
  xpos 28
  ypos 230
 }
 Switch {
  inputs 2
  which {{parent.despillSat}}
  name DespillSwitch2
  label "\[value which]"
  xpos 126
  ypos 223
 }
 Dot {
  name Dot35
  note_font_size 41
  xpos 160
  ypos 320
 }
set N9585f1d0 [stack 0]
 Dot {
  name Dot6
  xpos 412
  ypos 320
 }
 Merge2 {
  inputs 2
  operation difference
  Achannels rgb
  Bchannels rgb
  name Merge6
  xpos 378
  ypos 370
 }
 Group {
  name ChannelControl_v3
  label "\[value channel_selector.in]"
  note_font "Bitstream Vera Sans"
  xpos 378
  ypos 440
  mapsize {0.15 0.15}
  addUserKnob {20 channelControl}
  addUserKnob {41 Channel_Selection T channel_selector.in}
  addUserKnob {26 Description l "" +STARTLINE T ":Channel Control:\n\nChannel math with choice of merge operation"}
  addUserKnob {26 ""}
  addUserKnob {7 redGain}
  redGain 0.3
  addUserKnob {7 greenGain}
  greenGain 0.59
  addUserKnob {7 blueGain}
  blueGain 0.11
  addUserKnob {7 alphaGain}
  addUserKnob {41 operation T Merge1.operation}
 }
  Input {
   inputs 0
   name Input1
   xpos 558
   ypos -694
  }
  Shuffle {
   name channel_selector
   label "\[value in]"
   xpos 558
   ypos -668
  }
set N95880300 [stack 0]
  Shuffle {
   green red
   blue red
   alpha red
   name Shuffle1
   xpos 386
   ypos -536
  }
  Grade {
   channels rgba
   white {{parent.redGain i}}
   name Grade12
   xpos 386
   ypos -492
  }
push $N95880300
  Shuffle {
   red green
   blue green
   alpha green
   name Shuffle2
   xpos 499
   ypos -534
  }
  Grade {
   channels rgba
   white {{parent.greenGain i}}
   name Grade13
   xpos 499
   ypos -493
  }
  Merge2 {
   inputs 2
   operation plus
   name Merge1
   xpos 411
   ypos -428
  }
  set C958c0cc0 [stack 0]
push $N95880300
  Shuffle {
   red blue
   green blue
   alpha blue
   name Shuffle3
   xpos 610
   ypos -538
  }
  Grade {
   channels rgba
   white {{parent.blueGain i}}
   name Grade14
   xpos 610
   ypos -494
  }
clone $C958c0cc0 {
   inputs 2
   xpos 486
   ypos -369
   selected false
  }
push $N95880300
  Shuffle {
   red alpha
   green alpha
   blue alpha
   name Shuffle4
   selected true
   xpos 725
   ypos -535
  }
  Grade {
   channels rgba
   white {{parent.alphaGain i}}
   name Grade15
   xpos 725
   ypos -494
  }
clone $C958c0cc0 {
   inputs 2
   xpos 580
   ypos -307
   selected false
  }
  Output {
   name Output1
   xpos 600
   ypos -210
  }
 end_group
 Dot {
  name Dot14
  note_font_size 41
  xpos 412
  ypos 1768
 }
 Input {
  inputs 0
  name bg
  label "\[value number]"
  xpos -845
  ypos -242
 }
 AddChannels {
  channels rgba
  name AddChannels3
  xpos -845
  ypos -151
 }
 Dot {
  name Dot9
  note_font_size 41
  xpos -811
  ypos -78
 }
 Dot {
  name Dot4
  xpos -811
  ypos 1449
 }
set N95e73a00 [stack 0]
 Dot {
  name Dot13
  note_font_size 41
  xpos -811
  ypos 1688
 }
set N95e778e0 [stack 0]
push $N94cd70a0
 Dot {
  name Dot2
  note_font_size 41
  xpos -466
  ypos 421
 }
set N95e7b7b0 [stack 0]
 Saturation {
  saturation {{parent.satDarks}}
  name Saturation9
  xpos -378
  ypos 418
 }
push $N9585f1d0
 Saturation {
  saturation {{parent.satDarks}}
  name Saturation8
  xpos -215
  ypos 317
 }
 Merge2 {
  inputs 2
  operation divide
  name Merge5
  label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
  xpos -215
  ypos 418
 }
 Dot {
  name Dot38
  note_font_size 41
  xpos -181
  ypos 674
 }
 Clamp {
  channels rgba
  minimum 1
  minimum_enable false
  name Clamp4
  xpos -215
  ypos 786
 }
 Add {
  channels rgba
  value -1
  name Add3
  xpos -215
  ypos 840
 }
 Multiply {
  channels rgb
  value {{parent.DarkValue} {parent.DarkValue} {parent.DarkValue} 0}
  name DARK_VALUE
  xpos -215
  ypos 892
 }
 Grade {
  multiply {{parent.darkTint} {parent.darkTint} {parent.darkTint} {parent.darkTint}}
  reverse true
  black_clamp false
  name DARK_TINT
  xpos -215
  ypos 931
 }
 Add {
  channels rgba
  value 1
  name Add4
  xpos -215
  ypos 988
 }
 Clamp {
  channels rgb
  name Clamp5
  xpos -215
  ypos 1065
 }
 Dot {
  name Dot39
  note_font_size 41
  xpos -181
  ypos 1257
 }
push $N95e7b7b0
 Dot {
  name Dot36
  note_font_size 41
  xpos -466
  ypos 577
 }
 Saturation {
  saturation {{parent.satLights}}
  name Saturation1
  xpos -101
  ypos 574
 }
set N95eee1c0 [stack 0]
push $N9585f1d0
 Saturation {
  saturation {{parent.satLights}}
  name Saturation6
  xpos 126
  ypos 500
 }
set N95fb7810 [stack 0]
 Merge2 {
  inputs 2
  operation divide
  also_merge all
  name Merge10
  label all
  xpos 126
  ypos 568
 }
 Clamp {
  channels rgba
  minimum 1
  maximum_enable false
  name Clamp3
  xpos 126
  ypos 780
 }
 Add {
  channels rgba
  value -1
  name Add1
  xpos 126
  ypos 838
 }
 Multiply {
  channels rgb
  value {{parent.LightValue} {parent.LightValue} {parent.LightValue} 0}
  name LIGHT_VALUE
  xpos 126
  ypos 961
 }
 Multiply {
  channels rgb
  value {{parent.lightTint.r} {parent.lightTint.g} {parent.lightTint.b} 0}
  name LIGHT_TINT
  xpos 126
  ypos 1039
 }
 Add {
  channels rgba
  value 1
  name Add2
  xpos 126
  ypos 1120
 }
 Merge2 {
  inputs 2
  operation multiply
  Achannels rgb
  Bchannels rgb
  output rgb
  name __CONSTRAIN_DARKS__
  xpos 128
  ypos 1253
 }
 Dot {
  name Dot19
  note_font_size 41
  xpos 162
  ypos 1354
 }
set N94822220 [stack 0]
 Dot {
  name Dot3
  xpos -8
  ypos 1354
 }
 Dot {
  name Dot16
  note_font_size 41
  xpos -8
  ypos 1611
 }
push $N95fb7810
 Dot {
  name Dot7
  note_font_size 41
  xpos 310
  ypos 503
 }
push $N95eee1c0
 Dot {
  name Dot5
  note_font_size 41
  xpos -67
  ypos 691
 }
 Merge2 {
  inputs 2
  operation from
  name Merge1
  label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
  xpos 276
  ypos 688
 }
 Clamp {
  channels rgba
  maximum_enable false
  name Clamp6
  xpos 276
  ypos 781
 }
 Multiply {
  channels rgba
  value {{parent.ExtraLightValue}}
  name Multiply1
  label "\[value value]"
  xpos 276
  ypos 899
 }
 Multiply {
  channels rgb
  value {{parent.lightTint.r} {parent.lightTint.g} {parent.lightTint.b} 0}
  name LIGHT_TINT1
  xpos 276
  ypos 1036
 }
 Dot {
  name Dot15
  note_font_size 41
  xpos 310
  ypos 1513
 }
push $N94822220
 Dot {
  name Dot1
  note_font_size 41
  xpos 162
  ypos 1449
 }
push $N95e73a00
 Merge2 {
  inputs 2
  operation multiply
  Achannels rgb
  Bchannels rgb
  output rgb
  name CONSTRAIN_LIGHTS
  xpos 128
  ypos 1446
 }
 Merge2 {
  inputs 2
  operation plus
  output rgb
  name Merge2
  label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
  xpos 128
  ypos 1510
 }
 Switch {
  inputs 2
  which {{parent.compositeSwitch}}
  name Switch1
  label "\[value which]"
  xpos 128
  ypos 1604
 }
 Copy {
  inputs 2
  from0 rgba.alpha
  to0 rgba.alpha
  name Copy1
  xpos 128
  ypos 1678
  disable {{parent.outputDiffAlpha}}
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.alpha
  name __LUMA_INTO_ALPHA__
  xpos 128
  ypos 1758
  disable {{!parent.outputDiffAlpha}}
 }
 Dot {
  name Dot17
  label A
  note_font_size 41
  xpos 162
  ypos 1910
 }
push $N95e778e0
 Dot {
  name Dot18
  label B
  note_font_size 41
  xpos -811
  ypos 1895
 }
 Dot {
  name Dot12
  note_font_size 41
  xpos -811
  ypos 1986
 }
 Merge2 {
  inputs 2+1
  operation copy
  bbox B
  Achannels none
  Bchannels none
  output none
  also_merge rgba
  name MergeKeymix
  xpos 128
  ypos 1973
 }
 Output {
  name Output1
  xpos 128
  ypos 2235
 }
end_group
Merge2 {
 inputs 2
 bbox B
 name Merge51
 selected true
 xpos 5753
 ypos 5188
}
Dot {
 name Dot332
 selected true
 xpos 5787
 ypos 5712
}
push $N9399f500
push $N939a7290
Merge2 {
 inputs 2
 operation plus
 name Merge52
 label "test lunimance match"
 selected true
 xpos -1155
 ypos -1806
}
Dot {
 name Dot336
 label test
 note_font_size 31
 selected true
 xpos -1121
 ypos -1677
}
push $N93a000b0
Shuffle {
 in despill_RGB
 name Shuffle27
 label "\[value in]"
 selected true
 xpos -1193
 ypos 2416
}
Remove {
 operation keep
 channels rgba
 name Remove5
 selected true
 xpos -1193
 ypos 2454
}
NoOp {
 name Anchor_35df505785
 help "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019"
 onCreate "if nuke.GUI:\n    try:\n        import stamps; stamps.anchorOnCreate()\n    except:\n        pass"
 knobChanged stamps.anchorKnobChanged()
 autolabel "nuke.thisNode().knob(\"title\").value()"
 tile_color 0xffffff01
 note_font_size 20
 selected true
 xpos -1193
 ypos 2509
 addUserKnob {20 anchor_tab l "Anchor Stamp"}
 addUserKnob {26 identifier -STARTLINE +HIDDEN T anchor}
 addUserKnob {1 title l Title: t "Displayed name on the Node Graph for this Stamp and its Anchor.\nIMPORTANT: This is only for display purposes, and is different from the real/internal name of the Stamps."}
 title "despill RGB"
 addUserKnob {26 prev_title l "" +STARTLINE +HIDDEN T "despill RGB"}
 addUserKnob {26 prev_name l "" +STARTLINE +HIDDEN T Anchor_35df505785}
 addUserKnob {3 showing l "" +STARTLINE +HIDDEN}
 addUserKnob {1 tags l Tags t "Comma-separated tags you can define for each Anchor, that will help you find it when invoking the Stamp Selector by pressing the Stamps shortkey with nothing selected."}
 tags 2D,
 addUserKnob {26 line1 l "" +STARTLINE}
 addUserKnob {26 stamps_label l Stamps: T " "}
 addUserKnob {22 createStamp l new t "Create a new Stamp for this Anchor." -STARTLINE T stamps.stampCreateWired(nuke.thisNode())}
 addUserKnob {22 selectStamps l select t "Reconnect all of this Anchor's Stamps." -STARTLINE T stamps.wiredSelectSimilar(nuke.thisNode().name())}
 addUserKnob {22 reconnectStamps l reconnect -STARTLINE T stamps.anchorReconnectWired()}
 addUserKnob {22 zoomNext l "zoom next" t "Navigate to this Anchor's next Stamp on the Node Graph." -STARTLINE T stamps.wiredZoomNext(nuke.thisNode().name())}
 addUserKnob {26 line2 l "" +STARTLINE}
 addUserKnob {22 buttonHelp l Help -STARTLINE T stamps.showHelp()}
 addUserKnob {26 version l " " t "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019." -STARTLINE T "<a href=\"http://www.nukepedia.com/gizmos/other/stamps\" style=\"color:#666;text-decoration: none;\"><span style=\"color:#666\"> <big>Stamps v1.0</big></b></a>"}
}
StickyNote {
 inputs 0
 name StickyNote21
 tile_color 0xff
 label "Make or Generate\ncleanplate if you can"
 note_font_size 41
 note_font_color 0xffffffff
 selected true
 xpos 3177
 ypos -2021
}
StickyNote {
 inputs 0
 name StickyNote1
 tile_color 0xff
 label "<-- adjust \nblackpoint/\nwhitepoint"
 note_font_size 41
 note_font_color 0xffffffff
 selected true
 xpos -651
 ypos 3097
}
push $N94579930
Shuffle {
 in GS_Plate
 name Shuffle28
 label "\[value in]"
 selected true
 xpos 5427
 ypos 5397
}
push $N919add90
Dot {
 name Dot334
 selected true
 xpos 3127
 ypos -2999
}
Remove {
 operation keep
 channels rgb
 name Remove38
 selected true
 xpos 3093
 ypos -2871
}
Dot {
 name Dot335
 note_font_size 41
 selected true
 xpos 3127
 ypos -2523
}
